<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gas Laws Game</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&display=swap');
  html, body {
    margin:0; padding:0; height:100%; font-family:'Montserrat',sans-serif;
    background:#1a0a3a; overflow:hidden; color:white;
  }
  #particleCanvas {
    position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0;pointer-events:none;
  }
  #mainMenu {
    position:relative; z-index:1; height:100vh;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
  }
  #mainMenu h1 {
    font-weight:600; font-size:4rem; margin-bottom:0.3em; letter-spacing:5px; color:#ff5a5f;
  }
  #mainMenu h3 {
    font-weight:300; font-size:1.2rem; margin-bottom:2em; color:#ff7a7f;
  }
  #mainMenu button {
    background:#ff5a5f; border:none; border-radius:50px; color:white;
    font-size:1.5rem; padding:16px 80px; margin:12px 0; cursor:pointer;
    box-shadow:0 4px 8px rgba(255,90,95,0.4); transition:background-color .3s;
  }
  #mainMenu button:hover {
    background:#ff7a7f;
  }
  .gameMode {
    display:none; position:relative; z-index:2; height:100vh;
    padding:20px; background:#111; overflow:auto; box-sizing:border-box;
  }
  .return-btn {
    margin-top:20px; padding:10px 20px; font-size:16px;
    background:#ff5a5f; color:white; border:none; border-radius:5px; cursor:pointer;
    display:block; margin-left:auto; margin-right:auto;
  }
  .slider-container {
    margin: 15px auto; width: 300px; color: #ff5a5f;
  }
  .slider-container label {
    display: block; margin-bottom: 6px; font-weight: 600;
  }
  input[type=range] {
    width: 100%;
  }

  /* Boyle Mode */
  #boyleContainer {
    margin: 20px auto 10px auto;
    width: 500px; height: 350px;
    background: #222;
    border: 2px solid #ff5a5f;
    border-radius: 15px;
    position: relative;
    overflow: hidden;
  }
  .molecule {
    position: absolute;
    border-radius: 50%;
    background-color: #ff5a5f;
    box-shadow: 0 0 6px #ff7a7f;
    pointer-events:none;
  }

  /* Charles Mode */
  #charlesContainer {
    margin: 20px auto 10px auto;
    width: 500px; height: 350px;
    background: #222;
    border: 2px solid #ff5a5f;
    border-radius: 15px;
    position: relative;
    overflow: hidden;
    user-select:none;
  }
  #charlesBalloon {
    position: absolute;
    left: 50%; bottom: 30px;
    width: 80px; height: 120px;
    background: #ff5a5f;
    border-radius: 50% / 70%;
    transform: translateX(-50%);
    opacity: 0.1;
    transition: width 0.2s ease, height 0.2s ease;
    box-shadow: 0 0 20px #ff5a5f88;
  }
  #charlesCounter {
    position: absolute;
    left: 50%; bottom: 10px;
    font-weight: 700; font-size: 2rem;
    color: #ff5a5f44;
    transform: translateX(-50%);
    user-select:none;
    pointer-events:none;
  }

  /* Avogadro Mode */
  #avogadroContainer {
    margin: 20px auto 10px auto;
    width: 500px; height: 350px;
    background: #222;
    border: 2px solid #ff5a5f;
    border-radius: 15px;
    position: relative;
    overflow: hidden;
    user-select:none;
  }
  #avogadroBalloon {
    position: absolute;
    left: 50%; bottom: 30px;
    width: 80px; height: 120px;
    background: #ff5a5f;
    border-radius: 50% / 70%;
    transform: translateX(-50%);
    opacity: 0.7;
    box-shadow: 0 0 20px #ff5a5f88;
    transition: width 0.1s ease, height 0.1s ease;
  }
  #avogadroCounter {
    position: absolute;
    left: 50%; bottom: 10px;
    font-weight: 700; font-size: 2rem;
    color: #ff5a5f44;
    transform: translateX(-50%);
    user-select:none;
    pointer-events:none;
  }
  #avogadroControls {
    text-align: center;
    margin-top: 10px;
  }
  #increaseMassBtn {
    background:#ff5a5f;
    border:none;
    color:#fff;
    padding: 10px 30px;
    font-size: 16px;
    border-radius: 50px;
    cursor: pointer;
    user-select:none;
  }
  #increaseMassBtn:active {
    background:#ff7a7f;
  }

  /* Balloon pop animation */
  @keyframes popAnim {
    0% {transform: translateX(-50%) scale(1);}
    50% {transform: translateX(-50%) scale(1.4);}
    100% {transform: translateX(-50%) scale(0); opacity: 0;}
  }
</style>
</head>
<body>

<canvas id="particleCanvas"></canvas>

<!-- MAIN MENU -->
<div id="mainMenu">
  <h1>GAS LAWS GAME</h1>
  <h3>Choose your mode</h3>
  <button onclick="showMode('boyle')">Boyle's Law</button>
  <button onclick="showMode('charles')">Charles' Law</button>
  <button onclick="showMode('gayLussac')">Gay‑Lussac's Law</button>
  <button onclick="showMode('avogadro')">Avogadro's Law</button>
</div>

<!-- BOYLE MODE -->
<div id="boyle" class="gameMode">
  <h2>Boyle's Law</h2>
  <div class="slider-container">
    <label for="boyleMass">Mass: <span id="boyleMassVal">5</span></label>
    <input type="range" id="boyleMass" min="1" max="50" step="1" value="5" />
  </div>
  <div class="slider-container">
    <label for="boyleTemp">Temperature: <span id="boyleTempVal">20</span> °C</label>
    <input type="range" id="boyleTemp" min="0" max="100" step="1" value="20" />
  </div>
  <div id="boyleContainer"></div>
  <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
</div>

<!-- CHARLES MODE -->
<div id="charles" class="gameMode">
  <h2>Charles' Law</h2>
  <div class="slider-container">
    <label for="charlesTemp">Temperature: <span id="charlesTempVal">20</span> °C</label>
    <input type="range" id="charlesTemp" min="0" max="100" step="1" value="20" />
  </div>
  <div id="charlesContainer">
    <div id="charlesBalloon"></div>
    <div id="charlesCounter">80</div>
  </div>
  <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
</div>

<!-- GAY-LUSSAC MODE placeholder -->
<div id="gayLussac" class="gameMode">
  <h2>Gay-Lussac's Law</h2>
  <p>Coming soon...</p>
  <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
</div>

<!-- AVOGADRO MODE -->
<div id="avogadro" class="gameMode">
  <h2>Avogadro's Law</h2>
  <div id="avogadroContainer">
    <div id="avogadroBalloon"></div>
    <div id="avogadroCounter">80</div>
  </div>
  <div id="avogadroControls">
    <button id="increaseMassBtn">Increase Mass</button>
  </div>
  <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
</div>

<script>
  // === Particle background (unchanged) ===
  const canvas = document.getElementById('particleCanvas'), ctx = canvas.getContext('2d');
  let particles = [], width, height;
  function initParticles() {
    width = window.innerWidth; height = window.innerHeight;
    canvas.width = width; canvas.height = height;
    particles = [];
    for (let i = 0; i < 80; i++) {
      particles.push({
        x: Math.random()*width,
        y: Math.random()*height,
        radius: Math.random()*6 + 2,
        speedY: Math.random()*1.5 + 0.5,
        speedX: (Math.random()-0.5)*0.5,
        color: '#ff5a5f',
        alpha: Math.random()*0.5 + 0.3,
        type: Math.random() > 0.5 ? 'circle' : 'atom'
      });
    }
  }
  function drawAtom(x, y, r) {
    ctx.strokeStyle = '#ff7a7f';
    ctx.lineWidth = 1.2;
    ctx.beginPath(); ctx.arc(x, y, r*0.6, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(255,122,127,0.8)'; ctx.fill(); ctx.closePath();
    ctx.beginPath(); ctx.ellipse(x, y, r*1.2, r*0.5, 0, 0, Math.PI*2); ctx.stroke();
    ctx.beginPath(); ctx.ellipse(x, y, r*0.5, r*1.2, Math.PI/4, 0, Math.PI*2); ctx.stroke();
  }
  function animateParticles() {
    ctx.clearRect(0, 0, width, height);
    particles.forEach(p => {
      p.y += p.speedY;
      p.x += p.speedX;
      if (p.y - p.radius > height) p.y = -p.radius;
      if (p.x - p.radius > width) p.x = -p.radius;
      if (p.x + p.radius < 0) p.x = width + p.radius;
      ctx.globalAlpha = p.alpha;
      if (p.type === 'circle') {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI*2);
        ctx.fillStyle = p.color;
        ctx.fill();
      } else {
        drawAtom(p.x, p.y, p.radius);
      }
    });
    ctx.globalAlpha = 1;
    requestAnimationFrame(animateParticles);
  }
  window.addEventListener('resize', initParticles);
  initParticles(); animateParticles();

  // === Navigation ===
  const modes = ['boyle', 'charles', 'gayLussac', 'avogadro'];
  function showMode(id) {
    document.getElementById('mainMenu').style.display = 'none';
    modes.forEach(m => {
      const el = document.getElementById(m);
      if(el) el.style.display = (m === id) ? 'block' : 'none';
    });
    if(id === 'boyle') setupBoyle();
    else stopBoyleAnimation();
    if(id === 'charles') setupCharles();
    if(id === 'avogadro') setupAvogadro();
    if(id !== 'avogadro') stopAvogadroIncreasing();
  }
  function returnToMenu() {
    document.getElementById('mainMenu').style.display = 'flex';
    modes.forEach(m => {
      const el = document.getElementById(m);
      if(el) el.style.display = 'none';
    });
    stopBoyleAnimation();
    stopAvogadroIncreasing();
  }

  // === BOYLE MODE ===
  const boyleMassSlider = document.getElementById('boyleMass'),
        boyleTempSlider = document.getElementById('boyleTemp'),
        boyleMassVal = document.getElementById('boyleMassVal'),
        boyleTempVal = document.getElementById('boyleTempVal'),
        boyleContainer = document.getElementById('boyleContainer');

  let molecules = [];
  let animationId;
  const containerRect = { width: 500, height: 350 };

  class Molecule {
    constructor(container) {
      this.container = container;
      this.radius = 8 + Math.random() * 4;
      this.x = Math.random() * (containerRect.width - 2*this.radius) + this.radius;
      this.y = Math.random() * (containerRect.height - 2*this.radius) + this.radius;
      this.speedX = (Math.random() - 0.5) * 2;
      this.speedY = (Math.random() - 0.5) * 2;
      this.elem = document.createElement('div');
      this.elem.className = 'molecule';
      this.elem.style.width = this.radius*2 + 'px';
      this.elem.style.height = this.radius*2 + 'px';
      container.appendChild(this.elem);
      this.updatePosition();
    }
    updatePosition() {
      this.elem.style.left = this.x - this.radius + 'px';
      this.elem.style.top = this.y - this.radius + 'px';
    }
    move(speedMultiplier) {
      this.x += this.speedX * speedMultiplier;
      this.y += this.speedY * speedMultiplier;

      if (this.x - this.radius < 0) {
        this.x = this.radius;
        this.speedX = -this.speedX;
      }
      if (this.x + this.radius > containerRect.width) {
        this.x = containerRect.width - this.radius;
        this.speedX = -this.speedX;
      }
      if (this.y - this.radius < 0) {
        this.y = this.radius;
        this.speedY = -this.speedY;
      }
      if (this.y + this.radius > containerRect.height) {
        this.y = containerRect.height - this.radius;
        this.speedY = -this.speedY;
      }
      this.updatePosition();
    }
    remove() {
      this.elem.remove();
    }
  }

  function setupBoyle() {
    boyleMassSlider.oninput = boyleTempSlider.oninput = updateBoyle;
    updateBoyle();
  }

  function updateBoyle() {
    const mass = +boyleMassSlider.value;
    const temp = +boyleTempSlider.value;
    boyleMassVal.textContent = mass;
    boyleTempVal.textContent = temp;

    adjustMolecules(mass);

    // Speed calculation:
    // More mass => more balls, speed ~ temperature
    // Speed multiplier proportional to temp/100, minimum 0.1
    const speedMultiplier = 0.1 + temp / 100;

    animateMolecules(speedMultiplier);
  }

  function adjustMolecules(targetCount) {
    while (molecules.length < targetCount) {
      molecules.push(new Molecule(boyleContainer));
    }
    while (molecules.length > targetCount) {
      const m = molecules.pop();
      m.remove();
    }
  }

  let animationRunning = false;

  function animateMolecules(speedMultiplier) {
    if (!animationRunning) {
      animationRunning = true;
      function animate() {
        molecules.forEach(m => m.move(speedMultiplier));
        animationId = requestAnimationFrame(animate);
      }
      animate();
    }
  }

  function stopBoyleAnimation() {
    if(animationId) {
      cancelAnimationFrame(animationId);
      animationId = null;
      animationRunning = false;
    }
    molecules.forEach(m => m.remove());
    molecules = [];
  }

  // === CHARLES MODE ===
  const charlesTempSlider = document.getElementById('charlesTemp'),
        charlesTempVal = document.getElementById('charlesTempVal'),
        charlesBalloon = document.getElementById('charlesBalloon'),
        charlesCounter = document.getElementById('charlesCounter'),
        charlesContainer = document.getElementById('charlesContainer');

  // Balloon initial size for Charles: width=80, height=120
  const charlesInitial = {width: 80, height: 120};

  function setupCharles() {
    charlesTempSlider.oninput = updateCharles;
    updateCharles();
  }
  function updateCharles() {
    const temp = +charlesTemp
