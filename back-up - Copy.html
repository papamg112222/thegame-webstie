// script.js

// --- Game Constants and Variables ---
const board = document.getElementById('game-board');
const statusMessage = document.getElementById('status-message');
const scorePlayer1El = document.getElementById('score-player1');
const scorePlayer2El = document.getElementById('score-player2');
const gridSize = 20; // 20x20 grid

let player1 = {
    x: 0,
    y: 0,
    direction: 'right',
    score: 0,
    element: null // This will hold the HTML element for the tank
};

let player2 = {
    x: gridSize - 1,
    y: gridSize - 1,
    direction: 'left',
    score: 0,
    element: null
};

let obstacles = [];

// --- Game Initialization ---

function createGameBoard() {
    for (let i = 0; i < gridSize * gridSize; i++) {
        const cell = document.createElement('div');
        cell.classList.add('game-cell');
        board.appendChild(cell);
    }
}

function placeObstacles() {
    // A simple way to place some obstacles randomly
    const numberOfObstacles = 30;
    for (let i = 0; i < numberOfObstacles; i++) {
        let x = Math.floor(Math.random() * gridSize);
        let y = Math.floor(Math.random() * gridSize);

        // Make sure obstacles don't spawn on top of players
        if ((x !== player1.x || y !== player1.y) && (x !== player2.x || y !== player2.y)) {
            obstacles.push({ x, y });
        }
    }
}

function drawElements() {
    // Clear the board for redrawing
    board.querySelectorAll('.tank, .obstacle').forEach(el => el.remove());

    // Draw obstacles
    obstacles.forEach(obs => {
        const obstacleEl = document.createElement('div');
        obstacleEl.classList.add('obstacle');
        obstacleEl.style.gridColumnStart = obs.x + 1;
        obstacleEl.style.gridRowStart = obs.y + 1;
        board.appendChild(obstacleEl);
    });

    // Draw Player 1's tank
    player1.element = document.createElement('div');
    player1.element.classList.add('tank', 'player1-tank', player1.direction);
    board.appendChild(player1.element);
    updateTankPosition(player1);

    // Draw Player 2's tank
    player2.element = document.createElement('div');
    player2.element.classList.add('tank', 'player2-tank', player2.direction);
    board.appendChild(player2.element);
    updateTankPosition(player2);
}

function updateTankPosition(player) {
    player.element.style.gridColumnStart = player.x + 1;
    player.element.style.gridRowStart = player.y + 1;
    // Update direction class for rotation
    player.element.className = '';
    player.element.classList.add('tank', (player === player1 ? 'player1-tank' : 'player2-tank'), player.direction);
}

// --- Player Movement ---

document.addEventListener('keydown', (event) => {
    // Player 1 controls (W, A, S, D)
    if (event.key === 'w' || event.key === 'W') moveTank(player1, 'up');
    if (event.key === 's' || event.key === 'S') moveTank(player1, 'down');
    if (event.key === 'a' || event.key === 'A') moveTank(player1, 'left');
    if (event.key === 'd' || event.key === 'D') moveTank(player1, 'right');

    // Player 2 controls (Arrow keys)
    if (event.key === 'ArrowUp') moveTank(player2, 'up');
    if (event.key === 'ArrowDown') moveTank(player2, 'down');
    if (event.key === 'ArrowLeft') moveTank(player2, 'left');
    if (event.key === 'ArrowRight') moveTank(player2, 'right');
});

function moveTank(player, direction) {
    let newX = player.x;
    let newY = player.y;

    switch (direction) {
        case 'up': newY--; break;
        case 'down': newY++; break;
        case 'left': newX--; break;
        case 'right': newX++; break;
    }
    
    player.direction = direction; // Update direction for rotation

    // Check for boundaries and obstacles
    const isOutOfBounds = newX < 0 || newX >= gridSize || newY < 0 || newY >= gridSize;
    const isCollidingWithObstacle = obstacles.some(obs => obs.x === newX && obs.y === newY);

    if (!isOutOfBounds && !isCollidingWithObstacle) {
        player.x = newX;
        player.y = newY;
        updateTankPosition(player);
    }
}

// --- Start the Game ---
createGameBoard();
placeObstacles();
drawElements();
