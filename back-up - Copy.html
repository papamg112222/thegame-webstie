<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gas Laws Game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&display=swap');
    html, body { margin:0; padding:0; height:100%; font-family:'Montserrat',sans-serif; background:#1a0a3a; overflow:hidden; color:white; }
    #particleCanvas { position:fixed; top:0;left:0;width:100vw;height:100vh;z-index:0;pointer-events:none; }
    .menu, .mode { display:none; position:relative; z-index:1; height:100vh; width:100vw; justify-content:center; align-items:center; flex-direction:column; }
    .menu.active, .mode.active { display:flex; }
    .menu h1 { font-size:4rem; color:#ff5a5f; }
    .menu button { background:#ff5a5f; border:none; border-radius:50px; color:#fff; font-size:1.5rem; padding:16px 80px; margin:12px; cursor:pointer; transition:0.3s; }
    .menu button:hover { background:#ff7a7f; }
    .return-btn { position:absolute; top:20px; left:20px; padding:10px 20px; background:white;color:black;border:none;border-radius:5px;cursor:pointer; }
    .return-btn:hover { background:#f0cece; }
    .simulation { position:relative; background:#222; border:3px solid #fff; border-radius:10px; overflow:hidden; margin:20px; }
    #simBox { width:600px; max-width:90vw; height:400px; max-height:60vh; }
    .dot { position:absolute; width:10px;height:10px;border-radius:50%;background:#00b0ff; }
    #charlesBalloon { position:absolute; top:50%;left:50%;background:radial-gradient(circle at center,#ff4d4d 0%,#cc0000 80%);border-radius:50%/60%;transform:translate(-50%,-50%);transition:width 0.3s,height 0.3s; }
    #charlesBG { position:absolute;top:0;left:0;right:0;bottom:0;z-index:1;transition:background-color 1s linear; }
  </style>
</head>
<body>

<canvas id="particleCanvas"></canvas>

<!-- MAIN MENU -->
<div class="menu active" id="mainMenu">
  <h1>GAS LAWS GAME</h1>
  <button onclick="showMode('boyle')">Boyle's Law</button>
  <button onclick="showMode('charles')">Charles's Law</button>
  <button onclick="showMode('gay')">Gayâ€‘Lussac's Law</button>
  <button onclick="showMode('avogadro')">Avogadro's Law</button>
</div>

<!-- BOYLE MODE -->
<div class="mode" id="boyle">
  <button class="return-btn" onclick="returnMenu()">Return</button>
  <div class="simulation" id="simBox"></div>
  <div style="margin:20px;">
    <label>Mass: <input id="massSlider" type="range" min="1" max="100" value="30"></label>
    <label>Temp: <input id="tempSlider" type="range" min="1" max="100" value="30"></label>
  </div>
</div>

<!-- CHARLES MODE -->
<div class="mode" id="charles">
  <button class="return-btn" onclick="returnMenu()">Return</button>
  <div class="simulation" id="charlesSim" style="width:600px;max-width:90vw;height:400px;max-height:60vh;">
    <div id="charlesBG"></div>
    <div id="charlesBalloon"></div>
  </div>
  <div style="margin:20px;">
    <label>Temp: <input id="charlesSlider" type="range" min="1" max="100" value="50"></label>
  </div>
</div>

<!-- TODO: Add Gay-Lussac and Avogadro Mode containers -->

<script>
  // Particle background logic
  const canvas = document.getElementById('particleCanvas'), ctx=canvas.getContext('2d');
  let w,h, particles=[];
  function initParticles(){
    w=canvas.width=window.innerWidth; h=canvas.height=window.innerHeight;
    particles=[]; for(let i=0;i<80;i++) particles.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*6+2,sx:(Math.random()-.5)*.5,sy:Math.random()*1.5+.5,a:Math.random()*.5+.3, t:Math.random()>0.5?'circle':'atom'});
  }
  function drawAtom(x,y,r){ctx.strokeStyle='#ff7a7f';ctx.lineWidth=1.2;ctx.beginPath();ctx.arc(x,y,r*.6,0,2*Math.PI);ctx.fillStyle='rgba(255,122,127,0.8)';ctx.fill();ctx.beginPath();ctx.ellipse(x,y,r*1.2,r*0.5,0,0,2*Math.PI);ctx.stroke();ctx.beginPath();ctx.ellipse(x,y,r*0.5,r*1.2,Math.PI/4,0,2*Math.PI);ctx.stroke();}
  function anim(){
    ctx.clearRect(0,0,w,h);
    particles.forEach(p=>{
      p.x+=p.sx; p.y+=p.sy;
      if(p.y-p.r>h) p.y=-p.r;
      if(p.x-p.r>w) p.x=-p.r; if(p.x+p.r<0) p.x=w+p.r;
      ctx.globalAlpha=p.a;
      if(p.t==='circle'){ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,2*Math.PI);ctx.fillStyle='#ff5a5f';ctx.fill();}
      else drawAtom(p.x,p.y,p.r);
      ctx.globalAlpha=1;
    });
    requestAnimationFrame(anim);
  }
  initParticles(); anim();
  window.onresize=initParticles;

  // Mode logic
  const modes=['mainMenu','boyle','charles'], massSlider=document.getElementById('massSlider'), tempSlider=document.getElementById('tempSlider'),
        simBox=document.getElementById('simBox'),
        charlesSlider=document.getElementById('charlesSlider'), charlesBalloon=document.getElementById('charlesBalloon'),
        charlesBG=document.getElementById('charlesBG');

  function showMode(mode){
    document.querySelectorAll('.menu, .mode').forEach(el=>el.classList.remove('active'));
    document.getElementById(mode).classList.add('active');

    if(mode==='boyle'){ createDots(parseInt(massSlider.value)); requestAnimationFrame(updateDots); }
    if(mode==='charles'){ updateCharles(); startLed(); }
  }
  function returnMenu(){ document.querySelectorAll('.menu, .mode').forEach(el=>el.classList.remove('active')); mainMenu.classList.add('active'); clearDots(); stopLed(); }

  // Boyle implementation
  let dots=[], velocities=[];
  function createDots(count){
    clearDots();
    for(let i=0;i<count;i++){
      const dot=document.createElement('div'); dot.className='dot';
      dot.style.left=Math.random()*(simBox.clientWidth-10)+'px';
      dot.style.top=Math.random()*(simBox.clientHeight-10)+'px';
      simBox.appendChild(dot); dots.push(dot);
      velocities.push({x:(Math.random()*2-1), y:(Math.random()*2-1)});
    }
  }
  function clearDots(){ dots.forEach(d=>d.remove()); dots=[]; velocities=[]; }
  function updateDots(){
    if(!dots.length) return;
    const speed = parseInt(tempSlider.value)/(parseInt(massSlider.value)/10);
    dots.forEach((d,i)=>{
      let x=parseFloat(d.style.left)+velocities[i].x*speed;
      let y=parseFloat(d.style.top)+velocities[i].y*speed;
      if(x<=0||x>=simBox.clientWidth-10) velocities[i].x*=-1;
      if(y<=0||y>=simBox.clientHeight-10) velocities[i].y*=-1;
      d.style.left=Math.max(0,Math.min(simBox.clientWidth-10,x))+'px';
      d.style.top=Math.max(0,Math.min(simBox.clientHeight-10,y))+'px';
    });
    requestAnimationFrame(updateDots);
  }
  massSlider.oninput=()=>createDots(parseInt(massSlider.value));
  tempSlider.oninput=()=>{/*dots speed auto updates*/};

  // Charles implementation
  let ledInt;
  function startLed(){ ledInt = setInterval(()=>{
      const hue = (parseInt(charlesSlider.value)*3)%360;
      charlesBG.style.backgroundColor = `hsl(${hue},100%,50%)`;
    },50);
    updateCharles();
  }
  function stopLed(){ clearInterval(ledInt); charlesBG.style.backgroundColor='transparent'; }
  function updateCharles(){
    const t=parseInt(charlesSlider.value), min=50, max=200;
    const sz = min + ((t-1)/99)*(max-min);
    charlesBalloon.style.width=sz+'px';
    charlesBalloon.style.height=sz*1.375+'px';
  }
  charlesSlider.oninput=updateCharles;
</script>

</body>
</html>
