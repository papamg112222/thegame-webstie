<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Stickman Showdown</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Arial', sans-serif;
            color: white;
            flex-direction: column;
        }
        canvas {
            background-color: #333;
            border: 2px solid #555;
        }
        #ui-container {
            position: absolute;
            top: 20px;
            width: 80%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .health-bar-container {
            width: 300px;
            height: 30px;
            background-color: #555;
            border: 2px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            position: relative;
        }
        .health-bar {
            height: 100%;
            background-color: limegreen;
            transition: width 0.3s ease-out;
        }
        #player1-health-bar {
            border-right: none;
        }
        #player2-health-bar {
            border-left: none;
        }
        #game-messages {
            text-align: center;
            font-size: 2em;
            text-shadow: 2px 2px 4px #000;
            width: 100%;
        }
        #start-button {
            position: absolute;
            padding: 15px 30px;
            font-size: 1.5em;
            cursor: pointer;
            border: none;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: background-color 0.3s ease;
        }
        #start-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="1280" height="720"></canvas>
    <div id="ui-container">
        <div class="health-bar-container" id="player1-health-bar-container">
            <div class="health-bar" id="player1-health-bar"></div>
        </div>
        <div id="game-messages">AI Showdown</div>
        <div class="health-bar-container" id="player2-health-bar-container">
            <div class="health-bar" id="player2-health-bar"></div>
        </div>
    </div>
    <button id="start-button">Start Fight</button>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const startButton = document.getElementById('start-button');
        const messageDisplay = document.getElementById('game-messages');
        const p1HealthBar = document.getElementById('player1-health-bar');
        const p2HealthBar = document.getElementById('player2-health-bar');

        let gameActive = false;
        let lastFrameTime = 0;
        const groundHeight = canvas.height - 50;

        let cameraShake = {
            duration: 0,
            strength: 0,
            on: false
        };

        // --- Stickman Class ---
        class Stickman {
            constructor(x, y, color, direction) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.direction = direction; // 1 for right, -1 for left
                this.health = 100;
                this.velocity = { x: 0, y: 0 };
                this.isAttacking = false;
                this.isJumping = false;
                this.attackCooldown = 0;
                this.lastAttackTime = 0;
                this.attackBox = { x: 0, y: 0, width: 60, height: 20 };
                this.dashing = false;
                this.dashTrail = [];
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);

                // Draw dash trail if dashing
                if (this.dashing) {
                    this.dashTrail.forEach((pos, index) => {
                        ctx.save();
                        ctx.globalAlpha = 0.5 - (index * 0.1);
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        ctx.arc(0, -40, 10, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.restore();
                    });
                }

                // Main stickman body
                ctx.fillStyle = this.color;
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 3;

                // Head
                ctx.beginPath();
                ctx.arc(0, -40, 10, 0, Math.PI * 2);
                ctx.fill();

                // Torso
                ctx.beginPath();
                ctx.moveTo(0, -30);
                ctx.lineTo(0, 20);
                ctx.stroke();

                // Arms (simple for now)
                ctx.beginPath();
                ctx.moveTo(0, -20);
                ctx.lineTo(this.isAttacking ? 30 * this.direction : 20 * this.direction, -10);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, -20);
                ctx.lineTo(this.isAttacking ? 20 * this.direction : -20 * this.direction, 10);
                ctx.stroke();

                // Legs
                ctx.beginPath();
                ctx.moveTo(0, 20);
                ctx.lineTo(10 * this.direction, 50);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, 20);
                ctx.lineTo(-10 * this.direction, 50);
                ctx.stroke();

                ctx.restore();
            }

            update(opponent) {
                // Apply gravity
                this.velocity.y += 0.5;
                this.x += this.velocity.x;
                this.y += this.velocity.y;

                // Stop at ground
                if (this.y > groundHeight) {
                    this.y = groundHeight;
                    this.velocity.y = 0;
                    this.isJumping = false;
                }

                // AI Logic (simple version)
                const distance = opponent.x - this.x;
                const distanceAbs = Math.abs(distance);

                // Attack logic
                if (distanceAbs < 80 && !this.isAttacking && Date.now() - this.lastAttackTime > 1000) {
                    this.attack();
                } else if (distanceAbs > 150) {
                    this.velocity.x = (distance > 0) ? 3 : -3;
                } else if (distanceAbs < 100) {
                    this.velocity.x = (distance > 0) ? -2 : 2;
                } else {
                    this.velocity.x = 0;
                }

                // Handle attacking
                if (this.isAttacking) {
                    this.attackCooldown--;
                    if (this.attackCooldown <= 0) {
                        this.isAttacking = false;
                    }
                }

                // Dash logic
                if (this.dashing) {
                    this.dashTrail.unshift({ x: this.x, y: this.y });
                    if (this.dashTrail.length > 5) {
                        this.dashTrail.pop();
                    }
                    if (this.velocity.x === 0) {
                        this.dashing = false;
                        this.dashTrail = [];
                    }
                }
            }

            attack() {
                this.isAttacking = true;
                this.attackCooldown = 30; // Attack lasts for 30 frames
                this.lastAttackTime = Date.now();
                // Check for a hit
                const opponent = (this === player1) ? player2 : player1;
                if (this.checkCollision(opponent)) {
                    opponent.takeDamage(10);
                    startCameraShake(20, 5);
                }
            }
            
            takeDamage(amount) {
                this.health -= amount;
                if (this.health < 0) this.health = 0;
                updateHealthBars();
                if (this.health === 0) {
                    // This is where you would trigger slow-mo
                    endGame();
                }
            }

            checkCollision(opponent) {
                // Simple collision check
                const attackX = this.x + (this.direction === 1 ? 20 : -80);
                const attackY = this.y - 10;
                return (
                    attackX < opponent.x + 40 &&
                    attackX + this.attackBox.width > opponent.x &&
                    attackY < opponent.y + 40 &&
                    attackY + this.attackBox.height > opponent.y
                );
            }
        }

        // --- Game Logic ---
        let player1 = new Stickman(300, groundHeight, 'cyan', 1);
        let player2 = new Stickman(canvas.width - 300, groundHeight, 'magenta', -1);

        function animate(currentTime) {
            if (!gameActive) return;

            const deltaTime = currentTime - lastFrameTime;
            lastFrameTime = currentTime;

            ctx.save();

            // Camera shake effect
            if (cameraShake.on) {
                if (cameraShake.duration > 0) {
                    const shakeX = (Math.random() - 0.5) * cameraShake.strength;
                    const shakeY = (Math.random() - 0.5) * cameraShake.strength;
                    ctx.translate(shakeX, shakeY);
                    cameraShake.duration--;
                } else {
                    cameraShake.on = false;
                }
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            player1.update(player2);
            player2.update(player1);
            player1.draw();
            player2.draw();

            ctx.restore();

            requestAnimationFrame(animate);
        }

        function startCameraShake(duration, strength) {
            cameraShake.duration = duration;
            cameraShake.strength = strength;
            cameraShake.on = true;
        }

        function updateHealthBars() {
            p1HealthBar.style.width = player1.health + '%';
            p2HealthBar.style.width = player2.health + '%';
        }

        function startGame() {
            player1.health = 100;
            player2.health = 100;
            updateHealthBars();
            messageDisplay.textContent = 'FIGHT!';
            startButton.style.display = 'none';
            gameActive = true;
            lastFrameTime = performance.now();
            animate(lastFrameTime);
        }

        function endGame() {
            gameActive = false;
            const winner = player1.health > player2.health ? 'Player 1' : 'Player 2';
            messageDisplay.textContent = `${winner} wins!`;
            startButton.style.display = 'block';
        }

        startButton.addEventListener('click', startGame);

        // Initial state
        messageDisplay.textContent = 'AI Stickman Showdown';
        updateHealthBars();
    </script>
</body>
</html>
