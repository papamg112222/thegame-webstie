<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gas Laws Game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&display=swap');

    /* Base styles & main menu */
    html, body { margin:0; padding:0; height:100%; font-family:'Montserrat',sans-serif; background:#1a0a3a; overflow:hidden; color:white; }
    #particleCanvas { position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0;pointer-events:none; }
    #mainMenu { position:relative; z-index:1; height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; }
    #mainMenu h1 { font-weight:600; font-size:4rem; margin-bottom:0.3em; letter-spacing:5px; color:#ff5a5f; }
    #mainMenu h3 { font-weight:300; font-size:1.2rem; margin-bottom:2em; color:#ff7a7f; }
    #mainMenu button {
      background:#ff5a5f;
      border:none;
      border-radius:50px;
      color:white;
      font-size:1.5rem;
      padding:16px 80px;
      margin:12px 0;
      cursor:pointer;
      box-shadow:0 4px 8px rgba(255,90,95,0.4);
      transition:background-color .3s;
    }
    #mainMenu button:hover { background:#ff7a7f; }

    /* Gameplay screens */
    .gameMode {
      display:none;
      position:relative;
      z-index:2;
      height:100vh;
      padding:20px;
      background:#111;
      overflow:auto;
      box-sizing:border-box;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .container {
      background: #222;
      border-radius: 12px;
      padding: 20px;
      width: 350px;
      height: 350px;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .return-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background: #ff5a5f;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      align-self: center;
      width: 140px;
    }

    /* Shared game elements */
    .slider-container { margin: 15px 0; width: 300px; color:#ff5a5f; }
    .slider-container label { display: block; margin-bottom: 6px; font-weight: 600; }
    input[type=range] { width: 100%; }
    .balloon-container {
      position: relative;
      width: 250px;
      height: 180px; /* Smaller height to prevent overlap with button */
      margin: 10px auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .balloon {
      /* Base background color is now a gradient */
      background: radial-gradient(circle at 30% 30%, #ffaaaa, #ff5a5f 70%, #cc0000);
      border-radius: 50% / 60%;
      /* Added box-shadow for depth */
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      transition: width 0.3s, height 0.3s, background-color 0.3s, box-shadow 0.3s;
      position: relative;
      z-index: 10;
      /* NEW: Animation for floating */
      animation: floatUpDown 3s ease-in-out infinite alternate;
    }
    /* NEW: Keyframes for floating animation */
    @keyframes floatUpDown {
      0% { transform: translateY(0px); }
      100% { transform: translateY(-10px); } /* Floats up 10px */
    }

    .molecule-teller-bg, .molecule-counter {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      text-shadow: 0 0 10px rgba(255,255,255,0.7);
      user-select: none;
      font-weight: 900;
      z-index: 1;
    }
    .molecule-teller-bg {
      font-size: 180px;
      font-weight: 900;
      opacity: 0.1;
      letter-spacing: 20px;
    }
    .molecule-counter {
      font-size: 24px;
      font-weight: 600;
      top: 20px;
      left: 20px;
      transform: none;
      text-shadow: none;
      color: white;
      z-index: 100;
    }

    /* Avogadro specifics */
    .avogadro-increase-btn {
      background:#ff5a5f;
      border:none;
      border-radius:30px;
      color:white;
      font-size:1.3rem;
      padding:12px 30px;
      cursor:pointer;
      display:block;
      margin: 10px auto 0 auto;
      box-shadow:0 3px 7px rgba(255,90,95,0.5);
      transition:background-color .3s;
      user-select: none;
    }
    .avogadro-increase-btn:hover { background:#ff7a7f; }

    @keyframes betterPopAnimation {
      0% { transform: scale(1); opacity: 1; border-radius: 50% / 60%; }
      30% { transform: scale(1.3); opacity: 0.8; background-color: rgba(255, 50, 50, 0.9); }
      60% { transform: scale(0); opacity: 0; border-radius: 50%; }
      100% { transform: scale(0); opacity: 0; border-radius: 50%; }
    }

    .pop {
      animation: betterPopAnimation 0.6s forwards ease-out;
    }

    /* Rainbow button styles */
    .rainbow-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      padding: 15px 30px;
      font-size: 1.5rem;
      font-weight: 600;
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      text-align: center;
      white-space: nowrap;

      background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
      background-size: 200% 100%;
      animation: rainbowBackground 3s linear infinite;

      box-shadow: 0 0 10px #ff00ff,
                  0 0 20px #00ffff,
                  0 0 30px #ffff00;
      transition: box-shadow 0.3s ease-in-out;
    }

    .rainbow-button:hover {
        box-shadow: 0 0 15px #ff00ff,
                    0 0 30px #00ffff,
                    0 0 45px #ffff00,
                    0 0 60px #ff00ff;
    }

    @keyframes rainbowBackground {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }

  </style>
</head>
<body>

  <canvas id="particleCanvas"></canvas>

  <div id="mainMenu">
    <h1>GAS LAWS GAME</h1>
    <h3>Choose your mode</h3>
    <button onclick="showMode('boyle')">Boyle's Law</button>
    <button onclick="showMode('charles')">Charles' Law</button>
    <button onclick="showMode('gayLussac')">Gay‑Lussac's Law</button>
    <button onclick="showMode('avogadro')">Avogadro's Law</button>
    <button id="memberBtn">Member</button>
  </div>

  <div id="boyle" class="gameMode">
    <div class="container">
      <h2>Boyle's Law</h2>
      <div class="slider-container">
        <label>Mass: <span id="boyleMassVal">5</span></label>
        <input type="range" id="boyleMass" min="1" max="20" step="1" value="5">
      </div>
      <div class="slider-container">
        <label>Temperature (°C): <span id="boyleTempVal">20</span></label>
        <input type="range" id="boyleTemp" min="0" max="100" value="20">
      </div>
      <canvas id="boyleCanvas" width="250" height="250" style="background:#222; border-radius:12px;"></canvas>
    </div>
    <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
  </div>

  <div id="charles" class="gameMode">
    <div class="container" style="position: relative;">
      <h2>Charles' Law</h2>
      <div class="balloon-container" style="justify-content:center; align-items:center; height:180px;">
        <div id="charlesBalloon" class="balloon" style="width:100px; height:150px; background-color: rgba(255, 90, 95, 0.1); z-index: 2;"></div>
        <div id="charlesMoleculeBg" class="molecule-teller-bg">0</div>
      </div>
      <div class="slider-container">
        <label>Temperature (°C): <span id="charlesTempVal">20</span></label>
        <input type="range" id="charlesTemp" min="0" max="100" value="20">
      </div>
    </div>
    <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
  </div>

  <div id="gayLussac" class="gameMode">
    <div class="container">
      <h2>Gay‑Lussac's Law</h2>
      <div class="balloon-container"><div id="gayLussacBalloon" class="balloon" style="width: 150px; height: 225px;"></div></div>
      <div class="slider-container"><label>Pressure (P): <span id="gayLussacPressureVal">1</span></label><input type="range" id="gayLussacPressure" min="1" max="10" value="1"></div>
      <div class="slider-container"><label>Temperature (°C): <span id="gayLussacTempVal">20</span></label><input type="range" id="gayLussacTemp" min="0" max="100" value="20"></div>
    </div>
    <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
  </div>

  <div id="avogadro" class="gameMode">
    <div class="container" style="position: relative;">
      <h2>Avogadro's Law</h2>
      <div id="avogadroTopLeftCounter" class="molecule-counter">Molecules: 0</div>

      <div class="balloon-container">
        <div id="avogadroBalloon" class="balloon" style="width:100px; height:150px; z-index: 2;"></div>
        <div id="avogadroMoleculeBg" class="molecule-teller-bg">0</div>
        <button id="getNewOneBtn" class="rainbow-button">GET NEW ONE!!!</button>
      </div>

      <button id="increaseMoleculeBtn" class="avogadro-increase-btn">Increase Molecules</button>
    </div>
    <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
  </div>

  <audio id="popSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>

  <script>
    // === Animated Particles Background ===
    const canvas = document.getElementById('particleCanvas'), ctx = canvas.getContext('2d');
    let particles = [], width, height;
    function initParticles() {
      width = window.innerWidth; height = window.innerHeight;
      canvas.width = width; canvas.height = height;
      particles = [];
      for (let i = 0; i < 80; i++) {
        particles.push({
          x: Math.random() * width,
          y: Math.random() * height,
          radius: Math.random() * 6 + 2,
          speedY: Math.random() * 1.5 + 0.5,
          speedX: (Math.random() - 0.5) * 0.5,
          color: '#ff5a5f',
          alpha: Math.random() * 0.5 + 0.3,
          type: Math.random() > 0.5 ? 'circle' : 'atom'
        });
      }
    }

    function drawAtom(x, y, r) {
      ctx.strokeStyle = '#ff7a7f';
      ctx.lineWidth = 1.2;
      ctx.beginPath(); ctx.arc(x, y, r * 0.6, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255,122,127,0.8)'; ctx.fill(); ctx.closePath();
      ctx.beginPath(); ctx.ellipse(x, y, r * 1.2, r * 0.5, 0, 0, Math.PI * 2); ctx.stroke();
      ctx.beginPath(); ctx.ellipse(x, y, r * 0.5, r * 1.2, Math.PI / 4, 0, Math.PI * 2); ctx.stroke();
    }

    function draw() {
      ctx.clearRect(0, 0, width, height);
      for (const p of particles) {
        p.y += p.speedY; p.x += p.speedX;
        if (p.y - p.radius > height) p.y = -p.radius;
        if (p.x - p.radius > width) p.x = -p.radius;
        else if (p.x + p.radius < 0) p.x = width + p.radius;
        ctx.globalAlpha = p.alpha;
        if (p.type === 'circle') {
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
          ctx.fill();
          ctx.closePath();
        } else {
          drawAtom(p.x, p.y, p.radius);
        }
        ctx.globalAlpha = 1;
      }
      requestAnimationFrame(draw);
    }
    window.addEventListener('resize', initParticles);
    initParticles();
    draw();

    // === Main Menu & Mode Handling ===
    const modes = ['boyle','charles','gayLussac','avogadro'];
    function showMode(mode) {
      document.getElementById('mainMenu').style.display = 'none';
      modes.forEach(m => {
        document.getElementById(m).style.display = (m === mode ? 'flex' : 'none');
      });
      if(mode==='boyle') initBoyle();
      else if(mode==='charles') initCharles();
      else if(mode==='gayLussac') initGayLussac();
      else if(mode==='avogadro') initAvogadro();
    }
    function returnToMenu() {
      document.getElementById('mainMenu').style.display = 'flex';
      modes.forEach(m => {
        document.getElementById(m).style.display = 'none';
      });
      cancelBoyleAnimation();
      cancelAvogadroIncrease();
    }

    // Member button
    document.getElementById('memberBtn').addEventListener('click', () => {
      alert('Welcome to the Member section!');
      // Customize what this button does here
    });

    // === BOYLE MODE ===
    const boyleMassSlider = document.getElementById('boyleMass');
    const boyleTempSlider = document.getElementById('boyleTemp');
    const boyleMassVal = document.getElementById('boyleMassVal');
    const boyleTempVal = document.getElementById('boyleTempVal');
    const boyleCanvas = document.getElementById('boyleCanvas');
    const bCtx = boyleCanvas.getContext('2d');
    let boyleBalls = [];
    let boyleAnimId;

    function initBoyle() {
      boyleMassVal.textContent = boyleMassSlider.value;
      boyleTempVal.textContent = boyleTempSlider.value;
      initBoyleBalls();
      animateBoyle();
    }
    function initBoyleBalls() {
      boyleBalls = [];
      const mass = parseInt(boyleMassSlider.value);
      const temp = parseInt(boyleTempSlider.value);
      // Number of balls = mass * 5 for demo
      let count = mass * 5;
      // Speed = depends on temperature (higher temp = faster)
      for (let i = 0; i < count; i++) {
        boyleBalls.push({
          x: Math.random() * boyleCanvas.width,
          y: Math.random() * boyleCanvas.height,
          radius: 6,
          speedX: (Math.random() - 0.5) * (temp/20),
          speedY: (Math.random() - 0.5) * (temp/20),
          color: '#ff5a5f'
        });
      }
    }
    function animateBoyle() {
      bCtx.clearRect(0, 0, boyleCanvas.width, boyleCanvas.height);
      boyleBalls.forEach(ball => {
        ball.x += ball.speedX;
        ball.y += ball.speedY;

        // Bounce inside the container edges
        if (ball.x + ball.radius > boyleCanvas.width) { ball.x = boyleCanvas.width - ball.radius; ball.speedX *= -1; }
        if (ball.x - ball.radius < 0) { ball.x = ball.radius; ball.speedX *= -1; }
        if (ball.y + ball.radius > boyleCanvas.height) { ball.y = boyleCanvas.height - ball.radius; ball.speedY *= -1; }
        if (ball.y - ball.radius < 0) { ball.y = ball.radius; ball.speedY *= -1; }

        // Draw ball
        bCtx.fillStyle = ball.color;
        bCtx.beginPath();
        bCtx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        bCtx.fill();
      });
      boyleAnimId = requestAnimationFrame(animateBoyle);
    }
    function cancelBoyleAnimation() {
      if (boyleAnimId) cancelAnimationFrame(boyleAnimId);
    }

    boyleMassSlider.oninput = () => {
      boyleMassVal.textContent = boyleMassSlider.value;
      initBoyleBalls();
    };
    boyleTempSlider.oninput = () => {
      boyleTempVal.textContent = boyleTempSlider.value;
      initBoyleBalls();
    };

    // === CHARLES MODE ===
    const charlesTempSlider = document.getElementById('charlesTemp');
    const charlesTempVal = document.getElementById('charlesTempVal');
    const charlesBalloon = document.getElementById('charlesBalloon');
    const charlesMoleculeBg = document.getElementById('charlesMoleculeBg');

    function initCharles() {
      charlesTempVal.textContent = charlesTempSlider.value;
      updateCharlesBalloon();
    }
    function updateCharlesBalloon() {
      const temp = parseInt(charlesTempSlider.value);
      charlesTempVal.textContent = temp;
      // Balloon size changes but stays centered and smaller
      const minWidth = 80, minHeight = 120;
      const maxWidth = 140, maxHeight = 210;
      // Linear interpolate size based on temperature (0 - 100)
      const width = minWidth + (maxWidth - minWidth) * (temp / 100);
      const height = minHeight + (maxHeight - minHeight) * (temp / 100);
      charlesBalloon.style.width = width + 'px';
      charlesBalloon.style.height = height + 'px';
      charlesBalloon.style.backgroundColor = 'rgba(255, 90, 95, 0.1)';
      charlesBalloon.style.position = 'relative';
      charlesBalloon.style.margin = '0 auto';
      // molecule bg updates to temperature (rounded)
      charlesMoleculeBg.textContent = temp;
    }
    charlesTempSlider.oninput = () => {
      updateCharlesBalloon();
    };

    // === GAY-LUSSAC MODE (Placeholder as you didn’t specify changes) ===
    const gayLussacPressureSlider = document.getElementById('gayLussacPressure');
    const gayLussacTempSlider = document.getElementById('gayLussacTemp');
    const gayLussacPressureVal = document.getElementById('gayLussacPressureVal');
    const gayLussacTempVal = document.getElementById('gayLussacTempVal');
    const gayLussacBalloon = document.getElementById('gayLussacBalloon');

    function initGayLussac() {
      gayLussacPressureVal.textContent = gayLussacPressureSlider.value;
      gayLussacTempVal.textContent = gayLussacTempSlider.value;
      updateGayLussacBalloon();
    }
    function updateGayLussacBalloon() {
      const pressure = parseInt(gayLussacPressureSlider.value);
      const temp = parseInt(gayLussacTempSlider.value);
      gayLussacPressureVal.textContent = pressure;
      gayLussacTempVal.textContent = temp;
      // Balloon size changes with temp (arbitrary)
      let baseWidth = 120, baseHeight = 180;
      let width = baseWidth + (temp / 100) * 60;
      let height = baseHeight + (temp / 100) * 90;
      gayLussacBalloon.style.width = width + 'px';
      gayLussacBalloon.style.height = height + 'px';
    }
    gayLussacPressureSlider.oninput = updateGayLussacBalloon;
    gayLussacTempSlider.oninput = updateGayLussacBalloon;

    // === AVOGADRO MODE ===
    const avogadroBalloon = document.getElementById('avogadroBalloon');
    const avogadroMoleculeBg = document.getElementById('avogadroMoleculeBg');
    const avogadroTopLeftCounter = document.getElementById('avogadroTopLeftCounter');
    const increaseMoleculeBtn = document.getElementById('increaseMoleculeBtn');
    const getNewOneBtn = document.getElementById('getNewOneBtn'); // Get the new button element
    const popSound = document.getElementById('popSound');

    let avogadroMolecules = 0;
    let increaseInterval = null;
    const MAX_MOLECULES = 100;

    function initAvogadro() {
      avogadroMolecules = 0;
      avogadroBalloon.style.width = '100px';
      avogadroBalloon.style.height = '150px';
      // Initial background for realistic look
      avogadroBalloon.style.background = 'radial-gradient(circle at 30% 30%, #ffaaaa, #ff5a5f 70%, #cc0000)';
      avogadroBalloon.style.boxShadow = '0 5px 15px rgba(0,0,0,0.5)';
      avogadroBalloon.classList.remove('pop');
      avogadroBalloon.style.display = 'block'; // Ensure balloon is visible
      avogadroBalloon.style.animationPlayState = 'running'; // Start float animation

      increaseMoleculeBtn.style.display = 'block'; // Ensure increase button is visible
      getNewOneBtn.style.display = 'none'; // Ensure "Get New One" button is hidden

      updateAvogadroDisplay();
    }

    function updateAvogadroDisplay() {
      avogadroMoleculeBg.textContent = avogadroMolecules;
      avogadroTopLeftCounter.textContent = 'Molecules: ' + avogadroMolecules;

      const minWidth = 80, minHeight = 120;
      const maxWidth = 180, maxHeight = 270;

      const progress = avogadroMolecules / MAX_MOLECULES;
      const width = minWidth + (maxWidth - minWidth) * progress;
      const height = minHeight + (maxHeight - minHeight) * progress;

      avogadroBalloon.style.width = width + 'px';
      avogadroBalloon.style.height = height + 'px';

      const balloonContainer = document.querySelector('#avogadro .balloon-container');
      const containerHeight = balloonContainer ? balloonContainer.clientHeight : 250;
      const moleculeBgHeight = avogadroMoleculeBg.clientHeight;
      avogadroMoleculeBg.style.top = `${(containerHeight - moleculeBgHeight) / 2}px`;

      if (avogadroMolecules >= MAX_MOLECULES) {
        popBalloon();
      }
    }

    function popBalloon() {
      if (avogadroBalloon.classList.contains('pop')) return;

      avogadroBalloon.classList.add('pop');
      popSound.currentTime = 0;
      popSound.play();
      clearInterval(increaseInterval); // Stop increasing molecules
      avogadroBalloon.style.animationPlayState = 'paused'; // Pause float animation during pop

      increaseMoleculeBtn.style.display = 'none'; // Hide increase button
      getNewOneBtn.style.display = 'block'; // Show "Get New One" button

      setTimeout(() => {
        avogadroBalloon.style.display = 'none'; // Hide the balloon after animation
        avogadroBalloon.classList.remove('pop'); // Remove animation class for next time
      }, 600); // This timeout matches the animation duration
    }

    function increaseMassStep() {
      if (avogadroBalloon.classList.contains('pop') || avogadroMolecules >= MAX_MOLECULES) {
          clearInterval(increaseInterval);
          return;
      }
      avogadroMolecules++;
      updateAvogadroDisplay();
    }

    // Event listener for the "Get New One" button - now fully functional
    getNewOneBtn.addEventListener('click', () => {
        initAvogadro(); // Re-initialize the mode to get a new balloon
    });

    increaseMoleculeBtn.addEventListener('mousedown', () => {
      increaseMassStep();
      increaseInterval = setInterval(increaseMassStep, 100);
    });
    increaseMoleculeBtn.addEventListener('mouseup', () => {
      clearInterval(increaseInterval);
    });
    increaseMoleculeBtn.addEventListener('mouseleave', () => {
      clearInterval(increaseInterval);
    });

    function cancelAvogadroIncrease() {
      clearInterval(increaseInterval);
    }

  </script>

</body>
</html>
