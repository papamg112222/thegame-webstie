<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Specimen #966</title>
<style>
  body,html{margin:0;padding:0;overflow:hidden;background:#000;height:100%;cursor:none;}
  #start{color:#500;text-align:center;position:absolute;bottom:30px;width:100%;font-family:Arial;font-size:15px;}
  #jump{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:140px;color:#f00;font-family:'Courier New';text-shadow:0 0 40px #f00;opacity:0;transition:opacity 0.5s;z-index:10;}
</style>
</head>
<body>

<div id="start">WARNING: Prolonged observation may cause irreversible psychological damage.<br><br>Left-click to activate viewer</div>
<div id="jump">IT SEES YOU</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.module.js';
import {OrbitControls} from 'https://cdn.jsdelivr.net/npm/three@0.168.0/examples/jsm/controls/OrbitControls.js';

// ------------------- WAIT FOR LEFT CLICK -------------------
let started = false;
document.body.addEventListener('click', startHorror);
document.body.addEventListener('contextmenu', e=>e.preventDefault()); // disable right click

function startHorror() {
  if(started) return;
  started = true;
  document.getElementById('start').remove();

  // ---------- SETUP THREE.JS ----------
  const renderer = new THREE.WebGLRenderer({antialias:false});
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio || 1);
  document.body.appendChild(renderer.domElement);

  const scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0x000000, 0.001);

  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
  camera.position.set(0, 0.5, 4);

  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.04;
  controls.minDistance = 1.5;
  controls.maxDistance = 8;

  // Dim red light
  const light = new THREE.PointLight(0x880011, 0.5, 20);
  light.position.set(0,3,5);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0x200000, 0.2));

  // ---------- THE MONSTER (way creepier now) ----------
  const geo = new THREE.IcosahedronGeometry(1.2, 1);
  const mat = new THREE.MeshStandardMaterial({
    color:0x0a000a, roughness:1, metalness:0, emissive:0x220000, emissiveIntensity:0.3
  });
  const monster = new THREE.Mesh(geo, mat);
  scene.add(monster);

  // Distort it so it looks wrong
  const pos = geo.attributes.position;
  for(let i=0;i<pos.count;i++){
    const s = 0.7 + Math.random()*0.8;
    pos.setX(i, pos.getX(i)*s + (Math.random()-0.5)*1.2);
    pos.setY(i, pos.getY(i)*s + (Math.random()-0.5)*1.2);
    pos.setZ(i, pos.getZ(i)*s + (Math.random()-0.5)*1.2);
  }
  pos.needsUpdate = true;
  geo.computeVertexNormals();

  // Glowing red eyes
  const eyeMat = new THREE.MeshBasicMaterial({color:0xff0033});
  const eyeL = new THREE.Mesh(new THREE.SphereGeometry(0.16,16,16), eyeMat);
  eyeL.position.set(-0.4,0.5,0.9);
  const eyeR = eyeL.clone();
  eyeR.position.x = 0.4;
  monster.add(eyeL, eyeR);

  // ---------- AUDIO ----------
  let audioCtx = null;
  function unlockAudio(){ if(!audioCtx) audioCtx = new AudioContext(); }
  document.body.addEventListener('pointerdown', unlockAudio, {once:true});

  function scream() {
    if(!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(120, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(20, audioCtx.currentTime + 2.8);
    gain.gain.setValueAtTime(0.01, audioCtx.currentTime);
    gain.gain.exponentialRampToValue(3, audioCtx.currentTime + 0.05);
    gain.gain.exponentialRampToValue(0.01, audioCtx.currentTime + 3.5);
    osc.connect(gain).connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 4);
  }

  // ---------- JUMPSCARE ----------
  let stareTime = 0;
  let triggered = false;

  function jumpscare(){
    if(triggered) return;
    triggered = true;

    scream();

    // LUNGE + huge scale
    monster.scale.setScalar(9);
    camera.position.z = 0.1;

    // Flash red + invert + shake
    document.body.style.filter = "invert(1) brightness(2)";
    document.body.style.animation = "shake 0.3s infinite";
    document.getElementById('jump').style.opacity = 1;

    // Extra red flashes
    let flashes = 0;
    const flashInt = setInterval(()=>{
      document.body.style.background = flashes%2===0 ? "#400" : "#000";
      flashes++;
      if(flashes>12) {
        clearInterval(flashInt);
        document.body.style.background = "#000";
      }
    }, 80);
  }

  // ---------- ANIMATION LOOP ----------
  function animate(){
    requestAnimationFrame(animate);

    monster.rotation.y += 0.003;
    monster.rotation.x += 0.001;

    const looking = controls.target.distanceTo(monster.position) < 1.8;
    if(looking){
      stareTime += 0.016;
      const intensity = Math.min(stareTime/7, 5);
      eyeL.material.emissiveIntensity = intensity*3;
      eyeR.material.emissiveIntensity = intensity*3;
      light.intensity = intensity*4;

      if(stareTime > 10) jumpscare();
    }else{
      stareTime = Math.max(stareTime-0.08, 0);
    }

    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  window.onresize = ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  };
}
</script>

<style>
@keyframes shake{
  0%,100%{transform:translate(0,0)}
  10%{transform:translate(-30px,-30px) rotate(-5deg)}
  20%{transform:translate(30px,-20px) rotate(5deg)}
  30%{transform:translate(-30px,20px) rotate(-5deg)}
  40%{transform:translate(30px,30px) rotate(5deg)}
  50%{transform:translate(-20px,-30px) rotate(-5deg)}
}
</style>
</body>
</html>
