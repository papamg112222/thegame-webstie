<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gas Laws Game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&display=swap');

    /* Base styles & main menu */
    html, body {
      margin: 0;
      padding: 0;
      /* MODIFIED: Changed from height: 100% and overflow: hidden */
      overflow-x: hidden;
      font-family: 'Montserrat', sans-serif;
      background: #1a0a3a;
      color: white;
    }
    #particleCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
    }
    #mainMenu {
      position: relative;
      z-index: 1;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    #mainMenu h1 {
      font-weight: 600;
      font-size: 4rem;
      margin-bottom: 0.3em;
      letter-spacing: 5px;
      /* Rainbow effect */
      background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
      background-size: 200% 100%;
      animation: rainbowBackground 3s linear infinite;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      color: transparent; /* Fallback */
    }
    #mainMenu h3 {
      font-weight: 300;
      font-size: 1.2rem;
      margin-bottom: 2em;
      /* Rainbow effect */
      background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
      background-size: 200% 100%;
      animation: rainbowBackground 3s linear infinite;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      color: transparent; /* Fallback */
    }
    #mainMenu button {
      background: #ff5a5f;
      border: none;
      border-radius: 50px;
      color: white;
      font-size: 1.5rem;
      padding: 16px 80px;
      margin: 12px 0;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(255, 90, 95, 0.4);
      transition: background-color .3s;
    }
    #mainMenu button:hover {
      background: #ff7a7f;
    }

    /* Gameplay screens */
    .gameMode {
      display: none;
      position: relative;
      z-index: 2;
      /* MODIFIED: Changed height to min-height to allow scrolling */
      min-height: 100vh;
      padding: 20px;
      background: #111; /* Default dark background for game modes */
      overflow: auto;
      box-sizing: border-box;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* Member Page */
    #memberPage {
        display: none; /* Hidden by default */
        position: relative;
        z-index: 2;
        /* MODIFIED: Changed height to min-height to allow scrolling */
        min-height: 100vh;
        padding: 20px;
        background: #1a0a3a; /* Darker background for member page */
        overflow: auto;
        box-sizing: border-box;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }
    #memberPage h2 {
        font-weight: 600;
        font-size: 3rem;
        margin-bottom: 40px;
        color: #9400d3; /* Purple color */
        text-shadow: 0 0 15px rgba(148, 0, 211, 0.7); /* Purple glow */
    }
    #memberPage ul {
        list-style: none;
        padding: 0;
        margin: 0 0 40px 0;
    }
    #memberPage li {
        font-size: 1.8rem;
        font-weight: 300;
        margin: 15px 0;
        color: #fff;
        text-shadow: 0 0 5px rgba(255,255,255,0.3);
    }
    #memberPage .return-btn {
        background: #9400d3; /* Purple button */
        box-shadow: 0 4px 8px rgba(148, 0, 211, 0.4);
    }
    #memberPage .return-btn:hover {
        background: #af00ff; /* Lighter purple on hover */
    }


    /* Boyle's Law mode: Revert background */
    #boyle {
        background-color: #111; /* Reverted to default dark background */
        background-image: none; /* Removed grid pattern */
        background-repeat: unset;
        background-size: unset;
    }
    /* Gay-Lussac mode: Specific container styling for fixed volume */
    #gayLussac .container {
        background: #333; /* Darker background for fixed container */
        border: 4px solid #4a90e2; /* Blue border for a "sealed" look */
        box-shadow: 0 0 15px rgba(74, 144, 226, 0.6); /* Blue glow */
    }
    #gayLussacCanvas {
        background: none; /* Make canvas background transparent to show container bg */
        width: 100%; /* Make canvas fill container */
        height: 100%; /* Make canvas fill container */
        flex-grow: 1; /* Allow canvas to take available space */
    }

    /* New style for all game mode titles */
    .game-mode-title {
        font-weight: 600;
        font-size: 2.8rem; /* Slightly smaller than main menu h1 */
        margin-bottom: 38px; /* Approx 1cm */
        text-align: center;
        /* Rainbow text effect (default for other modes) */
        background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
        background-size: 200% 100%;
        animation: rainbowBackground 3s linear infinite;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        color: transparent; /* Fallback for browsers not supporting text-fill-color */
        z-index: 100;
    }
    /* Specific styles for Gay-Lussac title - a more "scientific/glowing" look */
    .gaylussac-title-glow {
        background: none;
        -webkit-background-clip: unset;
        background-clip: unset;
        -webkit-text-fill-color: unset;
        color: #4a90e2; /* Blue color */
        animation: none;
        text-shadow: 0 0 8px rgba(74, 144, 226, 0.8),
                     0 0 15px rgba(74, 144, 226, 0.6),
                     0 0 25px rgba(74, 144, 226, 0.4);
    }

    .container {
      background: #222;
      border-radius: 12px;
      padding: 20px;
      /* Responsive container for canvas/balloon */
      width: 90vw;
      height: 70vh;
      max-width: 400px; /* Limit max size */
      max-height: 400px; /* Limit max size */
      min-width: 280px; /* Ensure minimum size on small screens */
      min-height: 280px; /* Ensure minimum size on small screens */
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between; /* Distribute items vertically */
      align-items: center;
      box-sizing: border-box; /* Include padding in width/height */
    }

    .return-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background: #ff5a5f;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      align-self: center;
      width: 140px;
    }

    /* Shared game elements */
    .slider-container {
      margin: 15px 0;
      width: 300px; /* Fixed width, consider making this responsive too */
      max-width: 90vw; /* Responsive for small screens */
      color: #ff5a5f;
    }
    .slider-container label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }
    input[type=range] {
      width: 100%;
    }
    .balloon-container {
      position: relative;
      width: 250px;
      height: 180px; /* This height helps contain the balloon below title and above button */
      margin: 10px auto;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-grow: 1; /* Allow container to take available space */
      min-height: 150px; /* Ensure minimum height even when balloon is small */
    }
    .balloon {
      background: radial-gradient(circle at 25% 25%, #ffbaba, #ff7a7f 30%, #ff5a5f 60%, #cc0000 100%);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      /* Removed 'transform' from transition to allow animation to control it fully */
      transition: width 0.3s, height 0.3s, background 0.3s, box-shadow 0.3s;
      position: relative;
      z-index: 10;
      animation: floatUpDown 3s ease-in-out infinite alternate;
    }
    /* Keyframes for floating animation */
    @keyframes floatUpDown {
      0% { transform: translateY(0px); }
      100% { transform: translateY(-10px); } /* Floats up 10px */
    }

    /* ::after PSEUDO-ELEMENT FOR THE BALLOON NECK */
    .balloon::after {
      content: '';
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 15px;
      height: 20px;
      background-color: #cc0000;
      border-radius: 0 0 5px 5px;
      z-index: 9;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }

    .molecule-teller-bg, .molecule-counter {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      text-shadow: 0 0 10px rgba(255,255,255,0.7);
      user-select: none;
      font-weight: 900;
      z-index: 1;
    }
    .molecule-teller-bg {
      font-size: 180px;
      font-weight: 900;
      opacity: 0.1;
      letter-spacing: 20px;
    }
    .molecule-counter {
      font-size: 24px;
      font-weight: 600;
      top: 20px;
      left: 20px;
      transform: none;
      text-shadow: none;
      color: white;
      z-index: 100;
    }

    /* Avogadro specifics */
    .avogadro-increase-btn {
      background: #ff5a5f;
      border: none;
      border-radius: 30px;
      color: white;
      font-size: 1.3rem;
      padding: 12px 30px;
      cursor: pointer;
      display: block;
      margin-top: auto; /* Push button to bottom, maintaining space */
      box-shadow: 0 3px 7px rgba(255, 90, 95, 0.5);
      transition: background-color .3s;
      user-select: none;
    }
    .avogadro-increase-btn:hover {
      background: #ff7a7f;
    }

    /* Pop animation for main balloon */
    @keyframes betterPopAnimation {
      0% { transform: scale(1); opacity: 1; border-radius: 50% / 60%; }
      30% { transform: scale(1.5); opacity: 0.8; background-color: rgba(255, 50, 50, 0.9); } /* Zoom in slightly, more visible color change */
      60% { transform: scale(2); opacity: 0.4; } /* Zoom significantly, start fading */
      100% { transform: scale(2.2); opacity: 0; border-radius: 50%; } /* Zoom out slightly more while fully faded */
    }
    .pop {
      animation: betterPopAnimation 0.6s forwards ease-out; /* Keep duration and timing */
    }

    /* Pop animation for balloon neck */
    .pop::after {
      content: ''; /* Must be present */
      animation: popNeckAnimation 0.6s forwards ease-out; /* Match parent animation */
    }
    @keyframes popNeckAnimation {
      0% { transform: translateX(-50%) scale(1); opacity: 1; }
      30% { transform: translateX(-50%) scale(1.5); opacity: 0.8; } /* Mirror main balloon zoom */
      60% { transform: translateX(-50%) scale(2); opacity: 0.4; } /* Mirror main balloon zoom and fade */
      100% { transform: translateX(-50%) scale(2.2); opacity: 0; } /* Mirror main balloon fade */
    }


    /* Rainbow button styles */
    .rainbow-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none; /* Hidden by default */
      padding: 15px 30px;
      font-size: 1.5rem;
      font-weight: 600;
      color: white;
      border: none;
      border-radius: 50px; /* Pill shape */
      cursor: pointer;
      text-align: center;
      white-space: nowrap; /* Prevent text wrapping */

      /* Crucial: Increase z-index to ensure clickability */
      z-index: 100; /* Higher than molecule-teller-bg (z-index 1) and balloon (z-index 10) */

      /* Rainbow Gradient */
      background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
      background-size: 200% 100%; /* For animation */
      animation: rainbowBackground 3s linear infinite; /* Animates the gradient */

      /* LED Glow Effect */
      box-shadow: 0 0 10px #ff00ff, /* Magenta */
                  0 0 20px #00ffff, /* Cyan */
                  0 0 30px #ffff00; /* Yellow */
      transition: box-shadow 0.3s ease-in-out;
    }

    .rainbow-button:hover {
        box-shadow: 0 0 15px #ff00ff,
                    0 0 30px #00ffff,
                    0 0 45px #ffff00,
                    0 0 60px #ff00ff; /* Stronger glow on hover */
    }

    @keyframes rainbowBackground {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }

    /* Specific styles for Boyle's Law title glowing effect */
    .boyle-title-glow {
        background: none; /* Ensure no rainbow background here */
        -webkit-background-clip: unset;
        background-clip: unset;
        -webkit-text-fill-color: unset;
        color: #FFD700; /* Golden color */
        animation: none; /* No background animation */

        /* Golden LED Glowing Effect for text */
        text-shadow: 0 0 8px rgba(255, 215, 0, 0.8),   /* Pure gold glow */
                     0 0 15px rgba(255, 223, 0, 0.6),  /* Lighter gold glow */
                     0 0 25px rgba(255, 204, 0, 0.4),  /* Soft gold glow */
                     0 0 35px rgba(200, 150, 0, 0.2);  /* Deeper amber glow for spread */
        -webkit-text-stroke: 1px rgba(255,255,255,0.05); /* Very subtle white stroke for definition */
    }

    /* Canvas sizing for Boyle mode */
    #boyleCanvas {
        width: 100%; /* Make canvas fill container */
        height: 100%; /* Make canvas fill container */
        background:#222;
        border-radius:12px;
        flex-grow: 1; /* Allow canvas to take available space */
    }

    /* Text for explanations in game modes */
    .explanation-text {
        font-size: 1.1rem;
        text-align: center;
        margin-bottom: 20px;
        max-width: 600px;
        line-height: 1.5;
        color: #ddd;
    }
    .explanation-text strong {
        color: #fff;
    }
    .gaylussac-explanation {
        color: #4a90e2; /* Blue to match Gay-Lussac theme */
        text-shadow: 0 0 5px rgba(74, 144, 226, 0.5);
    }
    .slider-label-explanation {
        font-size: 0.9rem;
        margin-top: 5px;
        margin-bottom: 10px;
        color: #a0a0a0; /* Lighter grey for descriptions */
    }
    .slider-label-explanation strong {
        color: #eee;
    }

    /* Media Queries for better mobile responsiveness */
    @media (max-width: 600px) {
        #mainMenu h1 {
            font-size: 2.5rem;
            letter-spacing: 3px;
        }
        #mainMenu h3 {
            font-size: 1rem;
        }
        #mainMenu button {
            font-size: 1.2rem;
            padding: 12px 60px;
            margin: 8px 0;
        }
        .game-mode-title {
            font-size: 2rem;
            margin-bottom: 20px;
        }
        .container {
            width: 95vw;
            height: 60vh;
            max-width: 320px;
            max-height: 320px;
            padding: 15px;
        }
        .slider-container {
            width: 95vw;
            max-width: 280px;
            margin: 10px 0;
        }
        .avogadro-increase-btn, .rainbow-button {
            font-size: 1rem;
            padding: 10px 20px;
        }
        #memberPage h2 {
            font-size: 2.2rem;
        }
        #memberPage li {
            font-size: 1.2rem;
            margin: 10px 0;
        }
        .explanation-text, .slider-label-explanation {
            font-size: 0.85rem;
            margin-bottom: 15px;
        }

        /* MODIFIED: Adjusted member page layout for small screens */
        #memberPage pre {
            font-size: 18px;
            white-space: pre-wrap; /* Now wraps text */
            line-height: 1.4;
            text-align: center;
        }
        #memberPage h2 {
            font-size: 2.5rem;
        }
        #memberPage .return-btn {
            font-size: 1rem;
            padding: 10px 20px;
        }
    }

  </style>
</head>
<body>
  <canvas id="particleCanvas"></canvas>

  <div id="mainMenu">
    <h1>Gas Laws</h1>
    <h3>Click on the Buttons Below to Learn More!</h3>
    <button onclick="showMode('boyle')">Boyle's Law</button>
    <button onclick="showMode('gayLussac')">Gay-Lussac's Law</button>
    <button onclick="showMode('avogadro')">Avogadro's Law</button>
    <button onclick="showMode('memberPage')">Members</button>
  </div>

  <div id="boyle" class="gameMode">
    <h2 class="game-mode-title boyle-title-glow">Boyle's Law</h2>
    <p class="explanation-text">Boyle's Law describes the relationship between the <strong>pressure</strong> and <strong>volume</strong> of a gas. As the pressure increases, the volume decreases, and vice versa. Use the slider below to change the volume of the container and see what happens to the gas particles and pressure.</p>
    <div class="container">
        <canvas id="boyleCanvas"></canvas>
    </div>
    <div class="slider-container">
        <label for="volumeSlider">Volume: <span id="volumeValue"></span> units</label>
        <input type="range" id="volumeSlider" min="150" max="450" value="300" step="1">
        <p class="slider-label-explanation">Slide to change the volume.</p>
    </div>
    <button onclick="hideAllModes()" class="return-btn">Return to Main Menu</button>
  </div>

  <div id="gayLussac" class="gameMode">
    <h2 class="game-mode-title gaylussac-title-glow">Gay-Lussac's Law</h2>
    <p class="explanation-text gaylussac-explanation">Gay-Lussac's Law describes the relationship between the <strong>pressure</strong> and <strong>temperature</strong> of a gas when the volume is held constant. As the temperature of the gas increases, so does the pressure. Use the slider below to change the temperature and observe the effect on the gas particles and pressure.</p>
    <div class="container">
      <canvas id="gayLussacCanvas"></canvas>
    </div>
    <div class="slider-container">
        <label for="temperatureSlider">Temperature: <span id="temperatureValue"></span> K</label>
        <input type="range" id="temperatureSlider" min="50" max="600" value="300">
        <p class="slider-label-explanation">Slide to change the temperature.</p>
    </div>
    <button onclick="hideAllModes()" class="return-btn">Return to Main Menu</button>
  </div>

  <div id="avogadro" class="gameMode">
    <h2 class="game-mode-title">Avogadro's Law</h2>
    <p class="explanation-text">Avogadro's Law states that the volume of a gas is directly proportional to the number of moles (or molecules) of the gas at a constant temperature and pressure. The more gas you add, the more volume it takes up. Try clicking and holding the button to add molecules to the balloon. Don't add too many or it will pop! ðŸŽˆ</p>
    <div class="container" style="background: none; border: none; box-shadow: none;">
      <div class="balloon-container">
        <div id="avogadroBalloon" class="balloon"></div>
        <p class="molecule-teller-bg">MOLES</p>
        <p id="moleculeCounter" class="molecule-counter">Molecules: 0</p>
        <button id="getNewOneBtn" class="rainbow-button">Get a New Balloon</button>
      </div>
    </div>
    <button id="increaseMoleculeBtn" class="avogadro-increase-btn">Add Molecules</button>
    <button onclick="hideAllModes()" class="return-btn">Return to Main Menu</button>
  </div>

  <div id="memberPage">
    <h2>Members</h2>
    <pre>
      Name: Joshua Christian G. Cabarrubias
      Role: Leader
      
      Name: Aldrin V. Escordial
      Role: Member
      
      Name: Adrian V. Gador
      Role: Member
      
      Name: Justine Grace V. Escordial
      Role: Member
      
      Name: Justine R. Lape
      Role: Member
      
      Name: John Carlo V. Escobido
      Role: Member
    </pre>
    <button onclick="hideAllModes()" class="return-btn">Return to Main Menu</button>
  </div>

  <script>
    // Particle effects for main menu
    const particleCanvas = document.getElementById('particleCanvas');
    const ctx = particleCanvas.getContext('2d');
    let particles = [];
    const particleCount = 200;

    function resizeCanvas() {
        particleCanvas.width = window.innerWidth;
        particleCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    class Particle {
        constructor() {
            this.x = Math.random() * particleCanvas.width;
            this.y = Math.random() * particleCanvas.height;
            this.size = Math.random() * 2 + 1;
            this.speedX = Math.random() * 0.5 - 0.25;
            this.speedY = Math.random() * 0.5 - 0.25;
            this.color = `hsl(${Math.random() * 360}, 100%, 70%)`;
        }
        update() {
            this.x += this.speedX;
            this.y += this.speedY;
            if (this.size > 0.2) this.size -= 0.01;
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    function createParticles() {
        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }
    }

    function handleParticles() {
        for (let i = 0; i < particles.length; i++) {
            particles[i].update();
            particles[i].draw();
            if (particles[i].size <= 0.3) {
                particles.splice(i, 1);
                i--;
                particles.push(new Particle());
            }
        }
    }

    function animateParticles() {
        ctx.clearRect(0, 0, particleCanvas.width, particleCanvas.height);
        handleParticles();
        requestAnimationFrame(animateParticles);
    }

    createParticles();
    animateParticles();

    // Game Mode Management
    const mainMenu = document.getElementById('mainMenu');
    const gameModes = document.querySelectorAll('.gameMode');
    const memberPage = document.getElementById('memberPage');
    let activeMode = null;

    function hideAllModes() {
      mainMenu.style.display = 'flex';
      gameModes.forEach(mode => mode.style.display = 'none');
      memberPage.style.display = 'none';
      activeMode = null;
    }

    function showMode(modeId) {
      hideAllModes();
      mainMenu.style.display = 'none';
      if (modeId === 'memberPage') {
        memberPage.style.display = 'flex';
        initMemberPage();
      } else {
        const selectedMode = document.getElementById(modeId);
        if (selectedMode) {
          selectedMode.style.display = 'flex';
          activeMode = modeId;
          initMode(modeId);
        }
      }
    }

    function initMode(modeId) {
      if (modeId === 'boyle') {
        initBoyle();
      } else if (modeId === 'gayLussac') {
        initGayLussac();
      } else if (modeId === 'avogadro') {
        initAvogadro();
      }
    }

    // Boyle's Law
    const boyleCanvas = document.getElementById('boyleCanvas');
    const boyleCtx = boyleCanvas.getContext('2d');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeValueSpan = document.getElementById('volumeValue');
    const PARTICLE_RADIUS_BOYLE = 4;
    const PARTICLE_COUNT_BOYLE = 50;
    const PARTICLE_SPEED_BOYLE = 1.5;
    let boyleParticles = [];
    let animationFrameIdBoyle;
    let volume = 300;

    class BoyleParticle {
        constructor(x, y, vx, vy) {
            this.x = x;
            this.y = y;
            this.vx = vx;
            this.vy = vy;
            this.color = 'rgb(255, 128, 128)';
            this.radius = PARTICLE_RADIUS_BOYLE;
        }

        update() {
            this.x += this.vx;
            this.y += this.vy;
        }
        draw(ctx) {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
        }
    }

    function initBoyle() {
        boyleCanvas.width = boyleCanvas.parentElement.clientWidth;
        boyleCanvas.height = boyleCanvas.parentElement.clientHeight;
        volume = parseInt(volumeSlider.value);
        volumeValueSpan.textContent = volume;
        boyleParticles = [];
        for (let i = 0; i < PARTICLE_COUNT_BOYLE; i++) {
            let x = Math.random() * boyleCanvas.width;
            let y = Math.random() * boyleCanvas.height;
            let angle = Math.random() * Math.PI * 2;
            let vx = Math.cos(angle) * PARTICLE_SPEED_BOYLE;
            let vy = Math.sin(angle) * PARTICLE_SPEED_BOYLE;
            boyleParticles.push(new BoyleParticle(x, y, vx, vy));
        }
        if (animationFrameIdBoyle) cancelAnimationFrame(animationFrameIdBoyle);
        animateBoyle();
    }

    function handleBoyleCollisions() {
      const containerWidth = boyleCanvas.width;
      const containerHeight = boyleCanvas.height;

      boyleParticles.forEach(p => {
        // Wall collisions
        if (p.x - p.radius < 0 || p.x + p.radius > containerWidth) {
          p.vx = -p.vx;
          p.x = Math.max(p.radius, Math.min(p.x, containerWidth - p.radius));
        }
        if (p.y - p.radius < 0 || p.y + p.radius > containerHeight) {
          p.vy = -p.vy;
          p.y = Math.max(p.radius, Math.min(p.y, containerHeight - p.radius));
        }

        // Particle-particle collisions (simplified)
        for (const otherP of boyleParticles) {
            if (p === otherP) continue;
            const dx = p.x - otherP.x;
            const dy = p.y - otherP.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < p.radius + otherP.radius) {
                // Swap velocities (simplified elastic collision)
                const tempVx = p.vx;
                const tempVy = p.vy;
                p.vx = otherP.vx;
                p.vy = otherP.vy;
                otherP.vx = tempVx;
                otherP.vy = tempVy;

                // Move particles apart to prevent sticking
                const overlap = (p.radius + otherP.radius) - distance;
                const pushX = (dx / distance) * overlap / 2;
                const pushY = (dy / distance) * overlap / 2;
                p.x += pushX;
                p.y += pushY;
                otherP.x -= pushX;
                otherP.y -= pushY;
            }
        }
      });
    }

    function animateBoyle() {
      boyleCanvas.width = boyleCanvas.parentElement.clientWidth;
      boyleCanvas.height = boyleCanvas.parentElement.clientHeight;

      boyleCtx.clearRect(0, 0, boyleCanvas.width, boyleCanvas.height);
      boyleParticles.forEach(p => {
        p.update();
        p.draw(boyleCtx);
      });
      handleBoyleCollisions();
      animationFrameIdBoyle = requestAnimationFrame(animateBoyle);
    }

    volumeSlider.addEventListener('input', (e) => {
      const newVolume = parseInt(e.target.value);
      volumeValueSpan.textContent = newVolume;
      boyleCanvas.parentElement.style.width = newVolume + 'px';
      boyleCanvas.parentElement.style.height = newVolume + 'px';
      boyleCanvas.width = newVolume;
      boyleCanvas.height = newVolume;
    });

    // Gay-Lussac's Law
    const gayLussacCanvas = document.getElementById('gayLussacCanvas');
    const gayLussacCtx = gayLussacCanvas.getContext('2d');
    const temperatureSlider = document.getElementById('temperatureSlider');
    const temperatureValueSpan = document.getElementById('temperatureValue');
    const PARTICLE_COUNT_GAYLUSSAC = 50;
    const PARTICLE_RADIUS_GAYLUSSAC = 4;
    let gayLussacParticles = [];
    let animationFrameIdGayLussac;
    let currentTemperature = 300;

    class GayLussacParticle {
        constructor(x, y, vx, vy) {
            this.x = x;
            this.y = y;
            this.vx = vx;
            this.vy = vy;
            this.color = 'rgb(128, 128, 255)';
            this.radius = PARTICLE_RADIUS_GAYLUSSAC;
        }

        update(speed) {
            this.x += this.vx * speed;
            this.y += this.vy * speed;
        }
        draw(ctx) {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
        }
    }

    function initGayLussac() {
        gayLussacCanvas.width = gayLussacCanvas.parentElement.clientWidth;
        gayLussacCanvas.height = gayLussacCanvas.parentElement.clientHeight;
        currentTemperature = parseInt(temperatureSlider.value);
        temperatureValueSpan.textContent = currentTemperature;

        gayLussacParticles = [];
        for (let i = 0; i < PARTICLE_COUNT_GAYLUSSAC; i++) {
            let x = Math.random() * gayLussacCanvas.width;
            let y = Math.random() * gayLussacCanvas.height;
            let angle = Math.random() * Math.PI * 2;
            let vx = Math.cos(angle);
            let vy = Math.sin(angle);
            gayLussacParticles.push(new GayLussacParticle(x, y, vx, vy));
        }

        if (animationFrameIdGayLussac) cancelAnimationFrame(animationFrameIdGayLussac);
        animateGayLussac();
    }

    function handleGayLussacCollisions() {
        const containerWidth = gayLussacCanvas.width;
        const containerHeight = gayLussacCanvas.height;
        const speed = currentTemperature / 100;

        gayLussacParticles.forEach(p => {
            // Wall collisions
            if (p.x - p.radius < 0 || p.x + p.radius > containerWidth) {
                p.vx = -p.vx;
                p.x = Math.max(p.radius, Math.min(p.x, containerWidth - p.radius));
            }
            if (p.y - p.radius < 0 || p.y + p.radius > containerHeight) {
                p.vy = -p.vy;
                p.y = Math.max(p.radius, Math.min(p.y, containerHeight - p.radius));
            }
        });
    }

    function animateGayLussac() {
        gayLussacCtx.clearRect(0, 0, gayLussacCanvas.width, gayLussacCanvas.height);
        const speed = currentTemperature / 100;
        gayLussacParticles.forEach(p => {
            p.update(speed);
            p.draw(gayLussacCtx);
        });
        handleGayLussacCollisions();
        animationFrameIdGayLussac = requestAnimationFrame(animateGayLussac);
    }

    temperatureSlider.addEventListener('input', (e) => {
        currentTemperature = parseInt(e.target.value);
        temperatureValueSpan.textContent = currentTemperature;
    });

    // Avogadro's Law
    const avogadroBalloon = document.getElementById('avogadroBalloon');
    const moleculeCounter = document.getElementById('moleculeCounter');
    const increaseMoleculeBtn = document.getElementById('increaseMoleculeBtn');
    const getNewOneBtn = document.getElementById('getNewOneBtn');

    const MAX_MOLECULES = 1000;
    let avogadroMolecules = 0;
    let increaseInterval = null;

    function initAvogadro() {
        avogadroMolecules = 0;
        avogadroBalloon.style.display = 'block';
        avogadroBalloon.style.width = '50px';
        avogadroBalloon.style.height = '50px';
        avogadroBalloon.classList.remove('pop');
        increaseMoleculeBtn.style.display = 'block';
        getNewOneBtn.style.display = 'none';
        updateAvogadroDisplay();
    }

    function updateAvogadroDisplay() {
        if (avogadroMolecules < 0) avogadroMolecules = 0;
        if (avogadroMolecules > MAX_MOLECULES) avogadroMolecules = MAX_MOLECULES;

        const size = 50 + avogadroMolecules * 0.3; // Simple scaling logic
        avogadroBalloon.style.width = size + 'px';
        avogadroBalloon.style.height = size + 'px';

        moleculeCounter.textContent = `Molecules: ${avogadroMolecules}`;

        if (avogadroMolecules >= MAX_MOLECULES) {
            if (!avogadroBalloon.classList.contains('pop')) {
                avogadroBalloon.classList.add('pop');
                setTimeout(() => {
                    avogadroBalloon.style.display = 'none';
                    avogadroBalloon.classList.remove('pop');
                    getNewOneBtn.style.display = 'block';
                }, 600); // Duration of pop animation
            }
            increaseMoleculeBtn.style.display = 'none';
        }
    }

    function increaseMassStep() {
      if (avogadroBalloon.classList.contains('pop') || avogadroMolecules >= MAX_MOLECULES) {
          clearInterval(increaseInterval);
          return;
      }
      avogadroMolecules++;
      updateAvogadroDisplay();
    }

    function startIncrease() {
        if (increaseInterval) return;
        increaseMassStep();
        increaseInterval = setInterval(increaseMassStep, 100);
    }

    function stopIncrease() {
        clearInterval(increaseInterval);
        increaseInterval = null;
    }

    getNewOneBtn.addEventListener('click', () => {
        initAvogadro();
    });

    increaseMoleculeBtn.addEventListener('mousedown', startIncrease);
    increaseMoleculeBtn.addEventListener('mouseup', stopIncrease);
    increaseMoleculeBtn.addEventListener('mouseleave', stopIncrease);

    increaseMoleculeBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        startIncrease();
    }, { passive: false });

    increaseMoleculeBtn.addEventListener('touchend', stopIncrease);
    increaseMoleculeBtn.addEventListener('touchcancel', stopIncrease);

    function cancelAvogadroIncrease() {
        stopIncrease();
        increaseMoleculeBtn.removeEventListener('mousedown', startIncrease);
        increaseMoleculeBtn.removeEventListener('mouseup', stopIncrease);
        increaseMoleculeBtn.removeEventListener('mouseleave', stopIncrease);
        increaseMoleculeBtn.removeEventListener('touchstart', (e) => { e.preventDefault(); startIncrease(); }, { passive: false });
        increaseMoleculeBtn.removeEventListener('touchend', stopIncrease);
        increaseMoleculeBtn.removeEventListener('touchcancel', stopIncrease);
    }

    // Member Page
    function initMemberPage() {
        // Any setup for the member page can go here
    }

  </script>
</body>
</html>
