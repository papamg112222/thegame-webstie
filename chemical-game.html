<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gas Laws Game - Full Gameplay</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&display=swap');

  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Montserrat', sans-serif;
    background: #1a0a3a;
    overflow: hidden;
    color: white;
  }

  #particleCanvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    z-index: 0;
    pointer-events: none;
  }

  /* MAIN MENU */
  #mainMenu {
    position: relative;
    z-index: 1;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: #ff5a5f;
  }

  #mainMenu h1 {
    font-weight: 600;
    font-size: 4rem;
    margin-bottom: 0.3em;
    letter-spacing: 5px;
  }

  #mainMenu h3 {
    font-weight: 300;
    font-size: 1.2rem;
    margin-bottom: 2em;
    letter-spacing: 2px;
    color: #ff7a7f;
  }

  #mainMenu button {
    background-color: #ff5a5f;
    border: none;
    border-radius: 50px;
    color: white;
    font-weight: 300;
    font-size: 1.5rem;
    padding: 16px 80px;
    margin: 12px 0;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(255, 90, 95, 0.4);
    transition: background-color 0.3s ease;
  }

  #mainMenu button:hover {
    background-color: #ff7a7f;
  }

  /* GAME MODES CONTAINERS */
  .gameMode {
    display: none;
    position: relative;
    z-index: 2;
    height: 100vh;
    padding: 20px;
    box-sizing: border-box;
    background: #111;
    color: white;
    overflow-y: auto;
  }

  .gameMode.active {
    display: block;
  }

  /* Shared styles for balloons and molecule teller */
  .balloon-container {
    position: relative;
    width: 220px;
    height: 280px;
    margin: 20px auto;
  }
  .balloon {
    width: 100px;
    height: 150px;
    background: #ff5a5f;
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    margin: 0 auto;
    position: relative;
    transition: width 0.3s ease, height 0.3s ease, background-color 0.4s ease;
    box-shadow: 0 0 15px rgba(255,90,95,0.5);
  }
  .molecule-counter {
    position: absolute;
    top: 10px; left: 50%;
    transform: translateX(-50%);
    font-size: 48px;
    font-weight: 600;
    color: white;
    user-select: none;
    pointer-events: none;
    text-shadow: 0 0 10px rgba(255,255,255,0.7);
  }
  .molecule-teller-bg {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    user-select: none;
    opacity: 0.1;
    font-size: 200px;
    font-weight: 900;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    letter-spacing: 20px;
  }

  /* Slider styling */
  .slider-container {
    margin: 20px auto;
    width: 320px;
    color: #ff5a5f;
  }
  .slider-container label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
  }
  input[type=range] {
    width: 100%;
  }

  /* Pop animation */
  @keyframes popAnimation {
    0% { transform: scale(1); opacity: 1;}
    50% { transform: scale(1.4); opacity: 0.8;}
    100% { transform: scale(0); opacity: 0;}
  }
  .pop {
    animation: popAnimation 0.5s forwards;
  }

  /* Nice button for Avogadro size increase */
  .avogadro-increase-btn {
    background-color: #ff5a5f;
    border: none;
    border-radius: 30px;
    color: white;
    font-size: 1.3rem;
    padding: 12px 30px;
    cursor: pointer;
    box-shadow: 0 3px 7px rgba(255, 90, 95, 0.5);
    transition: background-color 0.3s ease;
    margin: 10px auto;
    display: block;
  }
  .avogadro-increase-btn:hover {
    background-color: #ff7a7f;
  }

  /* Game mode headings */
  .gameMode h2 {
    text-align: center;
    font-weight: 600;
    color: #ff5a5f;
    margin-bottom: 15px;
  }

  /* Display values area */
  .value-display {
    width: 320px;
    margin: 15px auto;
    color: #ff5a5f;
    font-weight: 600;
    font-size: 1.2rem;
    text-align: center;
  }

  /* Return to menu button */
  .return-btn {
    display: block;
    margin: 30px auto 10px;
    padding: 12px 40px;
    font-size: 1.2rem;
    background: #ff5a5f;
    color: white;
    border: none;
    border-radius: 40px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(255, 90, 95, 0.5);
    transition: background-color 0.3s ease;
  }
  .return-btn:hover {
    background-color: #ff7a7f;
  }

</style>
</head>
<body>

<canvas id="particleCanvas"></canvas>

<!-- MAIN MENU -->
<div id="mainMenu">
  <h1>GAS LAWS GAME</h1>
  <h3>Main Menu</h3>
  <button onclick="startGame('boyle')">Boyle's Law</button>
  <button onclick="startGame('charles')">Charles' Law</button>
  <button onclick="startGame('gayLussac')">Gay-Lussac's Law</button>
  <button onclick="startGame('avogadro')">Avogadro's Law</button>
</div>

<!-- BOYLE'S LAW -->
<div id="boyleMode" class="gameMode">
  <h2>Boyle's Law (P × V = constant)</h2>

  <div class="slider-container">
    <label>Volume: <span id="boyleVolumeVal">50</span></label>
    <input type="range" id="boyleVolume" min="10" max="100" value="50" />
  </div>
  <div class="slider-container">
    <label>Mass (Molecules): <span id="boyleMassVal">10</span></label>
    <input type="range" id="boyleMass" min="1" max="20" value="10" />
  </div>
  <div class="slider-container">
    <label>Temperature (°C): <span id="boyleTempVal">20</span></label>
    <input type="range" id="boyleTemp" min="0" max="100" value="20" />
  </div>

  <div class="balloon-container">
    <div id="boyleBalloon" class="balloon"></div>
    <div id="boyleMoleculeCount" class="molecule-counter"></div>
  </div>

  <div class="value-display" id="boylePressureDisplay">Pressure: -- kPa</div>

  <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
</div>

<!-- CHARLES' LAW -->
<div id="charlesMode" class="gameMode">
  <h2>Charles' Law (V ∝ T)</h2>

  <div class="slider-container">
    <label>Temperature (°C): <span id="charlesTempVal">20</span></label>
    <input type="range" id="charlesTemp" min="-100" max="100" value="20" />
  </div>

  <div class="balloon-container">
    <div id="charlesBalloon" class="balloon"></div>
    <div id="charlesMoleculeBg" class="molecule-teller-bg">50</div>
  </div>

  <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
</div>

<!-- GAY-LUSSAC'S LAW -->
<div id="gayLussacMode" class="gameMode">
  <h2>Gay-Lussac's Law (P ∝ T)</h2>

  <div class="slider-container">
    <label>Pressure (kPa): <span id="gayLussacPressureVal">1</span></label>
    <input type="range" id="gayLussacPressure" min="1" max="10" value="1" />
  </div>
  <div class="slider-container">
    <label>Temperature (°C): <span id="gayLussacTempVal">20</span></label>
    <input type="range" id="gayLussacTemp" min="0" max="100" value="20" />
  </div>

  <div class="balloon-container">
    <div id="gayLussacBalloon" class="balloon"></div>
  </div>

  <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
</div>

<!-- AVOGADRO'S LAW -->
<div id="avogadroMode" class="gameMode">
  <h2>Avogadro's Law (V ∝ n)</h2>

  <button id="increaseMoleculeBtn" class="avogadro-increase-btn">Add Molecule</button>

  <div class="balloon-container">
    <div id="avogadroBalloon" class="balloon"></div>
    <div id="avogadroMoleculeCount" class="molecule-counter"></div>
    <div id="avogadroMoleculeBg" class="molecule-teller-bg">0</div>
  </div>

  <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
</div>

<audio id="popSound" src="https://freesound.org/data/previews/341/341695_3248244-lq.mp3" preload="auto"></audio>

<script>
  // PARTICLE BACKGROUND (Falling chemistry shapes)
  const canvas = document.getElementById('particleCanvas');
  const ctx = canvas.getContext('2d');
  let particles = [];

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // Chemistry shapes falling
  class Particle {
    constructor() {
      this.reset();
    }
    reset() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * -canvas.height;
      this.size = 12 + Math.random() * 10;
      this.speed = 1 + Math.random() * 2;
      this.type = Math.floor(Math.random() * 4); // 0=atom,1=beaker,2=molecule,3=flask
      this.angle = Math.random() * 2 * Math.PI;
      this.angularSpeed = 0.01 + Math.random() * 0.03;
      this.color = '#ff5a5f';
    }
    update() {
      this.y += this.speed;
      this.angle += this.angularSpeed;
      if (this.y > canvas.height + this.size) {
        this.reset();
      }
    }
    draw() {
      ctx.save();
      ctx.translate(this.x, this.y);
      ctx.rotate(this.angle);
      ctx.fillStyle = this.color;
      switch(this.type) {
        case 0: // atom: circle with nucleus
          ctx.beginPath();
          ctx.arc(0, 0, this.size/2, 0, 2 * Math.PI);
          ctx.fill();
          ctx.fillStyle = 'white';
          ctx.beginPath();
          ctx.arc(0, 0, this.size/6, 0, 2 * Math.PI);
          ctx.fill();
          break;
        case 1: // beaker shape
          ctx.beginPath();
          ctx.moveTo(-this.size/2, this.size/2);
          ctx.lineTo(this.size/2, this.size/2);
          ctx.lineTo(this.size/4, -this.size/2);
          ctx.lineTo(-this.size/4, -this.size/2);
          ctx.closePath();
          ctx.fill();
          break;
        case 2: // molecule shape (two connected circles)
          ctx.beginPath();
          ctx.arc(-this.size/4, 0, this.size/4, 0, 2 * Math.PI);
          ctx.arc(this.size/4, 0, this.size/4, 0, 2 * Math.PI);
          ctx.fill();
          break;
        case 3: // flask shape
          ctx.beginPath();
          ctx.moveTo(0, -this.size/2);
          ctx.lineTo(this.size/3, this.size/2);
          ctx.lineTo(-this.size/3, this.size/2);
          ctx.closePath();
          ctx.fill();
          break;
      }
      ctx.restore();
    }
  }

  for(let i = 0; i < 60; i++) {
    particles.push(new Particle());
  }

  function animateParticles() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let p of particles) {
      p.update();
      p.draw();
    }
    requestAnimationFrame(animateParticles);
  }
  animateParticles();

  // MAIN MENU & GAME MODE LOGIC
  const mainMenu = document.getElementById('mainMenu');
  const modes = {
    boyle: document.getElementById('boyleMode'),
    charles: document.getElementById('charlesMode'),
    gayLussac: document.getElementById('gayLussacMode'),
    avogadro: document.getElementById('avogadroMode')
  };

  function hideAllModes() {
    for (let key in modes) {
      modes[key].classList.remove('active');
    }
  }

  function startGame(mode) {
    mainMenu.style.display = 'none';
    hideAllModes();
    modes[mode].classList.add('active');
    if (mode === 'boyle') setupBoyle();
    if (mode === 'charles') setupCharles();
    if (mode === 'gayLussac') setupGayLussac();
    if (mode === 'avogadro') setupAvogadro();
  }

  function returnToMenu() {
    hideAllModes();
    mainMenu.style.display = 'flex';
  }

  // ------------- BOYLE'S LAW ---------------
  const boyleVolume = document.getElementById('boyleVolume');
  const boyleVolumeVal = document.getElementById('boyleVolumeVal');
  const boyleMass = document.getElementById('boyleMass');
  const boyleMassVal = document.getElementById('boyleMassVal');
  const boyleTemp = document.getElementById('boyleTemp');
  const boyleTempVal = document.getElementById('boyleTempVal');
  const boyleBalloon = document.getElementById('boyleBalloon');
  const boyleMoleculeCount = document.getElementById('boyleMoleculeCount');
  const boylePressureDisplay = document.getElementById('boylePressureDisplay');

  function setupBoyle() {
    boyleVolume.value = 50;
    boyleVolumeVal.textContent = 50;
    boyleMass.value = 10;
    boyleMassVal.textContent = 10;
    boyleTemp.value = 20;
    boyleTempVal.textContent = 20;

    updateBoyle();

    boyleVolume.oninput = () => {
      boyleVolumeVal.textContent = boyleVolume.value;
      updateBoyle();
    };
    boyleMass.oninput = () => {
      boyleMassVal.textContent = boyleMass.value;
      updateBoyle();
    };
    boyleTemp.oninput = () => {
      boyleTempVal.textContent = boyleTemp.value;
      updateBoyle();
    };
  }

  function updateBoyle() {
    const V = parseFloat(boyleVolume.value);
    const n = parseFloat(boyleMass.value);
    const T = parseFloat(boyleTemp.value) + 273.15; // Kelvin

    // Assume constant R = 8.314, P = nRT/V, simplified constants
    const R = 8.314;
    const P = (n * R * T) / V;

    boylePressureDisplay.textContent = `Pressure: ${P.toFixed(2)} kPa`;

    // Balloon size proportional to volume
    let size = 50 + (V * 1.5);
    if (size > 200) size = 200;
    if (size < 50) size = 50;
    boyleBalloon.style.width = size + 'px';
    boyleBalloon.style.height = (size * 1.5) + 'px';

    // Balloon color changes with temperature (hotter = more red)
    let tempRatio = (T - 273.15) / 100;
    tempRatio = Math.min(1, Math.max(0, tempRatio));
    boyleBalloon.style.backgroundColor = `rgba(255,${150 - tempRatio * 150},${150 - tempRatio * 150},0.9)`;

    // Molecule count displayed
    boyleMoleculeCount.textContent = `Molecules: ${n}`;

    // Balloon "speed" - simulate speed with box shadow pulsing based on temp
    const speedIntensity = 0.5 + tempRatio;
    boyleBalloon.style.boxShadow = `0 0 ${20 * speedIntensity}px rgba(255, 90, 95, ${0.3 + speedIntensity/2})`;
  }

  // ------------- CHARLES' LAW ---------------
  const charlesTemp = document.getElementById('charlesTemp');
  const charlesTempVal = document.getElementById('charlesTempVal');
  const charlesBalloon = document.getElementById('charlesBalloon');
  const charlesMoleculeBg = document.getElementById('charlesMoleculeBg');

  function setupCharles() {
    charlesTemp.value = 20;
    charlesTempVal.textContent = 20;
    updateCharles();

    charlesTemp.oninput = () => {
      charlesTempVal.textContent = charlesTemp.value;
      updateCharles();
    };
  }

  function updateCharles() {
    let T = parseInt(charlesTemp.value) + 273.15; // Kelvin

    // Volume proportional to temperature
    let baseSize = 100;
    let size = baseSize * (T / 293); // 293K ~ 20°C baseline

    if (size < 50) size = 50;
    if (size > 200) size = 200;

    charlesBalloon.style.width = size + 'px';
    charlesBalloon.style.height = (size * 1.5) + 'px';

    // Molecule teller behind balloon (fixed 50 molecules for demo)
    charlesMoleculeBg.textContent = "50";
  }

  // ------------- GAY-LUSSAC'S LAW ---------------
  const gayLussacPressureSlider = document.getElementById('gayLussacPressure');
  const gayLussacPressureVal = document.getElementById('gayLussacPressureVal');
  const gayLussacTempSlider = document.getElementById('gayLussacTemp');
  const gayLussacTempVal = document.getElementById('gayLussacTempVal');
  const gayLussacBalloon = document.getElementById('gayLussacBalloon');

  function setupGayLussac() {
    gayLussacPressureSlider.value = 1;
    gayLussacPressureVal.textContent = 1;
    gayLussacTempSlider.value = 20;
    gayLussacTempVal.textContent = 20;

    gayLussacPressureSlider.oninput = () => {
      gayLussacPressureVal.textContent = gayLussacPressureSlider.value;
      updateGayLussacBalloon();
    };
    gayLussacTempSlider.oninput = () => {
      gayLussacTempVal.textContent = gayLussacTempSlider.value;
      updateGayLussacBalloon();
    };

    updateGayLussacBalloon();
  }

  function updateGayLussacBalloon() {
    // Gay-Lussac: P/T = constant (simplified)
    let pressure = parseFloat(gayLussacPressureSlider.value);
    let temp = parseInt(gayLussacTempSlider.value) + 273.15;

    // Balloon size changes with pressure and temperature (for visual)
    let baseSize = 100;
    // simple proportional size based on pressure and temp ratio
    let size = baseSize * (pressure / 5) * (temp / 300);

    if (size < 50) size = 50;
    if (size > 180) size = 180;

    gayLussacBalloon.style.width = size + 'px';
    gayLussacBalloon.style.height = (size * 1.5) + 'px';

    // Balloon color changes with pressure for visual feedback
    let colorIntensity = Math.min(1, pressure / 10);
    gayLussacBalloon.style.backgroundColor = `rgba(255, ${90 + colorIntensity * 100}, 95, 0.8)`;
  }

  // ------------- AVOGADRO'S LAW ---------------
  const avogadroBalloon = document.getElementById('avogadroBalloon');
  const avogadroMoleculeCount = document.getElementById('avogadroMoleculeCount');
  const avogadroMoleculeBg = document.getElementById('avogadroMoleculeBg');
  const increaseMoleculeBtn = document.getElementById('increaseMoleculeBtn');
  const popSound = document.getElementById('popSound');

  let moleculeCount = 0;

  function setupAvogadro() {
    moleculeCount = 0;
    avogadroMoleculeCount.textContent = moleculeCount;
    avogadroMoleculeBg.textContent = moleculeCount;
    avogadroBalloon.style.width = '100px';
    avogadroBalloon.style.height = '150px';
    avogadroBalloon.style.backgroundColor = '#ff5a5f';

    increaseMoleculeBtn.onclick = () => {
      if(moleculeCount >= 100) return; // max count

      moleculeCount++;
      avogadroMoleculeCount.textContent = moleculeCount;
      avogadroMoleculeBg.textContent = moleculeCount;

      // Balloon size proportional to molecule count
      let size = 100 + moleculeCount * 1.5;
      if (size > 250) size = 250;
      avogadroBalloon.style.width = size + 'px';
      avogadroBalloon.style.height = (size * 1.5) + 'px';

      // If balloon gets too big, it pops
      if (size >= 240) {
        popSound.play();
        alert('The balloon popped! Try adding fewer molecules.');
        moleculeCount = 0;
        avogadroMoleculeCount.textContent = moleculeCount;
        avogadroMoleculeBg.textContent = moleculeCount;
        avogadroBalloon.style.width = '100px';
        avogadroBalloon.style.height = '150px';
      }
    };
  }
</script>

<style>
  /* Your existing styles here, plus additions for better gameplay feedback */

  .gameMode {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    padding: 20px;
    background: rgba(255,255,255,0.9);
    border-radius: 12px;
    max-width: 400px;
    margin: 20px auto;
    box-shadow: 0 0 15px #ff5a5f;
  }

  .gameMode.active {
    display: flex;
  }

  .slider-container {
    width: 100%;
  }

  .balloon-container {
    position: relative;
    width: 100%;
    height: 200px;
    margin: 10px 0;
    display: flex;
    justify-content: center;
    align-items: flex-end;
  }

  .balloon {
    background-color: #ff5a5f;
    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
    transition: all 0.3s ease;
    position: relative;
  }

  .molecule-counter {
    position: absolute;
    bottom: 15px;
    right: 15px;
    background: rgba(255, 255, 255, 0.85);
    padding: 4px 8px;
    border-radius: 10px;
    font-weight: bold;
    color: #ff5a5f;
  }

  .molecule-teller-bg {
    position: absolute;
    bottom: 10px;
    left: 10px;
    font-size: 18px;
    color: #ff5a5f;
    opacity: 0.4;
  }

  .return-btn {
    padding: 8px 15px;
    border: none;
    background-color: #ff5a5f;
    color: white;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .return-btn:hover {
    background-color: #e64b4b;
  }

  .avogadro-increase-btn {
    margin-bottom: 10px;
    padding: 10px 20px;
    background-color: #ff5a5f;
    border: none;
    color: white;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  .avogadro-increase-btn:hover {
    background-color: #e64b4b;
  }
</style>

<!-- Add gameplay description sections below each mode -->

<div id="boyleGameplay" class="gameplay-description" style="max-width:400px; margin:10px auto; font-style: italic; color:#666;">
  <strong>Gameplay:</strong> Adjust volume, mass, and temperature sliders to observe how pressure changes according to Boyle's Law (P × V = constant). The balloon size and color update dynamically to reflect changes.
</div>

<div id="charlesGameplay" class="gameplay-description" style="max-width:400px; margin:10px auto; font-style: italic; color:#666;">
  <strong>Gameplay:</strong> Move the temperature slider to see how the volume of the balloon changes proportionally with temperature, demonstrating Charles' Law (V ∝ T).
</div>

<div id="gayLussacGameplay" class="gameplay-description" style="max-width:400px; margin:10px auto; font-style: italic; color:#666;">
  <strong>Gameplay:</strong> Adjust the pressure and temperature sliders to see how pressure changes proportionally with temperature, according to Gay-Lussac's Law (P ∝ T). Watch the balloon size and color shift accordingly.
</div>

<div id="avogadroGameplay" class="gameplay-description" style="max-width:400px; margin:10px auto; font-style: italic; color:#666;">
  <strong>Gameplay:</strong> Click "Add Molecule" to increase the number of gas molecules. Observe how the balloon expands as the molecule count increases, demonstrating Avogadro's Law (V ∝ n). Be careful not to add too many molecules or the balloon will pop!
</div>
  
<!-- Connect gameplay description visibility to active mode -->
<script>
  function updateGameplayDescription(mode) {
    const gameplayDivs = document.querySelectorAll('.gameplay-description');
    gameplayDivs.forEach(div => div.style.display = 'none');

    switch(mode) {
      case 'boyle':
        document.getElementById('boyleGameplay').style.display = 'block';
        break;
      case 'charles':
        document.getElementById('charlesGameplay').style.display = 'block';
        break;
      case 'gayLussac':
        document.getElementById('gayLussacGameplay').style.display = 'block';
        break;
      case 'avogadro':
        document.getElementById('avogadroGameplay').style.display = 'block';
        break;
    }
  }

  const originalStartGame = startGame;
  startGame = (mode) => {
    originalStartGame(mode);
    updateGameplayDescription(mode);
  };
</script>
