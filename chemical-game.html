<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Laws Game</title>
    <style>
        /*
        ******************************************************************
        * IMPORTANT:                                                     *
        * PASTE ALL YOUR EXISTING CSS CODE HERE FOR THE GAME TO LOOK CORRECTLY.   *
        * This includes styles for .gameMode, .container, .balloon,      *
        * .slider-container, .rainbow-button, .pop, etc.                 *
        ******************************************************************
        */

        body {
            margin: 0;
            overflow: hidden; /* Hide scrollbars if content overflows */
            font-family: 'Arial', sans-serif;
            color: #fff;
            background-color: #333; /* Dark background for the particle canvas */
        }

        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1; /* Send to back */
        }

        #mainMenu, .gameMode {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            position: absolute; /* Position over the canvas */
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.6); /* Semi-transparent overlay */
            box-sizing: border-box; /* Include padding/border in element's total width and height */
            padding: 20px;
            text-align: center;
        }

        .gameMode {
            display: none; /* Hidden by default, shown by JS */
            padding: 20px;
            overflow-y: auto; /* Allow scrolling for content if it gets too tall */
            justify-content: flex-start; /* Align content to the top within game modes */
        }

        h1, h2, h3 {
            color: #fff;
            margin-bottom: 20px;
        }

        button {
            background-color: #ff5a5f; /* Pinkish-red from particles */
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        button:hover {
            background-color: #e04a4f;
            transform: translateY(-2px);
        }

        .return-btn {
            background-color: #4CAF50; /* Green */
            margin-top: 30px;
        }

        .return-btn:hover {
            background-color: #45a049;
        }

        .game-mode-title {
            font-size: 2.5em;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .boyle-title-glow {
            color: #ff5a5f;
            text-shadow: 0 0 15px #ff5a5f, 0 0 25px #ff5a5f;
        }

        .gaylussac-title-glow {
            color: #4a90e2; /* Blue for Gay-Lussac */
            text-shadow: 0 0 15px #4a90e2, 0 0 25px #4a90e2;
        }

        .explanation-text {
            max-width: 800px;
            margin: 0 auto 30px auto;
            font-size: 1.1em;
            line-height: 1.6;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .gaylussac-explanation {
            color: #4a90e2; /* Blue for emphasis */
        }

        .slider-container {
            width: 80%;
            max-width: 500px;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .slider-container label {
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .slider-container input[type="range"] {
            width: 90%;
            -webkit-appearance: none;
            height: 8px;
            background: #ddd;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        .slider-container input[type="range"]:hover {
            opacity: 1;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff5a5f;
            cursor: grab;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .slider-container input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff5a5f;
            cursor: grab;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .slider-label-explanation {
            font-size: 0.9em;
            color: #ccc;
            margin-top: 5px;
        }

        .container {
            position: relative;
            width: 90vmin; /* Responsive width */
            height: 40vmin; /* Responsive height */
            max-width: 600px;
            max-height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            margin: 30px auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #boyle .container, #gayLussac .container {
            width: 80%; /* Adjusted for Boyle/Gay-Lussac to fit sliders */
            height: 300px; /* Fixed height for canvas modes */
            max-width: 600px;
            max-height: 400px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden; /* Important for particle containment */
            display: flex; /* For canvas sizing to fill parent */
            justify-content: center;
            align-items: center;
        }

        #boyleCanvas, #gayLussacCanvas {
            width: 100%; /* Make canvas fill its parent container */
            height: 100%;
            display: block; /* Remove extra space below canvas */
        }

        /* Charles & Avogadro specific styles */
        .balloon-container {
            position: relative;
            width: 100%;
            height: 180px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px auto;
        }

        .balloon {
            background: radial-gradient(circle at 25% 25%, #ffbaba, #ff7a7f 30%, #ff5a5f 60%, #cc0000 100%);
            border-radius: 50%;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            transition: width 0.2s ease-out, height 0.2s ease-out;
            z-index: 2;
            position: relative;
            animation: float 5s ease-in-out infinite alternate;
        }

        @keyframes float {
            0% { transform: translateY(0); }
            100% { transform: translateY(-15px); }
        }

        .balloon::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -15px;
            width: 3px;
            height: 20px;
            background: #aaa;
            transform: translateX(-50%);
            border-radius: 2px;
            z-index: 1;
        }

        .molecule-teller-bg {
            position: absolute;
            font-size: 8em;
            color: rgba(255, 255, 255, 0.05);
            z-index: 1;
            pointer-events: none;
        }

        #avogadroTopLeftCounter {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 1.5em;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
            z-index: 5;
        }

        .avogadro-increase-btn {
            background-color: #28a745;
            padding: 12px 25px;
            font-size: 1.1em;
            margin-top: 20px;
        }
        .avogadro-increase-btn:hover {
            background-color: #218838;
        }

        .rainbow-button {
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #FF0000, #FF7F00, #FFFF00, #00FF00, #0000FF, #4B0082, #9400D3);
            background-size: 400% 400%;
            animation: rainbow 6s ease infinite;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.3em;
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
            border: none;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            display: none;
            z-index: 100;
        }

        .rainbow-button:hover {
            animation-play-state: paused;
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.5);
        }

        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Pop animation for Avogadro's law */
        .balloon.pop {
            animation: popOut 0.3s forwards;
            opacity: 0;
            transform: scale(0);
        }

        @keyframes popOut {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 0; transform: scale(0); }
        }

        ---

        /*
        ******************************************************************
        * NEW/UPDATED CSS FOR MEMBER PAGE                                *
        ******************************************************************
        */
        #memberPage {
            justify-content: flex-start; /* Align content to the top */
            padding-top: 50px; /* Add some space at the top */
        }

        #memberPage h2 {
            font-size: 3em;
            color: #FFD700; /* Gold color for the title */
            text-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700;
            margin-bottom: 40px;
        }

        #teamMembersGrid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Responsive grid */
            gap: 30px; /* Space between members */
            max-width: 900px;
            width: 90%;
            margin-bottom: 50px;
        }

        .member-card {
            background: rgba(255, 255, 255, 0.15); /* Slightly lighter background */
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 150px; /* Ensure cards have a minimum height */
        }

        .member-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
        }

        .member-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #ADD8E6; /* Light blue for names */
            margin-bottom: 10px;
            text-shadow: 0 0 5px rgba(173, 216, 230, 0.5);
        }

        .member-title { /* Optional: Add roles later */
            font-size: 0.9em;
            color: #ccc;
        }

        #memberImageDisplay {
            margin-top: 30px;
            width: 250px;
            height: 250px;
            border-radius: 50%; /* Circular image */
            object-fit: cover; /* Crop image to fit */
            border: 5px solid #FFD700; /* Gold border */
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            display: none; /* Hidden by default */
            transition: opacity 0.5s ease;
        }

        #imageUploadContainer {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            max-width: 300px;
            width: 80%;
        }

        #imageUploadContainer input[type="file"] {
            display: none; /* Hide default file input */
        }

        .custom-file-upload {
            border: 2px dashed #ADD8E6;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            color: #ADD8E6;
            font-weight: bold;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .custom-file-upload:hover {
            background-color: rgba(173, 216, 230, 0.2);
            border-color: #fff;
        }

        #uploadFileName {
            font-size: 0.9em;
            color: #ccc;
            word-break: break-all; /* Break long file names */
        }

    </style>
</head>
<body>

    <canvas id="particleCanvas"></canvas>

    <div id="mainMenu">
        <h1>GAS LAWS GAME</h1>
        <h3>Choose your mode</h3>
        <button onclick="showMode('boyle')">Boyle's Law</button>
        <button onclick="showMode('charles')">Charles' Law</button>
        <button onclick="showMode('gayLussac')">Gay‑Lussac's Law</button>
        <button onclick="showMode('avogadro')">Avogadro's Law</button>
        <button id="memberBtn" onclick="showMemberPage()">Member</button>
    </div>

    <div id="boyle" class="gameMode">
        <h2 class="game-mode-title boyle-title-glow">Boyle's Law</h2>
        <p class="explanation-text">
            In Boyle's Law, when <strong>temperature</strong> and <strong>number of particles</strong> are constant,
            the <strong>pressure</strong> of a gas is inversely proportional to its <strong>volume</strong>.
            Watch how decreasing the container size (volume) affects the speed and density of the particles.
        </p>
        <div class="slider-container">
            <label>Mass: <span id="boyleMassVal">5</span></label>
            <p class="slider-label-explanation">Adjusts the **number of gas particles** (molecules).</p>
            <input type="range" id="boyleMass" min="1" max="20" step="1" value="5">
        </div>
        <div class="slider-container">
            <label>Temperature (°C): <span id="boyleTempVal">20</span></label>
            <p class="slider-label-explanation">Controls the **average speed** of the particles.</p>
            <input type="range" id="boyleTemp" min="0" max="100" value="20">
        </div>
        <div class="container">
            <canvas id="boyleCanvas"></canvas>
        </div>
        <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
    </div>

    <div id="charles" class="gameMode">
        <h2 class="game-mode-title">Charles' Law</h2>
        <p class="explanation-text">
            In Charles' Law, when <strong>pressure</strong> and <strong>number of particles</strong> are constant,
            the <strong>volume</strong> of a gas is directly proportional to its <strong>temperature</strong>.
            Watch how the balloon expands or contracts as you change the temperature.
        </p>
        <div class="container">
            <div class="balloon-container">
                <div id="charlesBalloon" class="balloon"></div>
                <div id="charlesMoleculeBg" class="molecule-teller-bg">0</div>
            </div>
            <div class="slider-container">
                <label>Temperature (°C): <span id="charlesTempVal">20</span></label>
                <p class="slider-label-explanation">Controls the **temperature** affecting balloon size.</p>
                <input type="range" id="charlesTemp" min="0" max="100" value="20">
            </div>
        </div>
        <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
    </div>

    <div id="gayLussac" class="gameMode">
        <h2 class="game-mode-title gaylussac-title-glow">Gay‑Lussac's Law</h2>
        <p class="explanation-text gaylussac-explanation">
            In Gay-Lussac's Law, when <strong>volume</strong> and <strong>number of particles</strong> are constant,
            the <strong>pressure</strong> of a gas is directly proportional to its <strong>temperature</strong>.
            The container is **rigid and sealed** (constant volume).
        </p>
        <div class="slider-container">
            <label>Temperature (°C): <span id="gayLussacTempVal">20</span></label>
            <p class="slider-label-explanation">Adjusts the **temperature**, which controls the **speed of particles**.</p>
            <input type="range" id="gayLussacTemp" min="0" max="100" value="20">
        </div>
        <div class="slider-container">
                <label>Pressure (arbitrary units): <span id="gayLussacPressureVal">X</span></label>
                <p class="slider-label-explanation">Shows the **resulting pressure**. Faster particles hit walls more often and harder, increasing pressure.</p>
        </div>
        <div class="container">
            <canvas id="gayLussacCanvas"></canvas>
        </div>
        <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
    </div>

    <div id="avogadro" class="gameMode">
        <h2 class="game-mode-title">Avogadro's Law</h2>
        <p class="explanation-text">
            In Avogadro's Law, when <strong>temperature</strong> and <strong>pressure</strong> are constant,
            the <strong>volume</strong> of a gas is directly proportional to the <strong>number of particles</strong>.
            Increase the number of molecules and watch the balloon expand until it pops!
        </p>
        <div class="container">
            <div id="avogadroTopLeftCounter" class="molecule-counter">Molecules: 0</div>

            <div class="balloon-container">
                <div id="avogadroBalloon" class="balloon"></div>
                <div id="avogadroMoleculeBg" class="molecule-teller-bg">0</div>
                <button id="getNewOneBtn" class="rainbow-button">GET NEW ONE!!!</button>
            </div>

            <button id="increaseMoleculeBtn" class="avogadro-increase-btn">Increase Molecules</button>
        </div>
        <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
    </div>

    <div id="memberPage" class="gameMode">
        <h2>Our Amazing Team</h2>
        <div id="teamMembersGrid">
            </div>

        <img id="memberImageDisplay" src="" alt="Team Member Picture">

        <div id="imageUploadContainer">
            <label for="imageUpload" class="custom-file-upload">
                <input type="file" id="imageUpload" accept="image/*">
                Upload Member Picture
            </label>
            <span id="uploadFileName">No file chosen</span>
            <p style="font-size: 0.8em; color: #aaa; text-align: center;">Click a name to see their picture, or upload your own!</p>
        </div>

        <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
    </div>


    <audio id="popSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>

    <script>
        // === Global Audio ===
        const popSound = document.getElementById('popSound');
        function playPopSound() {
            if (popSound) {
                popSound.currentTime = 0; // Rewind to start if already playing
                popSound.play().catch(e => console.error("Error playing pop sound:", e));
            }
        }

        // === Animated Particles Background ===
        const particleCanvas = document.getElementById('particleCanvas'), ctx = particleCanvas.getContext('2d');
        let particles = [], width, height;

        function initParticles() {
            width = window.innerWidth;
            height = window.innerHeight;
            particleCanvas.width = width;
            particleCanvas.height = height;
            particles = [];
            for (let i = 0; i < 80; i++) {
                particles.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    radius: Math.random() * 6 + 2,
                    speedY: Math.random() * 1.5 + 0.5,
                    speedX: (Math.random() - 0.5) * 0.5,
                    color: 'rgba(255, 90, 95, 0.4)', /* Pinkish-red particles */
                    alpha: Math.random() * 0.5 + 0.3,
                    type: Math.random() > 0.5 ? 'circle' : 'atom'
                });
            }
        }

        function drawAtom(x, y, r) {
            ctx.strokeStyle = 'rgba(255,90,95,0.6)'; /* Pinkish-red atom lines */
            ctx.lineWidth = 1.2;
            ctx.beginPath(); ctx.arc(x, y, r * 0.6, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(255,90,95,0.7)'; /* Pinkish-red atom fill */
            ctx.fill(); ctx.closePath();
            ctx.beginPath(); ctx.ellipse(x, y, r * 1.2, r * 0.5, 0, 0, Math.PI * 2); ctx.stroke();
            ctx.beginPath(); ctx.ellipse(x, y, r * 0.5, r * 1.2, Math.PI / 4, 0, Math.PI * 2); ctx.stroke();
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);
            for (const p of particles) {
                p.y += p.speedY; p.x += p.speedX;
                if (p.y - p.radius > height) p.y = -p.radius;
                if (p.x - p.radius > width) p.x = -p.radius;
                else if (p.x + p.radius < 0) p.x = width + p.radius;
                ctx.globalAlpha = p.alpha;
                if (p.type === 'circle') {
                    ctx.fillStyle = p.color;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.closePath();
                } else {
                    drawAtom(p.x, p.y, p.radius);
                }
                ctx.globalAlpha = 1;
            }
            requestAnimationFrame(draw);
        }
        window.addEventListener('resize', initParticles);
        initParticles();
        draw();

        // === Main Menu & Mode Handling ===
        const modes = ['boyle','charles','gayLussac','avogadro','memberPage'];
        function showMode(mode) {
            document.getElementById('mainMenu').style.display = 'none';
            modes.forEach(m => {
                document.getElementById(m).style.display = (m === mode ? 'flex' : 'none');
            });
            cancelAllAnimations(); // Cancel all animations before starting a new one

            if(mode === 'boyle') initBoyle();
            else if(mode === 'charles') initCharles();
            else if(mode === 'gayLussac') initGayLussac();
            else if(mode === 'avogadro') initAvogadro();
            else if(mode === 'memberPage') initMemberPage(); // Initialize member page
        }

        function returnToMenu() {
            document.getElementById('mainMenu').style.display = 'flex';
            modes.forEach(m => {
                document.getElementById(m).style.display = 'none';
            });
            cancelAllAnimations(); // Cancel all animations when returning to menu
        }

        function cancelAllAnimations() {
            cancelBoyleAnimation();
            cancelCharlesAnimation();
            cancelGayLussacAnimation();
            cancelAvogadroAnimation();
            cancelMemberPageDisplay(); // Cancel member page specific display
        }

        function showMemberPage() {
            showMode('memberPage');
        }

        // Helper function for canvas resizing (Boyle and Gay-Lussac)
        function handleCanvasResize(canvasElement, ballsArray, ballRadius, extraPadding = 0) {
            const container = canvasElement.parentElement;
            const newWidth = container.clientWidth - extraPadding;
            const newHeight = container.clientHeight - extraPadding;

            if (canvasElement.width !== newWidth || canvasElement.height !== newHeight) {
                canvasElement.width = newWidth;
                canvasElement.height = newHeight;
                ballsArray.forEach(ball => {
                    ball.x = Math.max(ballRadius, Math.min(ball.x, newWidth - ballRadius));
                    ball.y = Math.max(ballRadius, Math.min(ball.y, newHeight - ballRadius));
                });
            }
        }


        // === BOYLE MODE ===
        const boyleMassSlider = document.getElementById('boyleMass');
        const boyleTempSlider = document.getElementById('boyleTemp');
        const boyleMassVal = document.getElementById('boyleMassVal');
        const boyleTempVal = document.getElementById('boyleTempVal');
        const boyleCanvas = document.getElementById('boyleCanvas');
        const bCtx = boyleCanvas.getContext('2d');

        let boyleBalls = [];
        let boyleAnimId = null;
        const BOYLE_BALL_RADIUS = 6;
        const MAX_MASS_VALUE = 20;
        const MAX_TEMP_VALUE = 100;

        function initBoyle() {
            handleCanvasResize(boyleCanvas, boyleBalls, BOYLE_BALL_RADIUS);
            boyleMassVal.textContent = boyleMassSlider.value;
            boyleTempVal.textContent = boyleTempSlider.value;
            boyleBalls = [];
            addRemoveBoyleBalls(parseInt(boyleMassSlider.value));
            updateBoyleBallSpeeds();
            cancelBoyleAnimation();
            animateBoyle();
        }

        function addRemoveBoyleBalls(newMass) {
            const currentBallCount = boyleBalls.length;
            const containerArea = boyleCanvas.width * boyleCanvas.height;
            const ballArea = Math.PI * BOYLE_BALL_RADIUS * BOYLE_BALL_RADIUS;
            const IDEAL_MAX_BALLS = Math.floor(containerArea / (ballArea * 2.5));
            const targetBallCount = Math.floor((newMass / MAX_MASS_VALUE) * IDEAL_MAX_BALLS);

            if (targetBallCount > currentBallCount) {
                for (let i = 0; i < (targetBallCount - currentBallCount); i++) {
                    let newBall = {
                        x: Math.random() * (boyleCanvas.width - 2 * BOYLE_BALL_RADIUS) + BOYLE_BALL_RADIUS,
                        y: Math.random() * (boyleCanvas.height - 2 * BOYLE_BALL_RADIUS) + BOYLE_BALL_RADIUS,
                        radius: BOYLE_BALL_RADIUS,
                        speedX: (Math.random() - 0.5) * 2,
                        speedY: (Math.random() - 0.5) * 2,
                        color: '#ff5a5f'
                    };
                    boyleBalls.push(newBall);
                }
            } else if (targetBallCount < currentBallCount) {
                boyleBalls.splice(0, currentBallCount - targetBallCount);
            }
        }

        function updateBoyleBallSpeeds() {
            const temp = parseInt(boyleTempSlider.value);
            const mass = parseInt(boyleMassSlider.value);

            const baseSpeed = 1.5;
            const tempFactor = 0.5 + (temp / MAX_TEMP_VALUE) * 2.5;
            const massFactor = 1.0 - ( (mass - 1) / (MAX_MASS_VALUE - 1) ) * 0.7;

            const combinedSpeedFactor = baseSpeed * tempFactor * massFactor;

            boyleBalls.forEach(ball => {
                let currentSpeedMagnitude = Math.sqrt(ball.speedX * ball.speedX + ball.speedY * ball.speedY);

                if (currentSpeedMagnitude === 0 || isNaN(currentSpeedMagnitude) || currentSpeedMagnitude < 0.01) {
                    let angle = Math.random() * Math.PI * 2;
                    ball.speedX = Math.cos(angle) * combinedSpeedFactor;
                    ball.speedY = Math.sin(angle) * combinedSpeedFactor;
                } else {
                    const scaleRatio = combinedSpeedFactor / currentSpeedMagnitude;
                    ball.speedX *= scaleRatio;
                    ball.speedY *= scaleRatio;
                }
            });
        }

        function animateBoyle() {
            handleCanvasResize(boyleCanvas, boyleBalls, BOYLE_BALL_RADIUS);
            bCtx.clearRect(0, 0, boyleCanvas.width, boyleCanvas.height);
            boyleBalls.forEach(ball => {
                ball.x += ball.speedX;
                ball.y += ball.speedY;

                if (ball.x + ball.radius > boyleCanvas.width) { ball.x = boyleCanvas.width - ball.radius; ball.speedX *= -1; }
                else if (ball.x - ball.radius < 0) { ball.x = ball.radius; ball.speedX *= -1; }
                if (ball.y + ball.radius > boyleCanvas.height) { ball.y = boyleCanvas.height - ball.radius; ball.speedY *= -1; }
                else if (ball.y - ball.radius < 0) { ball.y = ball.radius; ball.speedY *= -1; }
            });

            boyleBalls.forEach(ball => {
                bCtx.fillStyle = ball.color;
                bCtx.beginPath();
                bCtx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                bCtx.fill();
            });
            boyleAnimId = requestAnimationFrame(animateBoyle);
        }

        function cancelBoyleAnimation() {
            if (boyleAnimId) cancelAnimationFrame(boyleAnimId);
            boyleAnimId = null;
        }

        boyleMassSlider.addEventListener('input', () => {
            const newMass = parseInt(boyleMassSlider.value);
            boyleMassVal.textContent = newMass;
            addRemoveBoyleBalls(newMass);
            updateBoyleBallSpeeds();
        });

        boyleTempSlider.addEventListener('input', () => {
            boyleTempVal.textContent = boyleTempSlider.value;
            updateBoyleBallSpeeds();
        });


        // === CHARLES MODE ===
        const charlesTempSlider = document.getElementById('charlesTemp');
        const charlesTempVal = document.getElementById('charlesTempVal');
        const charlesBalloon = document.getElementById('charlesBalloon');
        const charlesMoleculeBg = document.getElementById('charlesMoleculeBg');
        let charlesAnimId = null;

        function initCharles() {
            charlesTempVal.textContent = charlesTempSlider.value;
            updateCharlesBalloon();
        }

        function updateCharlesBalloon() {
            const temp = parseInt(charlesTempSlider.value);
            charlesTempVal.textContent = temp;
            const minWidth = 80, minHeight = 120;
            const maxWidth = 140, maxHeight = 210;
            const width = minWidth + (maxWidth - minWidth) * (temp / 100);
            const height = minHeight + (maxHeight - minHeight) * (temp / 100);

            charlesBalloon.style.width = width + 'px';
            charlesBalloon.style.height = height + 'px';
            charlesMoleculeBg.textContent = temp;
        }

        charlesTempSlider.addEventListener('input', () => {
            updateCharlesBalloon();
        });

        function cancelCharlesAnimation() {
        }


        // === GAY-LUSSAC MODE ===
        const gayLussacTempSlider = document.getElementById('gayLussacTemp');
        const gayLussacTempVal = document.getElementById('gayLussacTempVal');
        const gayLussacPressureVal = document.getElementById('gayLussacPressureVal');
        const gayLussacCanvas = document.getElementById('gayLussacCanvas');
        const gCtx = gayLussacCanvas.getContext('2d');

        let gayLussacBalls = [];
        let gayLussacAnimId = null;
        const GAYLUSSAC_BALL_RADIUS = 5;
        const GAYLUSSAC_NUM_BALLS = 80;
        const GAYLUSSAC_MAX_TEMP = 100;
        const GAYLUSSAC_CANVAS_PADDING = 40;

        function initGayLussac() {
            handleCanvasResize(gayLussacCanvas, gayLussacBalls, GAYLUSSAC_BALL_RADIUS, GAYLUSSAC_CANVAS_PADDING);
            gayLussacTempVal.textContent = gayLussacTempSlider.value;
            updateGayLussacPressureDisplay(parseInt(gayLussacTempSlider.value));
            gayLussacBalls = [];
            for (let i = 0; i < GAYLUSSAC_NUM_BALLS; i++) {
                let newBall = {
                    x: Math.random() * (gayLussacCanvas.width - 2 * GAYLUSSAC_BALL_RADIUS) + GAYLUSSAC_BALL_RADIUS,
                    y: Math.random() * (gayLussacCanvas.height - 2 * GAYLUSSAC_BALL_RADIUS) + GAYLUSSAC_BALL_RADIUS,
                    radius: GAYLUSSAC_BALL_RADIUS,
                    speedX: 0,
                    speedY: 0,
                    color: 'rgba(74, 144, 226, 0.9)'
                };
                gayLussacBalls.push(newBall);
            }
            updateGayLussacSpeeds();
            cancelGayLussacAnimation();
            animateGayLussac();
        }

        function updateGayLussacSpeeds() {
            const temp = parseInt(gayLussacTempSlider.value);
            const KELVIN_OFFSET = 273.15;
            const minEffectiveTemp = KELVIN_OFFSET;
            const maxEffectiveTemp = 100 + KELVIN_OFFSET;
            const currentEffectiveTemp = minEffectiveTemp + (temp / GAYLUSSAC_MAX_TEMP) * (maxEffectiveTemp - minEffectiveTemp);
            const speedScale = 0.05;
            const targetSpeedMagnitude = currentEffectiveTemp * speedScale;

            gayLussacBalls.forEach(ball => {
                let currentSpeedMagnitude = Math.sqrt(ball.speedX * ball.speedX + ball.speedY * ball.speedY);

                if (currentSpeedMagnitude === 0 || isNaN(currentSpeedMagnitude) || currentSpeedMagnitude < 0.01) {
                    let angle = Math.random() * Math.PI * 2;
                    ball.speedX = Math.cos(angle) * targetSpeedMagnitude;
                    ball.speedY = Math.sin(angle) * targetSpeedMagnitude;
                } else {
                    const scaleRatio = targetSpeedMagnitude / currentSpeedMagnitude;
                    ball.speedX *= scaleRatio;
                    ball.speedY *= scaleRatio;
                }
            });
        }

        function updateGayLussacPressureDisplay(tempCelsius) {
            const KELVIN_OFFSET = 273.15;
            const initialTempK = 20 + KELVIN_OFFSET;
            const currentTempK = tempCelsius + KELVIN_OFFSET;
            const initialPressure = 1.0;
            const pressureValue = initialPressure * (currentTempK / initialTempK);
            gayLussacPressureVal.textContent = pressureValue.toFixed(2);
        }

        function animateGayLussac() {
            handleCanvasResize(gayLussacCanvas, gayLussacBalls, GAYLUSSAC_BALL_RADIUS, GAYLUSSAC_CANVAS_PADDING);
            gCtx.clearRect(0, 0, gayLussacCanvas.width, gayLussacCanvas.height);
            gayLussacBalls.forEach(ball => {
                ball.x += ball.speedX;
                ball.y += ball.speedY;

                if (ball.x + ball.radius > gayLussacCanvas.width) { ball.x = gayLussacCanvas.width - ball.radius; ball.speedX *= -1; }
                else if (ball.x - ball.radius < 0) { ball.x = ball.radius; ball.speedX *= -1; }
                if (ball.y + ball.radius > gayLussacCanvas.height) { ball.y = gayLussacCanvas.height - ball.radius; ball.speedY *= -1; }
                else if (ball.y - ball.radius < 0) { ball.y = ball.radius; ball.speedY *= -1; }
            });

            gayLussacBalls.forEach(ball => {
                gCtx.fillStyle = ball.color;
                gCtx.beginPath();
                gCtx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                gCtx.fill();
            });
            gayLussacAnimId = requestAnimationFrame(animateGayLussac);
        }

        function cancelGayLussacAnimation() {
            if (gayLussacAnimId) cancelAnimationFrame(gayLussacAnimId);
            gayLussacAnimId = null;
        }


        // === AVOGADRO MODE ===
        const avogadroBalloon = document.getElementById('avogadroBalloon');
        const avogadroMoleculeBg = document.getElementById('avogadroMoleculeBg');
        const avogadroTopLeftCounter = document.getElementById('avogadroTopLeftCounter');
        const increaseMoleculeBtn = document.getElementById('increaseMoleculeBtn');
        const getNewOneBtn = document.getElementById('getNewOneBtn');

        let avogadroMoleculeCount = 0;
        let avogadroBalloonBaseWidth = 100;
        let avogadroBalloonBaseHeight = 150;
        const AVOGADRO_MAX_MOLECULES = 25;
        const AVOGADRO_POP_THRESHOLD = 25;
        const AVOGADRO_VOLUME_SCALE = 1.08;

        function initAvogadro() {
            avogadroMoleculeCount = 0;
            avogadroBalloon.style.display = 'block';
            getNewOneBtn.style.display = 'none';
            increaseMoleculeBtn.style.display = 'block';
            updateAvogadroBalloon();
            avogadroBalloon.classList.remove('pop');
        }

        function updateAvogadroBalloon() {
            const currentWidth = avogadroBalloonBaseWidth * Math.pow(AVOGADRO_VOLUME_SCALE, avogadroMoleculeCount);
            const currentHeight = avogadroBalloonBaseHeight * Math.pow(AVOGADRO_VOLUME_SCALE, avogadroMoleculeCount);

            avogadroBalloon.style.width = currentWidth + 'px';
            avogadroBalloon.style.height = currentHeight + 'px';
            avogadroMoleculeBg.textContent = avogadroMoleculeCount;
            avogadroTopLeftCounter.textContent = `Molecules: ${avogadroMoleculeCount}`;

            if (avogadroMoleculeCount >= AVOGADRO_POP_THRESHOLD) {
                handleAvogadroPop();
            }
        }

        function handleAvogadroPop() {
            playPopSound();
            avogadroBalloon.classList.add('pop');
            increaseMoleculeBtn.style.display = 'none';

            avogadroBalloon.addEventListener('animationend', () => {
                avogadroBalloon.style.display = 'none';
                getNewOneBtn.style.display = 'block';
            }, { once: true });
        }

        increaseMoleculeBtn.addEventListener('click', () => {
            if (avogadroMoleculeCount < AVOGADRO_MAX_MOLECULES) {
                avogadroMoleculeCount++;
                updateAvogadroBalloon();
            }
        });

        getNewOneBtn.addEventListener('click', () => {
            initAvogadro();
        });

        function cancelAvogadroAnimation() {
            avogadroBalloon.classList.remove('pop');
            avogadroBalloon.style.display = 'block';
            getNewOneBtn.style.display = 'none';
            increaseMoleculeBtn.style.display = 'block';
        }


        ---

        // === MEMBER PAGE LOGIC ===
        const teamMembers = [
            { name: "Jittanan Pasartkeaw", defaultImage: "https://via.placeholder.com/250/FFD700/000000?text=JP" },
            { name: "Thanunya Udomchaipon", defaultImage: "https://via.placeholder.com/250/ADD8E6/000000?text=TU" },
            { name: "Hasana Pathan", defaultImage: "https://via.placeholder.com/250/FF6347/000000?text=HP" },
            { name: "Phattaraporn Preeda", defaultImage: "https://via.placeholder.com/250/98FB98/000000?text=PP" },
            { name: "Narisara Eiamsa-ard", defaultImage: "https://via.placeholder.com/250/DDA0DD/000000?text=NE" },
            { name: "Chalita Ruttapoom", defaultImage: "https://via.placeholder.com/250/FFDEAD/000000?text=CR" },
            { name: "Yanisa Singh", defaultImage: "https://via.placeholder.com/250/B0E0E6/000000?text=YS" }
        ];

        const teamMembersGrid = document.getElementById('teamMembersGrid');
        const memberImageDisplay = document.getElementById('memberImageDisplay');
        const imageUploadInput = document.getElementById('imageUpload');
        const uploadFileNameSpan = document.getElementById('uploadFileName');

        function initMemberPage() {
            teamMembersGrid.innerHTML = ''; // Clear existing cards
            memberImageDisplay.style.display = 'none'; // Hide image initially
            memberImageDisplay.src = ''; // Clear previous image
            uploadFileNameSpan.textContent = 'No file chosen'; // Reset file name

            teamMembers.forEach(member => {
                const memberCard = document.createElement('div');
                memberCard.classList.add('member-card');
                memberCard.innerHTML = `
                    <div class="member-name">${member.name}</div>
                    `;
                memberCard.addEventListener('click', () => displayMemberPicture(member));
                teamMembersGrid.appendChild(memberCard);
            });
        }

        function displayMemberPicture(member) {
            memberImageDisplay.src = member.defaultImage; // Use default placeholder
            memberImageDisplay.style.display = 'block'; // Show the image
            memberImageDisplay.style.opacity = '0'; // Start faded
            setTimeout(() => {
                memberImageDisplay.style.opacity = '1'; // Fade in
            }, 50); // Small delay for transition to work
        }

        // Handle image upload
        imageUploadInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                uploadFileNameSpan.textContent = file.name;
                const reader = new FileReader();
                reader.onload = (e) => {
                    memberImageDisplay.src = e.target.result;
                    memberImageDisplay.style.display = 'block';
                    memberImageDisplay.style.opacity = '0';
                    setTimeout(() => {
                        memberImageDisplay.style.opacity = '1';
                    }, 50);
                };
                reader.readAsDataURL(file);
            } else {
                uploadFileNameSpan.textContent = 'No file chosen';
                memberImageDisplay.style.display = 'none';
                memberImageDisplay.src = '';
            }
        });

        function cancelMemberPageDisplay() {
            // No continuous animations to cancel, but reset display elements
            memberImageDisplay.style.display = 'none';
            memberImageDisplay.src = '';
            uploadFileNameSpan.textContent = 'No file chosen';
        }

    </script>
</body>
</html>
