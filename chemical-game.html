<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gas Laws Game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600&display=swap');

    /* === General Styles === */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Montserrat', sans-serif;
      background: #1a0a3a;
      overflow: hidden;
      color: white;
    }
    /* === Particle Background === */
    #particleCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
    }

    /* === Main Menu Layout === */
    #mainMenu {
      position: relative;
      z-index: 1;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    /* === Titles (Rainbow Effect) === */
    #mainMenu h1 {
      font-weight: 600;
      font-size: 4rem;
      margin-bottom: 0.3em;
      letter-spacing: 5px;
      /* Rainbow effect */
      background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
      background-size: 200% 100%;
      animation: rainbowBackground 3s linear infinite;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      color: transparent; /* Fallback */
    }
    #mainMenu h3 {
      font-weight: 300;
      font-size: 1.2rem;
      margin-bottom: 2em;
      /* Rainbow effect */
      background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
      background-size: 200% 100%;
      animation: rainbowBackground 3s linear infinite;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      color: transparent; /* Fallback */
    }
    /* === Buttons (Pinkish-Red Style) === */
    #mainMenu button {
      background: #ff5a5f;
      border: none;
      border-radius: 50px;
      color: white;
      font-size: 1.5rem;
      padding: 16px 80px;
      margin: 12px 0;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(255, 90, 95, 0.4);
      transition: background-color .3s, transform .2s;
    }
    #mainMenu button:hover {
      background: #ff7a7f;
      transform: translateY(-2px);
    }

    /* === Game Mode Screens (Hidden by default) === */
    .gameMode {
      display: none;
      position: relative;
      z-index: 2;
      height: 100vh;
      padding: 20px;
      background: #1a0a3a; /* Dark background for consistency */
      overflow: auto;
      box-sizing: border-box;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* === Member Page === */
    #memberPage {
        text-align: center;
    }
    #memberPage h2 {
        font-weight: 600;
        font-size: 3rem;
        margin-bottom: 40px;
        color: #9400d3; /* Purple color */
        text-shadow: 0 0 15px rgba(148, 0, 211, 0.7); /* Purple glow */
    }
    #memberPage ul {
        list-style: none;
        padding: 0;
        margin: 0 0 40px 0;
    }
    #memberPage li {
        font-size: 1.8rem;
        font-weight: 300;
        margin: 15px 0;
        color: #fff;
        text-shadow: 0 0 5px rgba(255,255,255,0.3);
    }
    #memberPage .return-btn {
        background: #9400d3; /* Purple button */
        box-shadow: 0 4px 8px rgba(148, 0, 211, 0.4);
    }
    #memberPage .return-btn:hover {
        background: #af00ff; /* Lighter purple on hover */
    }

    /* === Game Mode common styles === */
    .game-mode-title {
        font-weight: 600;
        font-size: 2.8rem;
        margin-bottom: 38px;
        text-align: center;
        background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
        background-size: 200% 100%;
        animation: rainbowBackground 3s linear infinite;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        color: transparent;
        z-index: 100;
    }
    .explanation-text {
      text-align: center;
      max-width: 600px;
      margin-bottom: 25px;
      font-weight: 300;
    }
    .explanation-text strong {
      font-weight: 600;
      color: #ff5a5f;
    }
    .container {
      background: #222;
      border-radius: 12px;
      padding: 20px;
      width: 90vw;
      height: 70vh;
      max-width: 400px;
      max-height: 400px;
      min-width: 280px;
      min-height: 280px;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      box-sizing: border-box;
    }
    .return-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background: #ff5a5f;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      align-self: center;
      width: 140px;
    }
    .slider-container {
      margin: 15px 0;
      width: 300px;
      max-width: 90vw;
      color: #ff5a5f;
    }
    .slider-container label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }
    input[type=range] {
      width: 100%;
    }
    .slider-label-explanation {
      font-size: 0.8em;
      margin-top: 5px;
      font-weight: 300;
      color: rgba(255, 255, 255, 0.7);
    }
    .slider-label-explanation strong {
      color: #ffffff;
    }
    .balloon-container {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      position: relative;
      overflow: visible;
    }
    .balloon {
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      position: relative;
      transition: width 0.3s ease-in-out, height 0.3s ease-in-out;
    }
    .balloon::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 10px;
      height: 15px;
      background: inherit;
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      border-top: 1px solid rgba(255, 255, 255, 0.3);
    }
    .molecule-teller-bg {
        position: absolute;
        font-size: 8rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.1);
        z-index: 1;
        user-select: none;
    }
    #avogadroMoleculeBg {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.3s ease-out;
    }
    #avogadroTopLeftCounter {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 1.2rem;
        color: #fff;
        font-weight: 600;
        z-index: 3;
    }
    .avogadro-increase-btn {
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        font-size: 1.2rem;
        background: #ff5a5f;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        width: 220px;
        transition: background 0.3s;
        user-select: none;
        margin-top: 15px;
        margin-bottom: 15px;
        z-index: 3;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .avogadro-increase-btn:active {
        background: #ff7a7f;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        transform: translateX(-50%) translateY(2px);
    }
    .rainbow-button {
        background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
        background-size: 300% 100%;
        animation: rainbowBackground 3s linear infinite;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 12px 24px;
        cursor: pointer;
        font-size: 1.2em;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        display: none; /* Hide by default */
        z-index: 3;
        margin-top: 15px;
        margin-bottom: 15px;
    }
    .rainbow-button:hover {
        filter: brightness(1.1);
    }

    /* Gay-Lussac mode: Specific container styling for fixed volume */
    #gayLussac .container {
        background: #333; /* Darker background for fixed container */
        border: 4px solid #4a90e2; /* Blue border for a "sealed" look */
        box-shadow: 0 0 15px rgba(74, 144, 226, 0.6); /* Blue glow */
    }
    #gayLussacCanvas {
        background: none; /* Make canvas background transparent to show container bg */
        width: 100%; /* Make canvas fill container */
        height: 100%; /* Make canvas fill container */
        flex-grow: 1; /* Allow canvas to take available space */
    }
    .gaylussac-title-glow {
        background: none;
        -webkit-background-clip: unset;
        background-clip: unset;
        -webkit-text-fill-color: unset;
        color: #4a90e2; /* Blue color */
        animation: none;
        text-shadow: 0 0 8px rgba(74, 144, 226, 0.8),
                     0 0 15px rgba(74, 144, 226, 0.6),
                     0 0 25px rgba(74, 144, 226, 0.4);
    }

    /* Keyframe Animations */
    @keyframes rainbowBackground {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes popAnimation {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.5; }
      100% { transform: scale(0.1); opacity: 0; }
    }
    @keyframes betterPopAnimation {
      0% { transform: scale(1); opacity: 1; }
      15% { transform: scale(1.1); opacity: 1; }
      30% { transform: scale(0.9); opacity: 0.8; }
      50% { transform: scale(1.2); opacity: 0; }
      100% { transform: scale(0); opacity: 0; }
    }
    @keyframes popNeckAnimation {
      0% { height: 15px; opacity: 1; }
      50% { height: 25px; opacity: 0.5; }
      100% { height: 0; opacity: 0; }
    }
  </style>
</head>
<body>

  <canvas id="particleCanvas"></canvas>

  <div id="mainMenu">
    <h1>GAS LAWS GAME</h1>
    <h3>Choose your mode</h3>
    <button onclick="showMode('boyle')">Boyle's Law</button>
    <button onclick="showMode('charles')">Charles' Law</button>
    <button onclick="showMode('gayLussac')">Gay-Lussac's Law</button>
    <button onclick="showMode('avogadro')">Avogadro's Law</button>
    <button onclick="showMode('memberPage')">Meet the Team</button>
  </div>

  <div id="boyle" class="gameMode">
    <h2 class="game-mode-title">Boyle's Law</h2>
    <p class="explanation-text">
      In Boyle's Law, when <strong>temperature</strong> and <strong>number of particles</strong> are constant, the <strong>pressure</strong> of a gas is inversely proportional to its <strong>volume</strong>.
      You can control the pressure and volume by adjusting the size of the container.
    </p>
    <div class="slider-container">
      <label>Mass/Particles: <span id="boyleMassVal">5</span></label>
      <p class="slider-label-explanation">Controls the **number of particles** (mass).</p>
      <input type="range" id="boyleMass" min="1" max="20" step="1" value="5">
    </div>
    <div class="slider-container">
      <label>Temperature (°C): <span id="boyleTempVal">20</span></label>
      <p class="slider-label-explanation">Controls the **average speed** of the particles.</p>
      <input type="range" id="boyleTemp" min="0" max="100" value="20">
    </div>
    <div class="container">
      <canvas id="boyleCanvas"></canvas>
    </div>
    <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
  </div>

  <div id="charles" class="gameMode">
    <h2 class="game-mode-title">Charles' Law</h2>
    <p class="explanation-text">
      In Charles' Law, when <strong>pressure</strong> and <strong>number of particles</strong> are constant,
      the <strong>volume</strong> of a gas is directly proportional to its <strong>temperature</strong>.
      Watch how the balloon expands or contracts as you change the temperature.
    </p>
    <div class="container" style="position: relative;">
      <div class="balloon-container" style="justify-content:center; align-items:center; height:180px;">
        <div id="charlesBalloon" class="balloon" style="width:100px; height:150px; z-index: 2;"></div>
        <div id="charlesMoleculeBg" class="molecule-teller-bg">0</div>
      </div>
      <div class="slider-container">
        <label>Temperature (°C): <span id="charlesTempVal">20</span></label>
        <p class="slider-label-explanation">Controls the **temperature** affecting balloon size.</p>
        <input type="range" id="charlesTemp" min="0" max="100" value="20">
      </div>
    </div>
    <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
  </div>

  <div id="gayLussac" class="gameMode">
    <h2 class="game-mode-title gaylussac-title-glow">Gay‑Lussac's Law</h2>
    <p class="explanation-text gaylussac-explanation">
      In Gay-Lussac's Law, when <strong>volume</strong> and <strong>number of particles</strong> are constant,
      the <strong>pressure</strong> of a gas is directly proportional to its <strong>temperature</strong>.
      The container is **rigid and sealed** (constant volume).
    </p>
    <div class="slider-container">
      <label>Temperature (°C): <span id="gayLussacTempVal">20</span></label>
      <p class="slider-label-explanation">Adjusts the **temperature**, which controls the **speed of particles**.</p>
      <input type="range" id="gayLussacTemp" min="0" max="100" value="20">
    </div>
    <div class="slider-container">
        <label>Pressure (arbitrary units): <span id="gayLussacPressureVal">X</span></label>
        <p class="slider-label-explanation">Shows the **resulting pressure**. Faster particles hit walls more often and harder, increasing pressure.</p>
    </div>
    <div class="container">
      <canvas id="gayLussacCanvas"></canvas>
    </div>
    <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
  </div>

  <div id="avogadro" class="gameMode">
    <h2 class="game-mode-title">Avogadro's Law</h2>
    <p class="explanation-text">
      In Avogadro's Law, when <strong>temperature</strong> and <strong>pressure</strong> are constant,
      the <strong>volume</strong> of a gas is directly proportional to the <strong>number of particles</strong>.
      Increase the number of molecules and watch the balloon expand until it pops!
    </p>
    <div class="container" style="position: relative;">
      <div id="avogadroTopLeftCounter" class="molecule-counter">Molecules: 0</div>
      <div class="balloon-container">
        <div id="avogadroBalloon" class="balloon" style="width:100px; height:150px; z-index: 2;"></div>
        <div id="avogadroMoleculeBg" class="molecule-teller-bg">0</div>
        <button id="getNewOneBtn" class="rainbow-button">GET NEW ONE!!!</button>
      </div>
      <button id="increaseMoleculeBtn" class="avogadro-increase-btn">Increase Molecules</button>
    </div>
    <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
  </div>

  <div id="memberPage" class="gameMode">
    <h2>Our Amazing Team</h2>
    <ul>
      <li>Jittanan Pasartkeaw</li>
      <li>Thanunya Udomchaipon</li>
      <li>Hasana Pathan</li>
      <li>Phattaraporn Preeda</li>
      <li>Narisara Eiamsa-ard</li>
      <li>Chalita Ruttapoom</li>
      <li>Yanisa Singh</li>
    </ul>
    <button class="return-btn" onclick="returnToMenu()">Return to Menu</button>
  </div>

  <audio id="popSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>

  <script>
    // === Particle Background ===
    const particleCanvas = document.getElementById('particleCanvas');
    const particleCtx = particleCanvas.getContext('2d');
    let particles = [];
    let width, height;

    function initParticles() {
      width = window.innerWidth;
      height = window.innerHeight;
      particleCanvas.width = width;
      particleCanvas.height = height;
      particles = [];
      const NUM_PARTICLES = 150;
      for (let i = 0; i < NUM_PARTICLES; i++) {
        particles.push({
          x: Math.random() * width,
          y: Math.random() * height,
          radius: Math.random() * 2 + 1,
          speedY: Math.random() * 0.5 + 0.2,
          speedX: (Math.random() - 0.5) * 0.2,
          color: 'rgba(255, 255, 255, 0.8)',
          alpha: Math.random() * 0.5 + 0.3,
        });
      }
    }

    function drawParticles() {
      particleCtx.clearRect(0, 0, width, height);
      for (const p of particles) {
        p.y += p.speedY;
        p.x += p.speedX;
        if (p.y - p.radius > height) {
          p.y = -p.radius;
          p.x = Math.random() * width;
        }
        if (p.x - p.radius > width) p.x = -p.radius;
        else if (p.x + p.radius < 0) p.x = width + p.radius;

        particleCtx.globalAlpha = p.alpha;
        particleCtx.fillStyle = p.color;
        particleCtx.beginPath();
        particleCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        particleCtx.fill();
        particleCtx.closePath();
        particleCtx.globalAlpha = 1;
      }
      requestAnimationFrame(drawParticles);
    }

    window.addEventListener('resize', initParticles);
    initParticles();
    drawParticles();


    // === Main Menu & Mode Handling ===
    const modes = ['boyle','charles','gayLussac','avogadro','memberPage'];
    let animationFrames = {};

    function cancelAllAnimations() {
      for (const key in animationFrames) {
        cancelAnimationFrame(animationFrames[key]);
      }
      animationFrames = {};
    }

    function showMode(mode) {
      document.getElementById('mainMenu').style.display = 'none';
      modes.forEach(m => {
        const modeElement = document.getElementById(m);
        if (modeElement) {
          modeElement.style.display = (m === mode ? 'flex' : 'none');
        }
      });
      cancelAllAnimations();
      if(mode==='boyle') initBoyle();
      else if(mode==='charles') initCharles();
      else if(mode==='gayLussac') initGayLussac();
      else if(mode==='avogadro') initAvogadro();
    }

    function returnToMenu() {
      modes.forEach(m => {
        const modeElement = document.getElementById(m);
        if (modeElement) {
          modeElement.style.display = 'none';
        }
      });
      document.getElementById('mainMenu').style.display = 'flex';
      cancelAllAnimations();
    }

    // === Boyle's Law Simulation ===
    let boyleCanvas, boyleCtx, boyleParticles, boyleWidth, boyleHeight;
    let boyleMassSlider, boyleTempSlider;
    const particleRadius = 3;
    const P_FACTOR = 0.005;

    function initBoyle() {
      boyleCanvas = document.getElementById('boyleCanvas');
      boyleCtx = boyleCanvas.getContext('2d');
      boyleMassSlider = document.getElementById('boyleMass');
      boyleTempSlider = document.getElementById('boyleTemp');

      function resizeBoyleCanvas() {
        boyleWidth = boyleCanvas.offsetWidth;
        boyleHeight = boyleCanvas.offsetHeight;
        boyleCanvas.width = boyleWidth;
        boyleCanvas.height = boyleHeight;
      }
      resizeBoyleCanvas();
      window.addEventListener('resize', resizeBoyleCanvas);

      boyleMassSlider.oninput = () => {
        document.getElementById('boyleMassVal').textContent = boyleMassSlider.value;
        createBoyleParticles();
      };
      boyleTempSlider.oninput = () => {
        document.getElementById('boyleTempVal').textContent = boyleTempSlider.value;
        updateBoyleParticleSpeeds();
      };

      createBoyleParticles();
      updateBoyle();
    }

    function createBoyleParticles() {
      boyleParticles = [];
      const count = parseInt(boyleMassSlider.value);
      for (let i = 0; i < count; i++) {
        boyleParticles.push({
          x: Math.random() * boyleWidth,
          y: Math.random() * boyleHeight,
          vx: (Math.random() - 0.5) * 5,
          vy: (Math.random() - 0.5) * 5,
        });
      }
      updateBoyleParticleSpeeds();
    }

    function updateBoyleParticleSpeeds() {
      const temp = parseFloat(boyleTempSlider.value);
      const speed = temp / 20 + 2; // Base speed + temp influence
      for (const p of boyleParticles) {
        const angle = Math.random() * Math.PI * 2;
        p.vx = Math.cos(angle) * speed;
        p.vy = Math.sin(angle) * speed;
      }
    }

    function updateBoyle() {
      boyleCtx.clearRect(0, 0, boyleWidth, boyleHeight);
      for (const p of boyleParticles) {
        p.x += p.vx;
        p.y += p.vy;

        if (p.x < particleRadius || p.x > boyleWidth - particleRadius) p.vx *= -1;
        if (p.y < particleRadius || p.y > boyleHeight - particleRadius) p.vy *= -1;

        boyleCtx.beginPath();
        boyleCtx.arc(p.x, p.y, particleRadius, 0, Math.PI * 2);
        boyleCtx.fillStyle = '#ff5a5f';
        boyleCtx.fill();
      }
      animationFrames.boyle = requestAnimationFrame(updateBoyle);
    }


    // === Charles' Law Simulation ===
    let charlesBalloon, charlesTempSlider, charlesBalloonWidth, charlesBalloonHeight;

    function initCharles() {
      charlesBalloon = document.getElementById('charlesBalloon');
      charlesTempSlider = document.getElementById('charlesTemp');
      charlesTempSlider.oninput = updateCharles;
      charlesBalloonWidth = 100;
      charlesBalloonHeight = 150;
      updateCharles();
    }

    function updateCharles() {
      const temp = parseFloat(charlesTempSlider.value);
      document.getElementById('charlesTempVal').textContent = temp;
      // Volume is directly proportional to temperature (in Kelvin)
      const tempKelvin = temp + 273.15;
      const initialTempKelvin = 20 + 273.15;
      const scaleFactor = tempKelvin / initialTempKelvin;

      let newWidth = charlesBalloonWidth * scaleFactor;
      let newHeight = charlesBalloonHeight * scaleFactor;

      newWidth = Math.min(newWidth, 250); // Cap max size
      newHeight = Math.min(newHeight, 375); // Cap max size

      charlesBalloon.style.width = `${newWidth}px`;
      charlesBalloon.style.height = `${newHeight}px`;
      charlesBalloon.style.background = `radial-gradient(circle at 75% 30%, #fff, #ff5a5f 20%, #dd2c00 100%)`;
    }


    // === Gay-Lussac's Law Simulation ===
    let gayLussacCanvas, gayLussacCtx, gayLussacParticles;
    let gayLussacTempSlider, gayLussacPressureVal;
    let gayLussacWidth, gayLussacHeight;
    const GAY_PARTICLE_COUNT = 30;

    function initGayLussac() {
      gayLussacCanvas = document.getElementById('gayLussacCanvas');
      gayLussacCtx = gayLussacCanvas.getContext('2d');
      gayLussacTempSlider = document.getElementById('gayLussacTemp');
      gayLussacPressureVal = document.getElementById('gayLussacPressureVal');

      function resizeGayLussacCanvas() {
        gayLussacWidth = gayLussacCanvas.offsetWidth;
        gayLussacHeight = gayLussacCanvas.offsetHeight;
        gayLussacCanvas.width = gayLussacWidth;
        gayLussacCanvas.height = gayLussacHeight;
        createGayLussacParticles();
      }
      resizeGayLussacCanvas();
      window.addEventListener('resize', resizeGayLussacCanvas);

      gayLussacTempSlider.oninput = () => {
        document.getElementById('gayLussacTempVal').textContent = gayLussacTempSlider.value;
        updateGayLussacParticleSpeeds();
      };

      createGayLussacParticles();
      updateGayLussac();
    }

    function createGayLussacParticles() {
      gayLussacParticles = [];
      for (let i = 0; i < GAY_PARTICLE_COUNT; i++) {
        gayLussacParticles.push({
          x: Math.random() * gayLussacWidth,
          y: Math.random() * gayLussacHeight,
          vx: (Math.random() - 0.5) * 5,
          vy: (Math.random() - 0.5) * 5,
          color: `hsl(${Math.random() * 360}, 100%, 70%)`
        });
      }
      updateGayLussacParticleSpeeds();
    }

    function updateGayLussacParticleSpeeds() {
      const temp = parseFloat(gayLussacTempSlider.value);
      const speed = temp / 20 + 1;
      for (const p of gayLussacParticles) {
        p.vx = (Math.random() - 0.5) * speed;
        p.vy = (Math.random() - 0.5) * speed;
      }
    }

    function updateGayLussac() {
      gayLussacCtx.clearRect(0, 0, gayLussacWidth, gayLussacHeight);
      let pressureSum = 0;

      for (const p of gayLussacParticles) {
        p.x += p.vx;
        p.y += p.vy;

        let hitWall = false;
        if (p.x < particleRadius || p.x > gayLussacWidth - particleRadius) { p.vx *= -1; hitWall = true; }
        if (p.y < particleRadius || p.y > gayLussacHeight - particleRadius) { p.vy *= -1; hitWall = true; }
        if (hitWall) pressureSum += Math.abs(p.vx) + Math.abs(p.vy);

        gayLussacCtx.beginPath();
        gayLussacCtx.arc(p.x, p.y, particleRadius, 0, Math.PI * 2);
        gayLussacCtx.fillStyle = p.color;
        gayLussacCtx.fill();
      }

      gayLussacPressureVal.textContent = Math.round(pressureSum * 10);

      animationFrames.gayLussac = requestAnimationFrame(updateGayLussac);
    }


    // === Avogadro's Law Simulation ===
    let avogadroBalloon, avogadroBg, avogadroCounter, avogadroBtn, getNewOneBtn;
    let moleculeCount = 0;
    let popSound;
    const MAX_MOLECULES = 100;
    const BALLOON_MAX_SIZE = 350;

    function initAvogadro() {
      avogadroBalloon = document.getElementById('avogadroBalloon');
      avogadroBg = document.getElementById('avogadroMoleculeBg');
      avogadroCounter = document.getElementById('avogadroTopLeftCounter');
      avogadroBtn = document.getElementById('increaseMoleculeBtn');
      getNewOneBtn = document.getElementById('getNewOneBtn');
      popSound = document.getElementById('popSound');

      avogadroBtn.onclick = increaseMoleculeCount;
      getNewOneBtn.onclick = resetAvogadro;

      resetAvogadro();
    }

    function increaseMoleculeCount() {
      if (moleculeCount < MAX_MOLECULES) {
        moleculeCount++;
        updateAvogadroVisuals();
      }
    }

    function updateAvogadroVisuals() {
      avogadroCounter.textContent = `Molecules: ${moleculeCount}`;
      avogadroBg.textContent = moleculeCount;

      const scaleFactor = 1 + (moleculeCount / MAX_MOLECULES) * 1.5;
      const newSize = Math.min(100 * scaleFactor, BALLOON_MAX_SIZE);

      avogadroBalloon.style.width = `${newSize}px`;
      avogadroBalloon.style.height = `${newSize * 1.5}px`;

      if (moleculeCount >= MAX_MOLECULES) {
        avogadroBtn.style.display = 'none';
        getNewOneBtn.style.display = 'block';
        popBalloon();
      } else {
        avogadroBtn.style.display = 'block';
        getNewOneBtn.style.display = 'none';
        avogadroBalloon.classList.remove('pop');
        avogadroBalloon.style.background = `radial-gradient(circle at 75% 30%, #fff, #ff5a5f 20%, #dd2c00 100%)`;
      }
    }

    function popBalloon() {
      popSound.play();
      avogadroBalloon.classList.add('pop');
      avogadroBalloon.style.background = 'transparent';
      setTimeout(() => {
        avogadroBalloon.style.width = '0px';
        avogadroBalloon.style.height = '0px';
      }, 100); // Wait a bit for the animation to start before resizing
    }

    function resetAvogadro() {
      moleculeCount = 0;
      avogadroBalloon.style.width = '100px';
      avogadroBalloon.style.height = '150px';
      updateAvogadroVisuals();
    }

  </script>

</body>
</html>
