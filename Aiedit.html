<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecology Pro | AI Elite Grade 9 Science</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #10b981;
            --bg: #0b0f1a;
        }
        body {
            font-family: 'Inter', 'Prompt', sans-serif;
            background-color: var(--bg);
            color: #f8fafc;
            overflow-x: hidden;
        }
        .glass {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .asia-mode-active {
            --primary: #ef4444;
            background-color: #1a0505;
        }
        .choice-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .choice-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        .choice-correct {
            background: rgba(16, 185, 129, 0.15) !important;
            border-color: #10b981 !important;
            color: #34d399 !important;
        }
        .choice-wrong {
            background: rgba(239, 68, 68, 0.15) !important;
            border-color: #ef4444 !important;
            color: #f87171 !important;
        }
        .gradient-text {
            background: linear-gradient(135deg, #34d399 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .asia-gradient-text {
            background: linear-gradient(135deg, #ff0000 0%, #7c0000 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 20px 5px rgba(239, 68, 68, 0.2); }
        }
        .asia-pulse { animation: pulse-red 2s infinite; }

        /* AI Loading Animation */
        .dna-spine {
            animation: rotate 2s linear infinite;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col transition-colors duration-700">

    <!-- Navigation -->
    <nav class="glass sticky top-0 z-50 px-6 py-4 flex justify-between items-center border-b border-white/5">
        <div class="flex items-center gap-2">
            <div id="logo-box" class="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center font-bold text-white transition-colors">E</div>
            <span class="font-bold text-xl tracking-tighter uppercase">Ecology<span id="logo-span" class="text-emerald-500 transition-colors">Pro</span> <span class="text-[10px] bg-white/10 px-2 py-0.5 rounded text-slate-400">AI Powered</span></span>
        </div>
        <div id="nav-progress" class="hidden md:flex items-center gap-4">
            <div class="text-right">
                <p class="text-[9px] text-slate-500 uppercase font-black tracking-widest">Mastery Level</p>
                <div class="flex items-center gap-2">
                    <div class="w-24 h-1 bg-slate-800 rounded-full overflow-hidden">
                        <div id="global-progress" class="h-full bg-emerald-500 transition-all duration-1000" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto max-w-4xl p-6">
        
        <!-- Topic Map -->
        <div id="course-map" class="py-8">
            <header class="mb-10">
                <h2 class="text-4xl font-black mb-2">AI Curriculum</h2>
                <p class="text-slate-400">Dynamic Biology for Competitive Grade 9 Students in Thailand.</p>
            </header>
            
            <div id="topic-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Topics injected by JS -->
            </div>
        </div>

        <!-- Mode Selection View -->
        <div id="mode-view" class="hidden py-12">
            <button onclick="showLearning()" class="mb-8 text-slate-500 hover:text-white flex items-center gap-2 transition-colors">
                ‚Üê Back to Lesson
            </button>
            <h2 class="text-3xl font-black mb-2 text-center">Select Difficulty</h2>
            <p class="text-slate-400 text-center mb-10">AI will generate 5 questions based on your choice.</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <button onclick="setDifficulty('easy')" class="glass p-6 rounded-2xl border-l-4 border-emerald-500 text-left hover:bg-emerald-500/10 transition-all">
                    <h3 class="font-bold text-emerald-500">Easy</h3>
                    <p class="text-xs text-slate-400">Basic recall of terms.</p>
                </button>
                <button onclick="setDifficulty('medium')" class="glass p-6 rounded-2xl border-l-4 border-blue-500 text-left hover:bg-blue-500/10 transition-all">
                    <h3 class="font-bold text-blue-500">Medium</h3>
                    <p class="text-xs text-slate-400">Conceptual application.</p>
                </button>
                <button onclick="setDifficulty('hard')" class="glass p-6 rounded-2xl border-l-4 border-orange-500 text-left hover:bg-orange-500/10 transition-all">
                    <h3 class="font-bold text-orange-500">Hard</h3>
                    <p class="text-xs text-slate-400">Thai M.3 School Exam level.</p>
                </button>
                <button onclick="setDifficulty('impossible')" class="glass p-6 rounded-2xl border-l-4 border-purple-500 text-left hover:bg-purple-500/10 transition-all">
                    <h3 class="font-bold text-purple-500">Impossible</h3>
                    <p class="text-xs text-slate-400">Competitive Entrance Level.</p>
                </button>
                <button onclick="setDifficulty('asia')" class="glass p-6 rounded-2xl border-l-4 border-red-600 text-left hover:bg-red-600/10 transition-all sm:col-span-2 lg:col-span-1 asia-pulse">
                    <h3 class="font-bold text-red-500">ASIA MODE</h3>
                    <p class="text-xs text-slate-400 font-bold uppercase">O-NET / Competitive Extreme.</p>
                </button>
            </div>
        </div>

        <!-- AI Loading Overlay -->
        <div id="ai-loading" class="hidden fixed inset-0 z-[100] flex flex-col items-center justify-center bg-slate-950/90 backdrop-blur-xl">
            <div class="w-24 h-24 mb-8 relative flex items-center justify-center">
                <div class="absolute inset-0 border-4 border-emerald-500/20 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-t-emerald-500 rounded-full dna-spine"></div>
                <span class="text-3xl">ü§ñ</span>
            </div>
            <h3 class="text-2xl font-black mb-2 animate-pulse">Generating Dynamic Quiz...</h3>
            <p class="text-slate-500 text-center px-6 max-w-sm">AI is formulating 5 unique questions based on Thai M.3 Curriculum standards.</p>
        </div>

        <!-- Content Area -->
        <div id="content-area" class="hidden py-4">
            <!-- Learning View -->
            <div id="learning-view" class="glass rounded-[2.5rem] overflow-hidden border border-white/10 shadow-2xl">
                <div id="topic-header" class="h-56 w-full flex flex-col items-center justify-center relative p-8 text-center">
                    <div id="topic-icon-large" class="text-5xl mb-4"></div>
                    <h1 id="topic-title" class="text-4xl md:text-5xl font-black text-white drop-shadow-2xl"></h1>
                    <p id="topic-title-th" class="text-white/60 font-semibold mt-2"></p>
                </div>
                
                <div class="p-8 md:p-14">
                    <div id="topic-explanation" class="prose prose-invert max-w-none text-slate-300 leading-relaxed text-lg"></div>
                    <div class="mt-12 pt-8 border-t border-white/5 flex justify-center">
                        <button onclick="showModeSelection()" class="bg-white text-slate-900 font-black py-5 px-14 rounded-2xl hover:scale-105 transition-all shadow-xl active:scale-95">
                            AI GENERATED EXAM
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quiz View -->
            <div id="quiz-view" class="hidden flex flex-col gap-6">
                <div class="glass rounded-3xl p-8 flex justify-between items-center border-b-4 border-primary">
                    <div>
                        <span id="diff-badge" class="px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest bg-white/10 text-white mb-2 inline-block">Difficulty</span>
                        <h2 class="text-2xl font-bold">Question <span id="q-number">1</span>/5</h2>
                    </div>
                    <div class="text-right">
                        <p class="text-xs font-bold text-slate-500 uppercase tracking-widest">Score</p>
                        <p class="text-3xl font-black" id="current-score">0</p>
                    </div>
                </div>

                <div class="glass rounded-[2rem] p-8 md:p-12 min-h-[400px]">
                    <h3 id="question-text" class="text-xl md:text-2xl font-bold mb-10 text-white leading-tight"></h3>
                    <div id="choices-grid" class="grid grid-cols-1 gap-4"></div>

                    <!-- Post-Answer Explanation Box -->
                    <div id="answer-feedback" class="hidden mt-8 p-6 rounded-2xl border transition-all animate-in zoom-in duration-300">
                        <div class="flex items-center gap-3 mb-4">
                            <div id="feedback-icon" class="w-8 h-8 rounded-full flex items-center justify-center font-bold"></div>
                            <h4 id="feedback-title" class="font-black uppercase tracking-tighter"></h4>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <p class="text-[10px] font-black uppercase text-slate-500 mb-1">AI Scientific Explanation</p>
                                <p id="exp-en" class="text-sm text-slate-300 leading-relaxed italic"></p>
                            </div>
                            <div class="border-l border-white/10 pl-6">
                                <p class="text-[10px] font-black uppercase text-slate-500 mb-1 text-emerald-500/70">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å (‡πÑ‡∏ó‡∏¢)</p>
                                <p id="exp-th" class="text-sm text-slate-300 leading-relaxed"></p>
                            </div>
                        </div>
                    </div>

                    <button id="next-q-btn" onclick="nextQuestion()" class="hidden mt-10 w-full bg-white text-slate-900 font-black py-5 rounded-2xl hover:bg-slate-200 transition-all shadow-xl">
                        CONTINUE
                    </button>
                </div>
            </div>

            <!-- Result View -->
            <div id="result-view" class="hidden glass rounded-[3rem] p-12 text-center border-t-8 border-emerald-500">
                <h2 class="text-5xl font-black mb-4" id="result-status">Session Complete</h2>
                <p class="text-slate-400 mb-10">AI performance analysis for this topic.</p>
                <div class="text-8xl font-black mb-10 gradient-text" id="final-score-display">0/5</div>
                <div id="asia-rank" class="hidden mb-8 text-red-500 font-black tracking-widest animate-pulse">RANK: ASIA LEGEND</div>
                <button onclick="showMap()" class="bg-emerald-500 text-white font-black py-5 px-16 rounded-2xl hover:bg-emerald-400 transition-all shadow-2xl">
                    BACK TO CURRICULUM
                </button>
            </div>
        </div>
    </main>

    <script>
        const apiKey = ""; // Provisioned by environment
        const topics = [
            {
                id: 'trophic-dynamics',
                title: 'Trophic Dynamics',
                titleTh: '‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (‡∏´‡πà‡∏ß‡∏á‡πÇ‡∏ã‡πà‡∏≠‡∏≤‡∏´‡∏≤‡∏£)',
                icon: '‚ö°',
                color: 'from-blue-600 to-indigo-700',
                explanation: `
                    <div class="space-y-6">
                        <p>Energy in an ecosystem flows in one direction, starting from <strong>Producers (Autotrophs)</strong>. Focus on <strong>10% Law</strong> and <strong>Biomagnification</strong>.</p>
                        <p class="text-emerald-400">‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏é 10% ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏™‡∏°‡∏™‡∏≤‡∏£‡∏û‡∏¥‡∏©‡πÉ‡∏ô‡∏´‡πà‡∏ß‡∏á‡πÇ‡∏ã‡πà‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Biomagnification)</p>
                    </div>
                `
            },
            {
                id: 'consumers-decomposers',
                title: 'Consumer Specialization',
                titleTh: '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏¢‡πà‡∏≠‡∏¢‡∏™‡∏•‡∏≤‡∏¢',
                icon: 'üêæ',
                color: 'from-orange-500 to-red-600',
                explanation: `
                    <div class="space-y-6">
                        <p>Difference between <strong>Detritivores</strong> (Physically ingest) and <strong>Decomposers</strong> (External digestion via enzymes).</p>
                        <p class="text-orange-400">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏Å‡∏¥‡∏ô‡∏ã‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏¢‡πà‡∏≠‡∏¢‡∏™‡∏•‡∏≤‡∏¢‡∏™‡∏≤‡∏£‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡πå</p>
                    </div>
                `
            },
            {
                id: 'symbiosis-advanced',
                title: 'Elite Symbiosis',
                titleTh: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏¥‡πà‡∏á‡∏°‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï',
                icon: 'üß¨',
                color: 'from-emerald-500 to-teal-700',
                explanation: `
                    <div class="space-y-6">
                        <p>Comparison between <strong>Mutualism</strong> (Mandatory) and <strong>Protocooperation</strong> (Optional).</p>
                        <p class="text-emerald-400">‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏ß‡∏∞‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡πÅ‡∏•‡∏∞‡∏†‡∏≤‡∏ß‡∏∞‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô</p>
                    </div>
                `
            }
        ];

        // --- STATE ---
        let currentTopic = null;
        let currentDifficulty = 'medium';
        let quizState = { active: false, questionIndex: 0, score: 0, questions: [] };
        let completed = new Set();

        // --- API INTEGRATION ---
        async function generateQuestions(topic, diff) {
            const systemPrompt = `You are an elite Biology Professor specializing in the Thai Grade 9 (Mathayom 3) curriculum. 
            Generate exactly 5 high-quality multiple choice questions for the topic: "${topic.title}".
            Difficulty Level: ${diff}.
            Note: "Asia Mode" means competitive level (O-NET/Entrance exams). 
            
            Return ONLY a JSON object with this schema:
            {
                "questions": [
                    {
                        "q": "question text in English",
                        "a": "correct answer string",
                        "c": ["choice 1", "choice 2", "choice 3", "choice 4"],
                        "exEn": "detailed explanation in English",
                        "exTh": "detailed explanation in Thai (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)"
                    }
                ]
            }`;

            const userPrompt = `Generate 5 unique questions about ${topic.title} at ${diff} difficulty. Ensure they are unique and academically challenging.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                if (!response.ok) throw new Error('API Error');
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                return JSON.parse(text).questions;
            } catch (error) {
                console.error("AI Generation failed, using fallback logic...", error);
                return null; 
            }
        }

        // --- DOM CONTROLS ---
        function init() { renderMap(); }

        function renderMap() {
            document.getElementById('topic-grid').innerHTML = topics.map((t, i) => `
                <div onclick="selectTopic(${i})" class="glass p-8 rounded-[2rem] cursor-pointer hover:border-emerald-500/50 transition-all group">
                    <div class="flex items-center gap-6">
                        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br ${t.color} flex items-center justify-center text-3xl shadow-xl group-hover:scale-110 transition-transform">
                            ${t.icon}
                        </div>
                        <div>
                            <h3 class="text-xl font-bold">${t.title}</h3>
                            <p class="text-slate-500 text-sm font-semibold">${t.titleTh}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectTopic(idx) {
            currentTopic = topics[idx];
            document.getElementById('topic-title').innerText = currentTopic.title;
            document.getElementById('topic-title-th').innerText = currentTopic.titleTh;
            document.getElementById('topic-explanation').innerHTML = currentTopic.explanation;
            document.getElementById('topic-icon-large').innerText = currentTopic.icon;
            document.getElementById('topic-header').className = `h-56 w-full flex flex-col items-center justify-center relative p-8 text-center bg-gradient-to-br ${currentTopic.color}`;
            
            document.getElementById('course-map').classList.add('hidden');
            document.getElementById('content-area').classList.remove('hidden');
            document.getElementById('learning-view').classList.remove('hidden');
            document.getElementById('quiz-view').classList.add('hidden');
            document.getElementById('result-view').classList.add('hidden');
            document.getElementById('mode-view').classList.add('hidden');
            window.scrollTo(0,0);
        }

        function showModeSelection() {
            document.getElementById('learning-view').classList.add('hidden');
            document.getElementById('mode-view').classList.remove('hidden');
        }

        async function setDifficulty(d) {
            currentDifficulty = d;
            document.getElementById('ai-loading').classList.remove('hidden');

            // Asia Mode Visuals
            if (d === 'asia') {
                document.body.classList.add('asia-mode-active');
                document.getElementById('logo-box').classList.replace('bg-emerald-500', 'bg-red-600');
                document.getElementById('logo-span').className = 'text-red-600';
                document.getElementById('diff-badge').className = 'px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest bg-red-600 text-white mb-2 inline-block';
                document.getElementById('diff-badge').innerText = 'ASIA MODE';
            } else {
                document.body.classList.remove('asia-mode-active');
                document.getElementById('logo-box').classList.replace('bg-red-600', 'bg-emerald-500');
                document.getElementById('logo-span').className = 'text-emerald-500';
                document.getElementById('diff-badge').className = 'px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest bg-white/10 text-white mb-2 inline-block';
                document.getElementById('diff-badge').innerText = d;
            }

            // Generate fresh AI questions
            const generated = await generateQuestions(currentTopic, d);
            
            if (generated && generated.length === 5) {
                quizState = { active: true, questionIndex: 0, score: 0, questions: generated };
                document.getElementById('ai-loading').classList.add('hidden');
                document.getElementById('mode-view').classList.add('hidden');
                document.getElementById('quiz-view').classList.remove('hidden');
                renderQuestion();
            } else {
                alert("AI Generation failed. Please check your connection or try again.");
                document.getElementById('ai-loading').classList.add('hidden');
            }
        }

        function renderQuestion() {
            const q = quizState.questions[quizState.questionIndex];
            document.getElementById('q-number').innerText = quizState.questionIndex + 1;
            document.getElementById('current-score').innerText = quizState.score;
            document.getElementById('question-text').innerText = q.q;
            document.getElementById('answer-feedback').classList.add('hidden');
            document.getElementById('next-q-btn').classList.add('hidden');

            const choices = [...q.c].sort(() => Math.random() - 0.5);
            document.getElementById('choices-grid').innerHTML = choices.map(c => `
                <button onclick="checkAnswer('${c.replace(/'/g, "\\'")}')" class="choice-btn w-full p-5 rounded-2xl text-left font-bold glass">
                    ${c}
                </button>
            `).join('');
        }

        function checkAnswer(choice) {
            const q = quizState.questions[quizState.questionIndex];
            const isCorrect = choice.trim() === q.a.trim();
            const buttons = document.querySelectorAll('#choices-grid button');

            buttons.forEach(b => {
                b.disabled = true;
                if (b.innerText.trim() === q.a.trim()) b.classList.add('choice-correct');
                else if (b.innerText.trim() === choice.trim() && !isCorrect) b.classList.add('choice-wrong');
            });

            if (isCorrect) quizState.score++;

            const feedback = document.getElementById('answer-feedback');
            feedback.classList.remove('hidden');
            feedback.className = `mt-8 p-6 rounded-2xl border transition-all animate-in zoom-in duration-300 ${isCorrect ? 'bg-emerald-500/10 border-emerald-500/30' : 'bg-red-500/10 border-red-500/30'}`;
            
            document.getElementById('feedback-icon').innerText = isCorrect ? '‚úì' : '‚úï';
            document.getElementById('feedback-icon').className = `w-8 h-8 rounded-full flex items-center justify-center font-bold ${isCorrect ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`;
            document.getElementById('feedback-title').innerText = isCorrect ? 'AI Verified' : 'AI Logic Check';
            document.getElementById('feedback-title').className = `font-black uppercase tracking-tighter ${isCorrect ? 'text-emerald-500' : 'text-red-500'}`;
            
            document.getElementById('exp-en').innerText = q.exEn;
            document.getElementById('exp-th').innerText = q.exTh;

            const next = document.getElementById('next-q-btn');
            next.classList.remove('hidden');
            next.innerText = quizState.questionIndex === 4 ? "FINISH SESSION" : "NEXT CHALLENGE";
        }

        function nextQuestion() {
            if (quizState.questionIndex < 4) {
                quizState.questionIndex++;
                renderQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quiz-view').classList.add('hidden');
            document.getElementById('result-view').classList.remove('hidden');
            document.getElementById('final-score-display').innerText = `${quizState.score}/5`;
            
            if (currentDifficulty === 'asia') {
                document.getElementById('asia-rank').classList.remove('hidden');
                document.getElementById('final-score-display').className = 'text-8xl font-black mb-10 asia-gradient-text';
            } else {
                document.getElementById('asia-rank').classList.add('hidden');
                document.getElementById('final-score-display').className = 'text-8xl font-black mb-10 gradient-text';
            }

            if (quizState.score >= 3) {
                completed.add(currentTopic.id);
                const progress = Math.round((completed.size / topics.length) * 100);
                document.getElementById('global-progress').style.width = progress + '%';
            }
        }

        function showMap() {
            document.getElementById('content-area').classList.add('hidden');
            document.getElementById('course-map').classList.remove('hidden');
            document.body.classList.remove('asia-mode-active');
            window.scrollTo(0,0);
        }

        function showLearning() {
            document.getElementById('mode-view').classList.add('hidden');
            document.getElementById('learning-view').classList.remove('hidden');
        }

        window.onload = init;
    </script>
</body>
</html>

