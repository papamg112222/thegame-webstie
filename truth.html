<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Finger Roulette - Truth or Dare</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Disable selection and touch actions for the game area */
        body {
            overscroll-behavior: none;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
            background-color: #030712; /* gray-950 */
            color: white;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow: hidden;
        }

        /* Custom Animations */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 3s linear infinite;
        }

        /* Finger Element Base Styles */
        .finger-touch {
            position: absolute;
            width: 8rem; /* 32 * 0.25rem */
            height: 8rem;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
            /* IMPORTANT: No transition on left/top for zero lag */
            transition: opacity 0.2s, transform 0.2s;
            z-index: 10;
        }

        .finger-inner {
            position: relative;
            width: 4rem; /* 16 */
            height: 4rem;
            border-radius: 9999px;
            border: 4px solid white;
            box-shadow: 0 0 20px currentColor;
            background-color: currentColor;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .winner-icon {
            display: none;
            width: 2rem;
            height: 2rem;
            color: white;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }

        /* State: Roulette Active Highlight */
        .is-highlighted {
            z-index: 50 !important;
            transform: translate(-50%, -50%) scale(1.5) !important;
            opacity: 1 !important;
        }
        .is-highlighted .finger-inner {
            box-shadow: 0 0 60px currentColor;
        }
        .highlight-ring {
            position: absolute;
            inset: -10px;
            border-radius: 9999px;
            border: 4px solid white;
            box-shadow: 0 0 50px white;
            opacity: 0;
            transition: opacity 0.1s;
        }
        .is-highlighted .highlight-ring {
            opacity: 1;
        }

        /* State: Dimmed */
        .is-dimmed {
            opacity: 0.2 !important;
            transform: translate(-50%, -50%) scale(0.8) !important;
        }

        /* State: Winner */
        .is-winner {
            z-index: 100 !important;
            transform: translate(-50%, -50%) scale(1.6) !important;
            opacity: 1 !important;
        }
        .is-winner .winner-icon {
            display: block;
        }
        .winner-ring {
            position: absolute;
            inset: -25px;
            border-radius: 9999px;
            border: 4px solid currentColor;
            opacity: 0;
        }
        .is-winner .winner-ring {
            animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        @keyframes ping {
            75%, 100% { transform: scale(2); opacity: 0; }
        }

        /* UI Layers */
        #ui-layer { pointer-events: none; z-index: 20; position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #choice-layer { z-index: 50; position: absolute; inset: 0; display: none; flex-direction: column; }
        #result-layer { z-index: 60; position: absolute; inset: 0; display: none; align-items: center; justify-content: center; }
        
        .fade-out { opacity: 0; transition: opacity 1s; }
        .fade-in { opacity: 1; transition: opacity 0.5s; }

        /* SVG Icons */
        .icon { width: 100%; height: 100%; }
        
        /* Mobile Breakpoint for Choice Screen */
        @media (min-width: 768px) {
            #choice-layer { flex-direction: row; }
        }
    </style>
</head>
<body>

    <!-- Dynamic Container for Fingers -->
    <div id="fingers-container" class="absolute inset-0 w-full h-full"></div>

    <!-- UI: Instructions / Countdown / Winner Text -->
    <div id="ui-layer" class="transition-opacity duration-1000">
        <!-- Idle State -->
        <div id="idle-ui" class="text-center animate-pulse">
            <div class="bg-gray-800/80 backdrop-blur-md p-6 rounded-2xl border border-gray-700 shadow-xl max-w-xs mx-4">
                <div class="w-12 h-12 mx-auto mb-4 text-cyan-400">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-200">Finger Roulette</h1>
                <p class="text-gray-400 mt-2">Place fingers to start</p>
                <p class="text-gray-500 text-xs mt-1">Up to 10 players</p>
                <button onclick="game.clearHistory()" class="mt-4 text-xs text-gray-600 underline pointer-events-auto">Reset Question History</button>
            </div>
        </div>

        <!-- Countdown -->
        <div id="countdown-ui" class="hidden text-9xl font-black text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.8)] animate-bounce">3</div>

        <!-- Winner Announcement -->
        <div id="winner-ui" class="hidden text-center animate-in zoom-in duration-300">
            <div id="winner-name" class="text-6xl font-black tracking-widest uppercase drop-shadow-[0_0_20px_rgba(0,0,0,0.8)]">PLAYER</div>
            <div class="text-xl font-bold text-white mt-2">IS THE WINNER!</div>
        </div>
    </div>

    <!-- UI: Choice (Truth or Dare) -->
    <div id="choice-layer">
        <!-- Truth Button -->
        <button onclick="game.selectQuestion('TRUTH')" class="flex-1 bg-blue-600 active:bg-blue-700 hover:bg-blue-500 transition-colors flex flex-col items-center justify-center relative overflow-hidden group cursor-pointer touch-manipulation">
            <div class="absolute inset-0 bg-gradient-to-br from-cyan-400/20 to-blue-900/40 pointer-events-none"></div>
            <div class="w-24 h-24 mb-6 text-white drop-shadow-lg transform group-hover:scale-110 transition-transform pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
            </div>
            <h2 class="text-6xl font-black tracking-tighter text-white drop-shadow-md pointer-events-none">TRUTH</h2>
        </button>

        <!-- Divider -->
        <div class="h-2 w-full md:w-2 md:h-full bg-black z-50 flex items-center justify-center shrink-0">
            <div class="bg-black text-white text-xs font-bold px-2 py-1 rounded-full border border-gray-700">OR</div>
        </div>

        <!-- Dare Button -->
        <button onclick="game.selectQuestion('DARE')" class="flex-1 bg-red-600 active:bg-red-700 hover:bg-red-500 transition-colors flex flex-col items-center justify-center relative overflow-hidden group cursor-pointer touch-manipulation">
            <div class="absolute inset-0 bg-gradient-to-tl from-orange-400/20 to-red-900/40 pointer-events-none"></div>
            <div class="w-24 h-24 mb-6 text-white drop-shadow-lg transform group-hover:scale-110 transition-transform pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
            </div>
            <h2 class="text-6xl font-black tracking-tighter text-white drop-shadow-md pointer-events-none">DARE</h2>
        </button>
    </div>

    <!-- UI: Result (The Question) -->
    <div id="result-layer">
        <div id="result-bg" class="absolute inset-0 bg-gray-900 transition-colors duration-500"></div>
        <div class="bg-white text-gray-900 w-full max-w-md rounded-3xl shadow-2xl p-8 text-center relative overflow-hidden animate-in fade-in zoom-in duration-300 z-10 m-4">
            <div id="result-badge" class="inline-flex items-center gap-2 px-4 py-1 rounded-full text-sm font-bold mb-6 tracking-wide text-white bg-gray-600">
                TYPE
            </div>

            <h3 id="result-text" class="text-2xl md:text-3xl font-bold leading-tight mb-12 min-h-[120px] flex items-center justify-center">
                Loading...
            </h3>

            <button onclick="game.resetGame()" class="w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 active:scale-95 transition-all flex items-center justify-center gap-2 cursor-pointer touch-manipulation">
                Next Round 
                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
            </button>
        </div>
    </div>

    <script>
        // --- DATA ---
        const TRUTH_LIST = [
            "What is the most embarrassing thing you've ever done in public?",
            "Who is your secret crush right now?",
            "What is the biggest lie you've ever told your parents?",
            "If you could swap lives with one person in this room, who would it be and why?",
            "What is a secret youâ€™ve never told anyone?",
            "What is the weirdest thing you have ever eaten?",
            "When was the last time you cried and why?",
            "What is your biggest fear?",
            "Who is the last person you searched on Instagram?",
            "If you had to delete one app from your phone forever, which one would it be?",
            "What is the most trouble you've ever been in at school or work?",
            "Have you ever peed in a pool?",
            "What is the pettiest thing you've ever done?",
            "Who in this room do you think would survive a zombie apocalypse first?",
            "What is your worst habit?",
            "Have you ever ghosted someone? Why?",
            "What's the longest you've gone without showering?",
            "If you could only eat one meal for the rest of your life, what would it be?",
            "What is the most expensive thing you've bought and regretted?",
            "Have you ever stalked an ex online?",
            "What is the dumbest way you've ever injured yourself?",
            "Have you ever lied to get out of hanging out with someone?",
            "What is a movie you secretly love but everyone else hates?",
            "Who here has the worst fashion sense?",
            "What is your most embarrassing nickname?",
            "Have you ever broken the law?",
            "If you were invisible for a day, what would you do?",
            "What is the grossest thing you do when you're alone?",
            "Who is the most annoying person you know?",
            "Have you ever successfully cheated on a test?",
            "What is the worst gift you have ever received?",
            "Who was your first celebrity crush?",
            "If you could date anyone in this room, who would it be?",
            "What is the last thing you Googled?",
            "Have you ever practiced kissing on your hand?",
            "What's the worst haircut you've ever had?",
            "Have you ever accidentally sent a text to the wrong person?",
            "What is one thing you would change about your physical appearance?",
            "Who is the best kisser you've ever had?",
            "Have you ever fallen asleep in class?",
            "What is your guilty pleasure song?",
            "Have you ever pretended to like a gift?",
            "What is the most awkward date you've ever been on?",
            "Have you ever picked your nose and ate it?",
            "What is your biggest insecurity?",
            "Who in this room do you trust the least?",
            "Have you ever stolen something?",
            "What is the craziest rumor you've heard about yourself?",
            "If you had to marry one person in this room, who would it be?",
            "What is the longest you've gone without brushing your teeth?"
        ];

        const DARE_LIST = [
            "Do 10 pushups immediately.",
            "Let the group look through your phone gallery for 1 minute.",
            "Post an embarrassing photo of yourself on your Instagram story for 10 minutes.",
            "Let the person to your right text anyone from your contacts.",
            "Speak in a weird accent for the next 3 rounds.",
            "Eat a spoonful of a condiment of the group's choice.",
            "Do your best impression of someone in the room.",
            "Let the group style your hair however they want.",
            "Sing the chorus of your favorite song loudly.",
            "Walk like a crab across the room.",
            "Hold a plank for 30 seconds.",
            "Let someone draw a mustache on you with a pen (or marker if you're brave).",
            "Call a random contact and sing 'Happy Birthday' to them.",
            "Act like a chicken until your next turn.",
            "Tell a joke. If no one laughs, do 5 burpees.",
            "Let the group mix a 'mystery drink' (safe liquids only) and drink it.",
            "Show the last photo you took on your phone.",
            "Send a risky text to your crush (or a random friend).",
            "Spin around 10 times and try to walk in a straight line.",
            "Balance a spoon on your nose for 10 seconds.",
            "Bark like a dog for 20 seconds.",
            "Let someone in the group tickle you for 15 seconds.",
            "Smell the feet of the person to your left.",
            "Talk without closing your mouth for the next round.",
            "Try to lick your elbow.",
            "Let the group give you a new nickname.",
            "Dance with no music for 1 minute.",
            "Do an impression of a baby being born.",
            "Let someone write a word on your forehead with a marker.",
            "Eat a raw piece of garlic or onion.",
            "Let the group pose you for an embarrassing photo.",
            "Speak in a whisper for the next 3 turns.",
            "Trade a piece of clothing with someone (if they agree).",
            "Imitate a monkey until your next turn.",
            "Let someone look through your YouTube search history.",
            "Drink a glass of water without using your hands.",
            "Wrap yourself in toilet paper like a mummy.",
            "Try to juggle 3 items of the group's choice.",
            "Let the group DM someone on your Instagram.",
            "Read the last text message you received out loud.",
            "Walk backwards for the rest of the game.",
            "Try to touch your nose with your tongue.",
            "Let the group decide your next profile picture for 24 hours.",
            "Do a handstand (or try to) against the wall.",
            "Pretend to be a waiter/waitress and take drink orders.",
            "Let someone redo your eyebrows with a marker.",
            "Hold an ice cube in your hand until it melts.",
            "Make up a rap about the person to your right.",
            "Act like a statue for 1 minute.",
            "Yell out the first word that comes to your mind right now."
        ];

        const PLAYER_COLORS = [
            '#FF0055', '#00FF99', '#00CCFF', '#FFAA00', '#CC00FF', 
            '#FFFF00', '#FF00FF', '#00FFFF', '#88FF00', '#FFFFFF'
        ];

        const getColorName = (hex) => {
            const map = {
                '#FF0055': 'RED', '#00FF99': 'GREEN', '#00CCFF': 'BLUE', '#FFAA00': 'ORANGE',
                '#CC00FF': 'PURPLE', '#FFFF00': 'YELLOW', '#FF00FF': 'MAGENTA', '#00FFFF': 'CYAN',
                '#88FF00': 'LIME', '#FFFFFF': 'WHITE'
            };
            return map[hex] || 'PLAYER';
        };

        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        // --- GAME LOGIC ---
        class FingerRoulette {
            constructor() {
                this.container = document.getElementById('fingers-container');
                this.touches = {}; // { identifier: {x, y, color, element} }
                this.state = 'IDLE'; // IDLE, COUNTDOWN, ROULETTE, SELECTED, CHOICE, RESULT
                this.countdownVal = 3;
                
                // Load decks from localStorage or init new ones
                this.loadDecks();
                
                // Elements
                this.idleUi = document.getElementById('idle-ui');
                this.countdownUi = document.getElementById('countdown-ui');
                this.winnerUi = document.getElementById('winner-ui');
                this.winnerName = document.getElementById('winner-name');
                this.uiLayer = document.getElementById('ui-layer');
                this.choiceLayer = document.getElementById('choice-layer');
                this.resultLayer = document.getElementById('result-layer');

                this.bindEvents();
            }

            loadDecks() {
                const savedTruths = localStorage.getItem('fr_truth_deck');
                const savedDares = localStorage.getItem('fr_dare_deck');

                if (savedTruths && JSON.parse(savedTruths).length > 0) {
                    this.truthDeck = JSON.parse(savedTruths);
                } else {
                    this.truthDeck = shuffleArray(TRUTH_LIST);
                    localStorage.setItem('fr_truth_deck', JSON.stringify(this.truthDeck));
                }

                if (savedDares && JSON.parse(savedDares).length > 0) {
                    this.dareDeck = JSON.parse(savedDares);
                } else {
                    this.dareDeck = shuffleArray(DARE_LIST);
                    localStorage.setItem('fr_dare_deck', JSON.stringify(this.dareDeck));
                }
            }

            saveDecks() {
                localStorage.setItem('fr_truth_deck', JSON.stringify(this.truthDeck));
                localStorage.setItem('fr_dare_deck', JSON.stringify(this.dareDeck));
            }

            clearHistory() {
                localStorage.removeItem('fr_truth_deck');
                localStorage.removeItem('fr_dare_deck');
                this.loadDecks();
                alert("Question history reset! New questions will be shuffled.");
            }

            bindEvents() {
                const el = document.body;
                
                // Non-passive listeners to block scrolling
                el.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: false });
                el.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });
                el.addEventListener('touchend', this.handleTouchEnd.bind(this), { passive: false });
                el.addEventListener('touchcancel', this.handleTouchEnd.bind(this), { passive: false });
            }

            handleTouchStart(e) {
                // Allow interactions in choice/result phases
                if (this.state === 'CHOICE' || this.state === 'RESULT') return;
                
                e.preventDefault();

                // Block new fingers during animation
                if (this.state !== 'IDLE' && this.state !== 'COUNTDOWN') return;

                const changed = e.changedTouches;
                const usedColors = new Set(Object.values(this.touches).map(t => t.color));

                for (let i = 0; i < changed.length; i++) {
                    const t = changed[i];
                    if (!this.touches[t.identifier] && Object.keys(this.touches).length < 10) {
                        
                        // Assign color
                        const color = PLAYER_COLORS.find(c => !usedColors.has(c)) || '#FFFFFF';
                        usedColors.add(color);

                        // Create DOM Element
                        const div = document.createElement('div');
                        div.className = 'finger-touch';
                        div.style.left = t.clientX + 'px';
                        div.style.top = t.clientY + 'px';
                        div.style.color = color; // Used for currentColor
                        div.innerHTML = `
                            <div class="winner-ring"></div>
                            <div class="highlight-ring"></div>
                            <div class="finger-inner">
                                <svg class="winner-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                            </div>
                        `;
                        this.container.appendChild(div);

                        this.touches[t.identifier] = {
                            id: t.identifier,
                            x: t.clientX,
                            y: t.clientY,
                            color: color,
                            element: div
                        };
                    }
                }

                this.checkGameState();
            }

            handleTouchMove(e) {
                if (this.state === 'CHOICE' || this.state === 'RESULT') return;
                e.preventDefault();

                const changed = e.changedTouches;
                for (let i = 0; i < changed.length; i++) {
                    const t = changed[i];
                    const touchObj = this.touches[t.identifier];
                    if (touchObj) {
                        touchObj.x = t.clientX;
                        touchObj.y = t.clientY;
                        // Direct DOM update for zero lag
                        touchObj.element.style.left = t.clientX + 'px';
                        touchObj.element.style.top = t.clientY + 'px';
                    }
                }
            }

            handleTouchEnd(e) {
                if (this.state === 'CHOICE' || this.state === 'RESULT') return;
                e.preventDefault();
                
                // Don't remove fingers during selection animation
                if (this.state === 'ROULETTE' || this.state === 'SELECTED') return;

                const changed = e.changedTouches;
                for (let i = 0; i < changed.length; i++) {
                    const t = changed[i];
                    const touchObj = this.touches[t.identifier];
                    if (touchObj) {
                        touchObj.element.remove();
                        delete this.touches[t.identifier];
                    }
                }

                this.checkGameState();
            }

            checkGameState() {
                const count = Object.keys(this.touches).length;

                if (this.state === 'IDLE' && count > 1) {
                    this.startCountdown();
                } else if (this.state === 'COUNTDOWN' && count < 2) {
                    this.cancelCountdown();
                }
            }

            startCountdown() {
                this.state = 'COUNTDOWN';
                this.countdownVal = 3;
                this.uiLayer.style.opacity = '1';
                this.idleUi.classList.add('hidden');
                this.countdownUi.classList.remove('hidden');
                this.countdownUi.textContent = this.countdownVal;

                this.timer = setInterval(() => {
                    this.countdownVal--;
                    if (this.countdownVal > 0) {
                        this.countdownUi.textContent = this.countdownVal;
                    } else {
                        clearInterval(this.timer);
                        this.startRoulette();
                    }
                }, 1000);
            }

            cancelCountdown() {
                clearInterval(this.timer);
                this.state = 'IDLE';
                this.idleUi.classList.remove('hidden');
                this.countdownUi.classList.add('hidden');
            }

            startRoulette() {
                const touchIds = Object.keys(this.touches);
                if (touchIds.length === 0) {
                    this.cancelCountdown();
                    return;
                }

                this.state = 'ROULETTE';
                this.countdownUi.classList.add('hidden');
                this.uiLayer.style.opacity = '0'; // Hide UI during spin

                // Spatial Sorting (Clockwise)
                const centerX = touchIds.reduce((sum, id) => sum + this.touches[id].x, 0) / touchIds.length;
                const centerY = touchIds.reduce((sum, id) => sum + this.touches[id].y, 0) / touchIds.length;

                touchIds.sort((a, b) => {
                    const angleA = Math.atan2(this.touches[a].y - centerY, this.touches[a].x - centerX);
                    const angleB = Math.atan2(this.touches[b].y - centerY, this.touches[b].x - centerX);
                    return angleA - angleB;
                });

                const winnerIndex = Math.floor(Math.random() * touchIds.length);
                const winnerId = touchIds[winnerIndex];

                let currentIndex = 0;
                let steps = 0;
                let speed = 50;
                const minSpins = 4;
                const totalSteps = (touchIds.length * minSpins) + winnerIndex;

                const spin = () => {
                    // Update visual classes
                    const currentId = touchIds[currentIndex];
                    
                    // Reset all visual states
                    touchIds.forEach(id => {
                        const el = this.touches[id].element;
                        el.classList.remove('is-highlighted', 'is-dimmed');
                        if (id === currentId) {
                            el.classList.add('is-highlighted');
                        } else {
                            el.classList.add('is-dimmed');
                        }
                    });

                    currentIndex = (currentIndex + 1) % touchIds.length;
                    steps++;

                    // Speed curve
                    if (steps > totalSteps - 5) speed += 100;
                    else if (steps > totalSteps - 10) speed += 50;
                    else if (steps > totalSteps - 20) speed += 10;

                    if (steps <= totalSteps) {
                        setTimeout(spin, speed);
                    } else {
                        this.finishSelection(winnerId);
                    }
                };

                spin();
            }

            finishSelection(winnerId) {
                this.state = 'SELECTED';
                this.winnerId = winnerId;
                const winnerObj = this.touches[winnerId];

                // Visual cleanup
                Object.keys(this.touches).forEach(id => {
                    const el = this.touches[id].element;
                    el.classList.remove('is-highlighted', 'is-dimmed');
                    if (id === winnerId) {
                        el.classList.add('is-winner');
                    } else {
                        el.style.opacity = '0'; // Hide losers
                    }
                });

                // Show Winner UI
                this.uiLayer.style.opacity = '1';
                this.winnerUi.classList.remove('hidden');
                this.winnerName.textContent = getColorName(winnerObj.color);
                this.winnerName.style.color = winnerObj.color;

                setTimeout(() => {
                    this.showChoice();
                    this.touches = {}; // Reset logic but keep UI clean?
                    this.container.innerHTML = ''; // Clear fingers
                }, 2500);
            }

            showChoice() {
                this.state = 'CHOICE';
                this.uiLayer.classList.add('hidden');
                this.choiceLayer.style.display = 'flex';
                this.choiceLayer.classList.add('fade-in');
            }

            selectQuestion(type) {
                let text = "";
                let deck = type === 'TRUTH' ? this.truthDeck : this.dareDeck;
                
                if (deck.length === 0) {
                    deck = shuffleArray(type === 'TRUTH' ? TRUTH_LIST : DARE_LIST);
                    if (type === 'TRUTH') this.truthDeck = deck; else this.dareDeck = deck;
                }
                
                text = deck.pop();
                
                // Save state to localStorage after popping a question
                this.saveDecks();

                this.choiceLayer.style.display = 'none';
                this.showResult(type, text);
            }

            showResult(type, text) {
                this.state = 'RESULT';
                this.resultLayer.style.display = 'flex';
                
                const bg = document.getElementById('result-bg');
                const badge = document.getElementById('result-badge');
                const textEl = document.getElementById('result-text');

                bg.className = `absolute inset-0 transition-colors duration-500 ${type === 'TRUTH' ? 'bg-blue-900' : 'bg-red-900'}`;
                badge.className = `inline-flex items-center gap-2 px-4 py-1 rounded-full text-sm font-bold mb-6 tracking-wide text-white ${type === 'TRUTH' ? 'bg-blue-600' : 'bg-red-600'}`;
                badge.textContent = type;
                textEl.textContent = text;
            }

            resetGame() {
                this.state = 'IDLE';
                this.resultLayer.style.display = 'none';
                this.choiceLayer.style.display = 'none';
                this.uiLayer.classList.remove('hidden');
                this.idleUi.classList.remove('hidden');
                this.winnerUi.classList.add('hidden');
                this.touches = {};
                this.container.innerHTML = '';
            }
        }

        // Init
        const game = new FingerRoulette();
    </script>
</body>
</html>



