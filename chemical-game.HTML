<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gas Laws Game</title>
<style>
  body { font-family: Arial, sans-serif; background: #222; color: #eee; margin: 0; padding: 0; }
  #mainMenu, #boyleMode, #charlesMode, #gayLussacMode, #avogadroMode {
    display: none; padding: 20px;
  }
  .active { display: block; }
  #balloon {
    width: 150px; height: 200px;
    background: #f06;
    border-radius: 75px 75px 100px 100px;
    position: relative;
    margin: 20px auto;
  }
  #moleculeTeller {
    position: absolute;
    font-size: 72px;
    color: white;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0.5;
    user-select: none;
    pointer-events: none;
  }
  #boyleControls label, #charlesControls label, #avogadroControls label {
    display: block; margin-top: 10px;
  }
  input[type=range] {
    width: 200px;
  }
  #avogadroBalloonButton {
    background: linear-gradient(45deg, #4caf50, #087f23);
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 10px;
    transition: background 0.3s ease;
  }
  #avogadroBalloonButton:hover {
    background: linear-gradient(45deg, #087f23, #4caf50);
  }
  #balloonPopAnimation {
    position: relative;
    width: 150px; height: 200px;
    background: radial-gradient(circle at center, #f06 0%, transparent 80%);
    border-radius: 75px 75px 100px 100px;
    margin: 20px auto;
    animation: popAnim 0.6s ease forwards;
  }
  @keyframes popAnim {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(2); opacity: 0; }
  }
</style>
</head>
<body>

<!-- Main Menu -->
<div id="mainMenu" class="active">
  <h1>Gas Laws Game</h1>
  <button onclick="openMode('boyle')">Boyle's Law</button>
  <button onclick="openMode('charles')">Charles' Law</button>
  <button onclick="openMode('gayLussac')">Gay-Lussac's Law</button>
  <button onclick="openMode('avogadro')">Avogadro's Law</button>
</div>

<!-- Boyle's Law Mode -->
<div id="boyleMode">
  <h2>Boyle's Law Mode</h2>
  <div id="boyleControls">
    <label for="boyleTempSlider">Temperature (affects speed):</label>
    <input type="range" id="boyleTempSlider" min="0" max="100" value="50">

    <label for="massSlider">Mass (affects speed):</label>
    <input type="range" id="massSlider" min="1" max="10" step="0.1" value="5">
    <span id="massValue">5</span>
  </div>
  <canvas id="boyleCanvas" width="400" height="200" style="background:#333; display:block; margin-top:20px;"></canvas>
  <button onclick="backToMenu()">Back to Menu</button>
</div>

<!-- Charles' Law Mode -->
<div id="charlesMode">
  <h2>Charles' Law Mode</h2>
  <div id="charlesControls">
    <div id="charlesMoleculeTeller" style="position: relative; text-align: center;">
      <div id="moleculeTeller" style="top: 50px;">0</div>
      <div id="balloon"></div>
    </div>
    <button onclick="increaseCharlesMolecules()">Add Molecule</button>
  </div>
  <button onclick="backToMenu()">Back to Menu</button>
</div>

<!-- Gay-Lussac's Law Mode -->
<div id="gayLussacMode">
  <h2>Gay-Lussac's Law Mode</h2>
  <p>Mode unchanged as requested.</p>
  <button onclick="backToMenu()">Back to Menu</button>
</div>

<!-- Avogadro's Law Mode -->
<div id="avogadroMode">
  <h2>Avogadro's Law Mode</h2>
  <div id="avogadroControls" style="position: relative; text-align:center;">
    <div id="avogadroMoleculeTeller" style="position:absolute; top:10px; left:50%; transform: translateX(-50%); font-size: 80px; color: white; opacity: 0.6; user-select:none; pointer-events:none;">0</div>
    <div id="avogadroBalloon" style="width: 150px; height: 200px; background: #f06; border-radius: 75px 75px 100px 100px; margin: 60px auto; position: relative;"></div>
    <button id="avogadroBalloonButton" onclick="increaseAvogadroBalloon()">Increase Balloon Size</button>
  </div>
  <button onclick="backToMenu()">Back to Menu</button>
</div>

<audio id="popSound" src="https://www.soundjay.com/mechanical/sounds/balloon-pop-1.mp3"></audio>

<script>
  // Globals for modes
  let currentMode = null;

  // ---------------- Main menu and mode switch -------------------
  function openMode(mode) {
    currentMode = mode;
    // Hide all modes and main menu
    document.getElementById('mainMenu').classList.remove('active');
    ['boyleMode','charlesMode','gayLussacMode','avogadroMode'].forEach(id => document.getElementById(id).classList.remove('active'));
    // Show selected mode
    document.getElementById(mode + 'Mode').classList.add('active');

    // Reset or init mode specific things
    if (mode === 'boyle') initBoyle();
    else if (mode === 'charles') initCharles();
    else if (mode === 'avogadro') initAvogadro();
  }

  function backToMenu() {
    currentMode = null;
    document.getElementById('mainMenu').classList.add('active');
    ['boyleMode','charlesMode','gayLussacMode','avogadroMode'].forEach(id => document.getElementById(id).classList.remove('active'));
  }

  // ---------------- Boyle's Law Mode ----------------
  const boyleCanvas = document.getElementById('boyleCanvas');
  const ctx = boyleCanvas.getContext('2d');

  let boyleBall = { x: 50, y: 100, radius: 20, dx: 2 };
  let boyleBallSpeed = 2;
  const baseSpeed = 10;

  function initBoyle() {
    boyleBall.x = 50;
    boyleBallSpeed = baseSpeed / parseFloat(document.getElementById('massSlider').value);
    animateBoyle();

    // Setup sliders event listeners
    const tempSlider = document.getElementById('boyleTempSlider');
    const massSlider = document.getElementById('massSlider');
    const massValue = document.getElementById('massValue');

    tempSlider.oninput = () => {
      updateBoyleSpeed();
    };
    massSlider.oninput = () => {
      massValue.textContent = parseFloat(massSlider.value).toFixed(1);
      updateBoyleSpeed();
    };
  }

  function updateBoyleSpeed() {
    const temp = parseFloat(document.getElementById('boyleTempSlider').value);
    const mass = parseFloat(document.getElementById('massSlider').value);

    // Speed depends on temp * inverse mass
    boyleBallSpeed = (temp / 50) * (baseSpeed / mass);
    if (boyleBallSpeed < 0.5) boyleBallSpeed = 0.5; // minimum speed to keep moving
  }

  let boyleAnimationId;
  function animateBoyle() {
    ctx.clearRect(0, 0, boyleCanvas.width, boyleCanvas.height);

    // Draw ball
    ctx.beginPath();
    ctx.arc(boyleBall.x, boyleBall.y, boyleBall.radius, 0, Math.PI * 2);
    ctx.fillStyle = '#f06';
    ctx.fill();
    ctx.closePath();

    // Move ball
    boyleBall.x += boyleBallSpeed;
    if (boyleBall.x + boyleBall.radius > boyleCanvas.width || boyleBall.x - boyleBall.radius < 0) {
      boyleBallSpeed = -boyleBallSpeed;
    }

    boyleAnimationId = requestAnimationFrame(animateBoyle);
  }

  // Stop animation when leaving Boyle mode
  function stopBoyleAnimation() {
    if (boyleAnimationId) cancelAnimationFrame(boyleAnimationId);
  }

  // ---------------- Charles' Law Mode ----------------
  let charlesMolecules = 0;
  const charlesMoleculeTeller = document.getElementById('moleculeTeller');
  const charlesBalloon = document.getElementById('balloon');

  function initCharles() {
    charlesMolecules = 0;
    updateCharlesDisplay();
  }

  function increaseCharlesMolecules() {
    charlesMolecules++;
    updateCharlesDisplay();
  }

  function updateCharlesDisplay() {
    charlesMoleculeTeller.textContent = charlesMolecules;
    // Increase balloon size based on molecules (simple scale)
    const newWidth = 150 + charlesMolecules * 3;
    const newHeight = 200 + charlesMolecules * 4;
    charlesBalloon.style.width = newWidth + 'px';
    charlesBalloon.style.height = newHeight + 'px';
  }

  // ---------------- Avogadro's Law Mode ----------------
  let avogadroMolecules = 0;
  const avogadroMoleculeTeller = document.getElementById('avogadroMoleculeTeller');
  const avogadroBalloon = document.getElementById('avogadroBalloon');
  const avogadroButton = document.getElementById('avogadroBalloonButton');
  const popSound = document.getElementById('popSound');

  function initAvogadro() {
    avogadroMolecules = 0;
    avogadroMoleculeTeller.textContent = avogadroMolecules;
    avogadroBalloon.style.width = '150px';
    avogadroBalloon.style.height = '200px';
    avogadroBalloon.style.opacity = 1;
    avogadroBalloon.style.transition = 'none';
    avogadroButton.disabled = false;
    // Remove any balloon pop animation if leftover
    if(document.getElementById('balloonPopAnimation')) {
      document.getElementById('balloonPopAnimation').remove();
      avogadroBalloon.style.display = 'block';
    }
  }

  function increaseAvogadroBalloon() {
    if(avogadroMolecules >= 100) return; // Prevent after pop

    avogadroMolecules++;
    avogadroMoleculeTeller.textContent = avogadroMolecules;

    // Increase balloon size
    let width = avogadroBalloon.offsetWidth + 2;
    let height = avogadroBalloon.offsetHeight + 3;
    avogadroBalloon.style.width = width + 'px';
    avogadroBalloon.style.height = height + 'px';

    // Pop at 100 molecules
    if (avogadroMolecules >= 100) {
      popBalloon();
    }
  }

  function popBalloon() {
    // Play sound
    popSound.currentTime = 0;
    popSound.play();

    // Animate balloon pop
    avogadroBalloon.style.display = 'none';

    const popAnimDiv = document.createElement('div');
    popAnimDiv.id = 'balloonPopAnimation';
    document.getElementById('avogadroControls').appendChild(popAnimDiv);

    setTimeout(() => {
      popAnimDiv.remove();
      // Optionally reset balloon after pop
      initAvogadro();
    }, 1000);

    // Disable increase button
    avogadroButton.disabled = true;
  }

  // ---------------- Clean up animations when switching modes ----------------
  // Wrap mode changes to stop animations if needed
  function openModeWrapper(mode) {
    if (currentMode === 'boyle') stopBoyleAnimation();
    openMode(mode);
  }

  // Override main menu buttons to use wrapper
  document.querySelectorAll('#mainMenu button').forEach(btn => {
    btn.onclick = () => openModeWrapper(btn.textContent.toLowerCase().replace(/[' ]/g, ''));
  });

</script>
</body>
</html>
