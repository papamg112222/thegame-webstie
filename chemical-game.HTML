<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chemistry Modes</title>
<style>
  /* GENERAL */
  body {
    margin: 0; padding: 0;
    font-family: Arial, sans-serif;
    background: #222;
    color: #222;
    overflow-x: hidden;
  }
  button {
    cursor: pointer;
    font-size: 16px;
    padding: 8px 14px;
    border-radius: 5px;
    border: none;
    background-color: #2a7ae2;
    color: white;
    user-select: none;
  }
  button:active {
    background-color: #1856b9;
  }

  /* MAIN MENU */
  #mainMenu {
    position: relative;
    width: 100vw;
    height: 100vh;
    background: #111;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 28px;
    user-select: none;
  }
  #particleCanvas {
    position: absolute;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
  }
  #mainMenuButtons {
    position: relative;
    z-index: 10;
    display: flex;
    gap: 20px;
  }

  /* MODE CONTAINERS (hidden by default) */
  .mode {
    display: none;
    height: 100vh;
    width: 100vw;
    box-sizing: border-box;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding-top: 40px;
    color: #222;
  }

  /* BACKGROUNDS FOR MODES */
  #boyle {
    background: radial-gradient(circle at center, #ffe6e6, #ffb3b3);
  }
  #charles {
    background: linear-gradient(135deg, #fff5e6, #ffdb99);
  }
  #avogadro {
    background: radial-gradient(circle at center, #e6f7ff, #99ccff);
  }

  /* BOYLE MODE */
  #boyleCanvas {
    width: 300px;
    height: 300px;
    border: 3px solid #ff5a5f;
    background: #fff0f0;
    margin-bottom: 20px;
    display: block;
    box-sizing: border-box;
  }

  /* CHARLES MODE */
  #charlesBalloon {
    width: 100px;
    height: 150px;
    background-color: red;
    border-radius: 50% / 60%;
    opacity: 0.99; /* almost opaque */
    margin-bottom: 15px;
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
  }
  #charlesControls {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: bold;
  }
  #charlesTemp {
    width: 150px;
  }

  /* AVOGADRO MODE */
  #avogadroContainer {
    position: relative;
    width: 150px;
    height: 220px;
    border: 2px solid #004080;
    margin: 0 auto 20px auto;
    overflow: hidden;
    background: #d0e8ff;
    border-radius: 10px;
  }
  #avogadroBalloon {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 30px;
    height: 45px;
    background-color: #0066cc;
    border-radius: 50% / 60%;
    opacity: 0.75;
    box-shadow: 0 0 10px rgba(0, 102, 204, 0.5);
    transform: translate(-50%, -50%);
    transition: width 0.15s, height 0.15s;
  }
  /* Buttons swapped positions */
  #avogadroReturnBtn {
    position: relative;
    margin: 10px auto;
    bottom: 0;
  }
  #avogadroIncreaseBtn {
    position: relative;
    margin: 10px auto;
    bottom: 0;
  }
  #avogadroReturnBtn {
    margin-bottom: 60px;
  }
  #avogadroIncreaseBtn {
    margin-top: 10px;
  }

  /* Pop animation */
  @keyframes pop {
    0% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 0.75;
    }
    50% {
      transform: translate(-50%, -50%) scale(1.3);
      opacity: 0.4;
    }
    100% {
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
    }
  }
  .pop {
    animation: pop 0.5s forwards;
  }

  /* MOLECULE COUNTER */
  #avogadroMoleculeCounter {
    text-align: center;
    font-size: 20px;
    margin-top: 5px;
    opacity: 0.75;
  }

  /* BUTTON CONTAINER FOR MODES */
  .modeButtons {
    width: 150px;
    margin: 0 auto;
  }

</style>
</head>
<body>

<!-- MAIN MENU -->
<div id="mainMenu">
  <canvas id="particleCanvas"></canvas>
  <h1>Falling Chemistry Atoms</h1>
  <div id="mainMenuButtons">
    <button id="btnBoyle">Boyle's Law</button>
    <button id="btnCharles">Charles's Law</button>
    <button id="btnAvogadro">Avogadro's Law</button>
  </div>
</div>

<!-- BOYLE MODE -->
<div id="boyle" class="mode">
  <canvas id="boyleCanvas" width="300" height="300"></canvas>
  <button id="boyleReturnBtn">Return</button>
</div>

<!-- CHARLES MODE -->
<div id="charles" class="mode">
  <div id="charlesBalloon"></div>
  <div id="charlesControls">
    <label for="charlesTemp">Temperature:</label>
    <input type="range" id="charlesTemp" min="0" max="100" value="50" />
    <span id="charlesTempVal">50</span>Â°
  </div>
  <button id="charlesReturnBtn">Return</button>
</div>

<!-- AVOGADRO MODE -->
<div id="avogadro" class="mode">
  <div id="avogadroContainer">
    <div id="avogadroBalloon"></div>
  </div>
  <div id="avogadroMoleculeCounter">0</div>
  <div class="modeButtons">
    <button id="avogadroReturnBtn">Return</button>
    <button id="avogadroIncreaseBtn">Increase Mass</button>
  </div>
</div>

<script>
  // --- MAIN MENU PARTICLES ---
  const mainMenuCanvas = document.getElementById('particleCanvas');
  const mainMenuCtx = mainMenuCanvas.getContext('2d');
  let mainMenuParticles = [];

  function resizeCanvas() {
    mainMenuCanvas.width = window.innerWidth;
    mainMenuCanvas.height = window.innerHeight;
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  class FallingParticle {
    constructor() {
      this.x = Math.random() * mainMenuCanvas.width;
      this.y = Math.random() * mainMenuCanvas.height;
      this.size = Math.random() * 3 + 1;
      this.speedY = Math.random() * 1 + 0.2;
      this.color = `rgba(255, ${90 + Math.random() * 50}, 95, ${0.4 + Math.random() * 0.2})`;
    }
    update() {
      this.y += this.speedY;
      if (this.y > mainMenuCanvas.height) {
        this.y = 0;
        this.x = Math.random() * mainMenuCanvas.width;
      }
    }
    draw() {
      mainMenuCtx.beginPath();
      mainMenuCtx.fillStyle = this.color;
      mainMenuCtx.shadowColor = this.color;
      mainMenuCtx.shadowBlur = 6;
      mainMenuCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      mainMenuCtx.fill();
    }
  }

  function initMainMenuParticles() {
    mainMenuParticles = [];
    for (let i = 0; i < 160; i++) {
      mainMenuParticles.push(new FallingParticle());
    }
  }
  function animateMainMenuParticles() {
    mainMenuCtx.clearRect(0, 0, mainMenuCanvas.width, mainMenuCanvas.height);
    mainMenuParticles.forEach(p => {
      p.update();
      p.draw();
    });
    requestAnimationFrame(animateMainMenuParticles);
  }
  initMainMenuParticles();
  animateMainMenuParticles();

  // --- MODE SWITCHING ---
  const mainMenu = document.getElementById('mainMenu');
  const modes = {
    boyle: document.getElementById('boyle'),
    charles: document.getElementById('charles'),
    avogadro: document.getElementById('avogadro'),
  };

  function showMode(name) {
    mainMenu.style.display = (name === 'mainMenu' ? 'flex' : 'none');
    for (const mode in modes) {
      modes[mode].style.display = 'none';
    }
    if (name !== 'mainMenu') {
      modes[name].style.display = 'flex';
    }
    if (name === 'boyle') {
      boyleLoop();
    }
    if (name === 'mainMenu') {
      animateMainMenuParticles();
    }
  }

  // --- BUTTONS TO ENTER MODES ---
  document.getElementById('btnBoyle').onclick = () => showMode('boyle');
  document.getElementById('btnCharles').onclick = () => showMode('charles');
  document.getElementById('btnAvogadro').onclick = () => showMode('avogadro');

  // --- RETURN BUTTONS ---
  document.getElementById('boyleReturnBtn').onclick = () => showMode('mainMenu');
  document.getElementById('charlesReturnBtn').onclick = () => showMode('mainMenu');
  document.getElementById('avogadroReturnBtn').onclick = () => showMode('mainMenu');

  // --- BOYLE MODE ---
  const boyleCanvas = document.getElementById('boyleCanvas');
  const boyleCtx = boyleCanvas.getContext('2d');

  class BoyleBall {
    constructor() {
      this.radius = 15;
      this.x = Math.random() * (boyleCanvas.width - 2 * this.radius) + this.radius;
      this.y = Math.random() * (boyleCanvas.height - 2 * this.radius) + this.radius;
      this.vx = (Math.random() * 3 + 2) * (Math.random() > 0.5 ? 1 : -1);
      this.vy = (Math.random() * 3 + 2) * (Math.random() > 0.5 ? 1 : -1);
      this.color = 'rgba(255, 90, 95, 0.7)';
    }
    draw() {
      boyleCtx.beginPath();
      boyleCtx.fillStyle = this.color;
      boyleCtx.shadowColor = 'rgba(255,90,95,0.6)';
      boyleCtx.shadowBlur = 8;
      boyleCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      boyleCtx.fill();
    }
    update() {
      this.x += this.vx;
      this.y += this.vy;
      if (this.x + this.radius > boyleCanvas.width || this.x - this.radius < 0) {
        this.vx *= -1;
      }
      if (this.y + this.radius > boyleCanvas.height || this.y - this.radius < 0) {
        this.vy *= -1;
      }
    }
  }

  const boyleBalls = [];
  const boyleBallCount = 6;

  for (let i = 0; i < boyleBallCount; i++) {
    boyleBalls.push(new BoyleBall());
  }

  let boyleAnimating = false;
  function boyleLoop() {
    if (!modes.boyle.style.display || modes.boyle.style.display === 'none') {
      boyleAnimating = false;
      return;
    }
    boyleAnimating = true;
    boyleCtx.clearRect(0, 0, boyleCanvas.width, boyleCanvas.height);
    // Container border
    boyleCtx.strokeStyle = '#ff5a5f';
    boyleCtx.lineWidth = 3;
    boyleCtx.strokeRect(0, 0, boyleCanvas.width, boyleCanvas.height);

    boyleBalls.forEach(ball => {
      ball.update();
      ball.draw();
    });

    requestAnimationFrame(boyleLoop);
  }

  // --- CHARLES MODE ---
  const charlesTemp = document.getElementById('charlesTemp');
  const charlesTempVal = document.getElementById('charlesTempVal');
  const charlesBalloon = document.getElementById('charlesBalloon');

  function updateCharles() {
    const temp = parseInt(charlesTemp.value, 10);
    charlesTempVal.textContent = temp;
    const scale = 0.5 + temp / 100;
    charlesBalloon.style.width = (100 * scale) + 'px';
    charlesBalloon.style.height = (150 * scale) + 'px';
  }

  charlesTemp.addEventListener('input', updateCharles);
  updateCharles();

  // --- AVOGADRO MODE ---
  const avogadroIncreaseBtn = document.getElementById('avogadroIncreaseBtn');
  const avogadroReturnBtn = document.getElementById('avogadroReturnBtn');
  const avogadroMoleculeCounter = document.getElementById('avogadroMoleculeCounter');
  const avogadroBalloon = document.getElementById('avogadroBalloon');
  const avogadroContainer = document.getElementById('avogadroContainer');

  let avogadroCount = 0;
  let balloonSize = 30; // initial size in px
  const maxBalloonSize = 100;

  // Pop sound URL (royalty free)
  const popSound = new Audio('https://freesound.org/data/previews/256/256113_3263906-lq.mp3');

  function popBalloon() {
    avogadroBalloon.classList.add('pop');
    popSound.play();
    setTimeout(() => {
      avogadroBalloon.classList.remove('pop');
      // Reset balloon size and count
      avogadroCount = 0;
      balloonSize = 30;
      updateAvogadro();
    }, 500);
  }

  function updateAvogadro() {
    avogadroMoleculeCounter.textContent = avogadroCount;
    avogadroBalloon.style.width = balloonSize + 'px';
    avogadroBalloon.style.height = balloonSize * 1.5 + 'px';

    // Keep balloon centered and inside container
    const left = (avogadroContainer.clientWidth - balloonSize) / 2;
    const top = (avogadroContainer.clientHeight - balloonSize * 1.5) / 2;
    avogadroBalloon.style.left = left + 'px';
    avogadroBalloon.style.top = top + 'px';
  }

  function increaseAvogadro() {
    if (balloonSize >= maxBalloonSize) {
      popBalloon();
    } else {
      avogadroCount++;
      balloonSize++;
      updateAvogadro();
    }
  }

  // Click and hold behavior for increase button
  let increaseInterval;
  avogadroIncreaseBtn.addEventListener('mousedown', () => {
    increaseAvogadro();
    increaseInterval = setInterval(increaseAvogadro, 200);
  });
  avogadroIncreaseBtn.addEventListener('mouseup', () => clearInterval(increaseInterval));
  avogadroIncreaseBtn.addEventListener('mouseleave', () => clearInterval(increaseInterval));
  avogadroIncreaseBtn.addEventListener('touchstart', (e) => {
    e.preventDefault();
    increaseAvogadro();
    increaseInterval = setInterval(increaseAvogadro, 200);
  }, {passive:false});
  avogadroIncreaseBtn.addEventListener('touchend', () => clearInterval(increaseInterval));
  avogadroIncreaseBtn.addEventListener('touchcancel', () => clearInterval(increaseInterval));

  // Initialize Avogadro
  updateAvogadro();

</script>
</body>
</html>
