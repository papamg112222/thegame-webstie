<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHONK PULSE | ENGINE v6.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Inter:wght@400;700;900&display=swap');
        
        :root {
            --primary: #ff0055;
            --primary-glow: rgba(255, 0, 85, 0.5);
        }

        body {
            background-color: #000;
            color: #ffffff;
            overflow: hidden;
            margin: 0;
            font-family: 'Inter', sans-serif;
            user-select: none;
        }

        .canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }

        .bg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            background-size: cover;
            background-position: center;
            transition: filter 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .vignette {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, transparent 20%, rgba(0,0,0,0.95) 100%);
            pointer-events: none;
            z-index: 5;
        }

        .glass-panel {
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .phonk-title {
            font-family: 'Syncopate', sans-serif;
            letter-spacing: -0.05em;
        }

        /* Scanline CRT Effect */
        .scanlines {
            position: absolute;
            inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.04), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.04));
            background-size: 100% 4px, 4px 100%;
            z-index: 10;
            pointer-events: none;
            opacity: 0.5;
        }

        .glitch-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 0, 85, 0.02);
            z-index: 6;
            pointer-events: none;
            mix-blend-mode: overlay;
        }

        /* Kinetic Grid Animation */
        .grid-bg {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 80px 80px;
            transform: perspective(1000px) rotateX(60deg);
            z-index: 1;
            pointer-events: none;
            opacity: 0.2;
        }

        input[type="range"] {
            -webkit-appearance: none;
            background: transparent;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-runnable-track {
            background: rgba(255, 255, 255, 0.1);
            height: 6px;
            border-radius: 3px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #fff;
            margin-top: -7px;
            box-shadow: 0 0 15px var(--primary);
            border: 4px solid #000;
        }

        .btn-glow:hover {
            box-shadow: 0 0 30px var(--primary-glow);
            transform: translateY(-2px);
        }

        /* Animations */
        @keyframes pulse-soft {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.7; }
        }
        .pulse-soft { animation: pulse-soft 2s infinite ease-in-out; }

        .ai-loading-gradient {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            background-size: 200% 100%;
            animation: loading-shimmer 1.5s infinite;
        }

        @keyframes loading-shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useRef, useEffect, useCallback } from 'react';
        import ReactDOM from 'react-dom/client';

        const apiKey = ""; // Runtime provided. Note: Features will fail if key is empty outside the preview environment.

        // --- GEMINI API ENGINE ---
        const callGemini = async (prompt, retries = 0) => {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: {
                    parts: [{ text: "You are a professional music visual engine architect. You output precise JSON for Phonk music aesthetics. primaryColor must be a bright hex value. bassSensitivity must be between 1.0 and 2.5." }]
                },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            primaryColor: { type: "STRING" },
                            bassSensitivity: { type: "NUMBER" }
                        },
                        required: ["primaryColor", "bassSensitivity"]
                    }
                }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                }
                
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) throw new Error("AI returned an empty response.");
                return JSON.parse(text);
            } catch (error) {
                if (retries < 5) {
                    // Exponential backoff: 1s, 2s, 4s, 8s, 16s
                    const delays = [1000, 2000, 4000, 8000, 16000];
                    await new Promise(resolve => setTimeout(resolve, delays[retries]));
                    return callGemini(prompt, retries + 1);
                }
                throw error;
            }
        };

        // --- VISUALIZER ENGINE ---
        const VisualizerCanvas = ({ analyser, config, logoUrl, customBgUrl }) => {
            const canvasRef = useRef(null);
            const gridRef = useRef(null);
            const bgRef = useRef(null);
            const requestRef = useRef();
            const particles = useRef([]);
            const smoothedBass = useRef(0);
            const rotationOffset = useRef(0);
            const logoImgRef = useRef(null);
            const [logoLoaded, setLogoLoaded] = useState(false);

            useEffect(() => {
                if (logoUrl) {
                    const img = new Image();
                    img.src = logoUrl;
                    img.onload = () => { logoImgRef.current = img; setLogoLoaded(true); };
                    img.onerror = () => { logoImgRef.current = null; setLogoLoaded(false); };
                } else {
                    logoImgRef.current = null;
                    setLogoLoaded(false);
                }
            }, [logoUrl]);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                const initParticles = () => {
                    particles.current = Array.from({ length: 200 }, () => ({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        size: Math.random() * 2.5 + 0.5,
                        speedX: (Math.random() - 0.5) * 1.2,
                        speedY: (Math.random() - 0.5) * 1.2,
                        color: Math.random() > 0.7 ? config.primaryColor : '#ffffff',
                        opacity: Math.random() * 0.5 + 0.1
                    }));
                };

                const resize = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    initParticles();
                };

                window.addEventListener('resize', resize);
                resize();

                const dataArray = new Uint8Array(analyser?.frequencyBinCount || 1024);

                const animate = () => {
                    // Motion Blur trail
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    if (analyser) {
                        analyser.getByteFrequencyData(dataArray);
                        
                        // Extract Bass
                        let bassSum = 0;
                        const bassLimit = 12;
                        for (let i = 0; i < bassLimit; i++) bassSum += dataArray[i];
                        const rawBass = (bassSum / bassLimit) / 255;
                        
                        // Smooth bass response
                        const attack = rawBass > smoothedBass.current ? 0.3 : 0.1;
                        smoothedBass.current += (rawBass - smoothedBass.current) * attack;

                        const centerX = canvas.width / 2;
                        const centerY = canvas.height / 2;
                        rotationOffset.current += 0.003 + (smoothedBass.current * 0.08);

                        // Background Reactivity
                        if (bgRef.current) {
                            const zoom = 1 + (smoothedBass.current * 0.12);
                            const shake = (smoothedBass.current > 0.9) ? (Math.random() - 0.5) * 30 : 0;
                            bgRef.current.style.transform = `scale(${zoom}) translate(${shake}px, ${shake}px)`;
                            bgRef.current.style.filter = `brightness(${0.3 + smoothedBass.current * 0.6}) blur(${12 - (smoothedBass.current * 8)}px)`;
                        }
                        
                        // Grid Reactivity
                        if (gridRef.current) {
                            const scrollY = (Date.now() / 15) % 80;
                            const reactiveSpeed = smoothedBass.current * 40;
                            gridRef.current.style.backgroundPosition = `0px ${scrollY + reactiveSpeed}px`;
                            gridRef.current.style.opacity = 0.1 + smoothedBass.current * 0.4;
                        }

                        // Particles update
                        particles.current.forEach(p => {
                            const drift = 1 + (smoothedBass.current * 15);
                            p.x += p.speedX * drift;
                            p.y += p.speedY * drift;
                            if (p.x < 0) p.x = canvas.width; if (p.x > canvas.width) p.x = 0;
                            if (p.y < 0) p.y = canvas.height; if (p.y > canvas.height) p.y = 0;
                            
                            ctx.beginPath();
                            ctx.arc(p.x, p.y, p.size * (1 + (smoothedBass.current * 1.5)), 0, Math.PI * 2);
                            ctx.fillStyle = `${p.color}${Math.floor(p.opacity * 255).toString(16).padStart(2, '0')}`;
                            ctx.fill();
                        });

                        const baseRadius = Math.min(canvas.width, canvas.height) * 0.18;
                        const reactiveRadius = baseRadius + (Math.pow(smoothedBass.current, 3) * baseRadius * 1.8 * config.bassSensitivity);

                        // Screen Shake
                        if (config.shakeEnabled && smoothedBass.current > 0.85) {
                            ctx.save();
                            ctx.translate((Math.random() - 0.5) * 40 * smoothedBass.current, (Math.random() - 0.5) * 40 * smoothedBass.current);
                        }

                        // Waveform Ring
                        const points = 200;
                        const wavePoints = [];
                        for (let i = 0; i < points; i++) {
                            const angle = (i / points) * Math.PI * 2 + (rotationOffset.current * 0.2);
                            const freqIndex = Math.floor((i / points) * dataArray.length * 0.5);
                            const val = dataArray[freqIndex] / 255;
                            const r = reactiveRadius + (val * 160 * config.bassSensitivity);
                            wavePoints.push({ x: centerX + Math.cos(angle) * r, y: centerY + Math.sin(angle) * r });
                        }

                        // Render Outer Ring
                        ctx.beginPath();
                        ctx.moveTo(wavePoints[0].x, wavePoints[0].y);
                        for (let i = 0; i < wavePoints.length; i++) {
                            const next = wavePoints[(i + 1) % wavePoints.length];
                            const midX = (wavePoints[i].x + next.x) / 2;
                            const midY = (wavePoints[i].y + next.y) / 2;
                            ctx.quadraticCurveTo(wavePoints[i].x, wavePoints[i].y, midX, midY);
                        }
                        ctx.closePath();
                        ctx.strokeStyle = config.primaryColor;
                        ctx.lineWidth = 12;
                        ctx.shadowBlur = 100 * smoothedBass.current;
                        ctx.shadowColor = config.primaryColor;
                        ctx.stroke();
                        ctx.shadowBlur = 0;

                        // Core Visual
                        ctx.save();
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, reactiveRadius, 0, Math.PI * 2);
                        ctx.clip();

                        if (logoImgRef.current && logoLoaded) {
                            const img = logoImgRef.current;
                            const scale = Math.max(reactiveRadius * 2.2 / img.width, reactiveRadius * 2.2 / img.height);
                            ctx.translate(centerX, centerY);
                            ctx.rotate(rotationOffset.current * -0.2);
                            ctx.drawImage(img, -img.width * scale / 2, -img.height * scale / 2, img.width * scale, img.height * scale);
                        } else {
                            const grad = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, reactiveRadius);
                            grad.addColorStop(0, '#000');
                            grad.addColorStop(0.85, '#111');
                            grad.addColorStop(1, config.primaryColor);
                            ctx.fillStyle = grad;
                            ctx.fill();
                            
                            // Accent Details
                            ctx.beginPath();
                            ctx.arc(centerX, centerY, reactiveRadius * 0.9, 0, Math.PI * 2);
                            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
                            ctx.lineWidth = 2;
                            ctx.stroke();
                        }
                        ctx.restore();

                        if (config.shakeEnabled && smoothedBass.current > 0.85) ctx.restore();
                    } else {
                        // Idle animation
                        const time = Date.now() * 0.002;
                        ctx.beginPath();
                        ctx.arc(canvas.width / 2, canvas.height / 2, (Math.min(canvas.width, canvas.height) * 0.18) + Math.sin(time) * 8, 0, Math.PI * 2);
                        ctx.strokeStyle = 'rgba(255,255,255,0.05)';
                        ctx.setLineDash([10, 20]);
                        ctx.stroke();
                        ctx.setLineDash([]);
                    }
                    requestRef.current = requestAnimationFrame(animate);
                };

                requestRef.current = requestAnimationFrame(animate);
                return () => { cancelAnimationFrame(requestRef.current); window.removeEventListener('resize', resize); };
            }, [analyser, config, logoLoaded]);

            return React.createElement('div', { className: 'contents' },
                React.createElement('div', { 
                    ref: bgRef, 
                    className: 'bg-layer', 
                    style: { 
                        backgroundImage: customBgUrl ? `url(${customBgUrl})` : 'none', 
                        backgroundColor: customBgUrl ? 'transparent' : '#020202' 
                    } 
                }),
                React.createElement('div', { ref: gridRef, className: 'grid-bg' }),
                React.createElement('div', { className: 'scanlines' }),
                React.createElement('div', { className: 'glitch-overlay' }),
                React.createElement('div', { className: 'vignette' }),
                React.createElement('canvas', { ref: canvasRef, className: 'canvas-container' })
            );
        };

        // --- APP CORE ---
        const App = () => {
            const [audioFile, setAudioFile] = useState(null);
            const [logoUrl, setLogoUrl] = useState(null);
            const [bgUrl, setBgUrl] = useState(null);
            const [config, setConfig] = useState({ primaryColor: '#ff0055', shakeEnabled: true, bassSensitivity: 1.5 });
            const [isPlaying, setIsPlaying] = useState(false);
            const [currentTime, setCurrentTime] = useState(0);
            const [duration, setDuration] = useState(0);
            const [vibe, setVibe] = useState('');
            const [loading, setLoading] = useState(false);
            const [showUI, setShowUI] = useState(true);
            const [errorMsg, setErrorMsg] = useState('');

            const audioRef = useRef(null);
            const audioCtxRef = useRef(null);
            const analyserRef = useRef(null);

            const handleFile = (e) => {
                const file = e.target.files?.[0];
                if (file) { 
                    setAudioFile(file); 
                    const url = URL.createObjectURL(file);
                    audioRef.current.src = url; 
                    setIsPlaying(false); 
                }
            };

            const handleUpload = (type, e) => {
                const file = e.target.files?.[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (ev) => { 
                        if (type === 'logo') setLogoUrl(ev.target.result); 
                        else setBgUrl(ev.target.result); 
                    };
                    reader.readAsDataURL(file);
                }
            };

            const togglePlay = async () => {
                if (!audioFile) return;
                try {
                    if (!audioCtxRef.current) {
                        audioCtxRef.current = new (window.AudioContext || window.webkitAudioContext)();
                        analyserRef.current = audioCtxRef.current.createAnalyser();
                        analyserRef.current.fftSize = 2048;
                        const source = audioCtxRef.current.createMediaElementSource(audioRef.current);
                        source.connect(analyserRef.current);
                        analyserRef.current.connect(audioCtxRef.current.destination);
                    }
                    if (audioCtxRef.current.state === 'suspended') await audioCtxRef.current.resume();
                    
                    if (isPlaying) {
                        audioRef.current.pause();
                    } else {
                        audioRef.current.play();
                    }
                    setIsPlaying(!isPlaying);
                } catch (e) {
                    console.error("Audio Playback Error:", e);
                }
            };

            const handleEnhance = async () => {
                if (!vibe.trim()) return;
                setLoading(true);
                setErrorMsg('');
                try {
                    const theme = await callGemini(`Visual Theme Prompt: "${vibe}"`);
                    setConfig(prev => ({ ...prev, ...theme }));
                    document.documentElement.style.setProperty('--primary', theme.primaryColor);
                    document.documentElement.style.setProperty('--primary-glow', theme.primaryColor + '80');
                } catch (e) {
                    // Provide a descriptive error message to the user
                    const apiError = e.message?.toLowerCase().includes('api key') 
                        ? "API key missing or invalid. Set a Gemini API key in the script to use AI features on GitHub."
                        : `Vibe sync failed: ${e.message}`;
                    setErrorMsg(apiError);
                    setTimeout(() => setErrorMsg(''), 6000);
                }
                setLoading(false);
            };

            useEffect(() => {
                const handleKey = (e) => { 
                    if (e.key.toLowerCase() === 'w') setShowUI(p => !p); 
                };
                window.addEventListener('keydown', handleKey);
                return () => window.removeEventListener('keydown', handleKey);
            }, []);

            return React.createElement('div', { className: 'relative w-screen h-screen' },
                React.createElement('audio', { 
                    ref: audioRef, className: 'hidden',
                    onTimeUpdate: (e) => setCurrentTime(e.target.currentTime),
                    onLoadedMetadata: (e) => setDuration(e.target.duration),
                    onEnded: () => setIsPlaying(false)
                }),

                React.createElement(VisualizerCanvas, { analyser: analyserRef.current, config, logoUrl, customBgUrl: bgUrl }),

                React.createElement('div', { className: `absolute inset-0 z-20 p-8 flex flex-col justify-between transition-all duration-1000 ${showUI ? 'opacity-100' : 'opacity-0 pointer-events-none scale-105'}` },
                    React.createElement('header', { className: 'flex justify-between items-start' },
                        React.createElement('div', null,
                            React.createElement('h1', { className: 'phonk-title text-8xl font-black italic uppercase text-white drop-shadow-[0_10px_10px_rgba(0,0,0,0.5)]' }, 'PHONK', React.createElement('span', { style: { color: config.primaryColor } }, 'PULSE')),
                            React.createElement('div', { className: 'flex items-center gap-4 mt-2' },
                                React.createElement('p', { className: 'text-[11px] font-mono tracking-[0.7em] uppercase opacity-40' }, 'Ultra Engine Standalone v6.5'),
                                React.createElement('div', { className: 'h-[1px] w-24 bg-white/20' })
                            )
                        ),
                        React.createElement('div', { className: 'glass-panel p-6 rounded-[2.5rem] flex flex-col gap-6' },
                            React.createElement('div', { className: 'flex flex-col gap-3' },
                                React.createElement('span', { className: 'text-[9px] font-bold opacity-30 uppercase tracking-[0.2em] text-center' }, 'Custom Assets'),
                                React.createElement('div', { className: 'flex gap-3' },
                                    React.createElement('label', { className: 'w-14 h-14 flex items-center justify-center bg-white/5 border border-white/10 rounded-2xl hover:bg-white/10 cursor-pointer transition-all active:scale-90' },
                                        React.createElement('i', { className: 'fa-solid fa-circle-user text-xl opacity-60' }),
                                        React.createElement('input', { type: 'file', accept: 'image/*', onChange: (e) => handleUpload('logo', e), className: 'hidden' })
                                    ),
                                    React.createElement('label', { className: 'w-14 h-14 flex items-center justify-center bg-white/5 border border-white/10 rounded-2xl hover:bg-white/10 cursor-pointer transition-all active:scale-90' },
                                        React.createElement('i', { className: 'fa-solid fa-panorama text-xl opacity-60' }),
                                        React.createElement('input', { type: 'file', accept: 'image/*', onChange: (e) => handleUpload('bg', e), className: 'hidden' })
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'flex flex-col gap-3' },
                                React.createElement('span', { className: 'text-[9px] font-bold opacity-30 uppercase tracking-[0.2em] text-center' }, 'Manual Palette'),
                                React.createElement('div', { className: 'grid grid-cols-4 gap-2' },
                                    ['#ff0055', '#00f2ff', '#bd00ff', '#ffffff'].map(c => React.createElement('button', {
                                        key: c, onClick: () => { setConfig(p => ({...p, primaryColor: c})); document.documentElement.style.setProperty('--primary', c); },
                                        className: 'w-6 h-6 rounded-md transition-all hover:scale-125 hover:rotate-12',
                                        style: { backgroundColor: c, border: config.primaryColor === c ? '2px solid white' : 'none' }
                                    }))
                                )
                            )
                        )
                    ),

                    !audioFile && React.createElement('div', { className: 'flex-1 flex flex-col items-center justify-center' },
                        React.createElement('label', { className: 'group cursor-pointer' },
                            React.createElement('div', { className: 'relative px-20 py-8 rounded-[2rem] transition-all group-hover:scale-105 active:scale-95 shadow-2xl overflow-hidden glass-panel border-white/20' },
                                React.createElement('div', { className: 'relative flex items-center gap-6 text-white' },
                                    React.createElement('i', { className: 'fa-solid fa-music text-3xl pulse-soft' }),
                                    React.createElement('div', null,
                                        React.createElement('span', { className: 'block text-2xl font-black uppercase tracking-[0.3em]' }, 'Initialize Track'),
                                        React.createElement('span', { className: 'text-[10px] uppercase opacity-40 font-bold' }, 'WAV / MP3 / FLAC Supported')
                                    )
                                )
                            ),
                            React.createElement('input', { type: 'file', accept: 'audio/*', onChange: handleFile, className: 'hidden' })
                        )
                    ),

                    audioFile && React.createElement('footer', { className: 'max-w-6xl mx-auto w-full glass-panel p-10 rounded-[4rem] flex flex-col gap-8 mb-4' },
                        React.createElement('div', { className: 'flex flex-col md:flex-row items-center gap-10' },
                            React.createElement('div', { className: 'flex-1 w-full' },
                                React.createElement('div', { className: 'flex items-center gap-4 mb-4' },
                                    React.createElement('div', { className: 'w-2 h-2 rounded-full animate-ping', style: { backgroundColor: config.primaryColor } }),
                                    React.createElement('h2', { className: 'text-3xl font-black truncate text-white tracking-tight' }, audioFile.name)
                                ),
                                React.createElement('div', { className: 'flex items-center gap-6' },
                                    React.createElement('span', { className: 'text-sm font-mono opacity-60 tabular-nums bg-white/5 px-4 py-2 rounded-lg border border-white/10' }, 
                                        `${Math.floor(currentTime/60)}:${Math.floor(currentTime%60).toString().padStart(2,'0')} / ${Math.floor(duration/60)}:${Math.floor(duration%60).toString().padStart(2,'0')}`
                                    ),
                                    React.createElement('div', { className: 'flex-1 flex items-center gap-3 bg-white/5 px-6 py-3 rounded-2xl border border-white/10 group focus-within:border-white/30 transition-all' },
                                        React.createElement('i', { className: `fa-solid fa-wand-magic-sparkles text-xs transition-colors ${loading ? 'text-white' : 'opacity-40'}` }),
                                        React.createElement('input', { 
                                            value: vibe, onChange: (e) => setVibe(e.target.value), 
                                            onKeyDown: (e) => e.key === 'Enter' && handleEnhance(),
                                            placeholder: 'DEFINE VIBE (e.g. DRIFT, CYBER, MIDNIGHT)...', 
                                            className: 'bg-transparent text-[10px] flex-1 focus:outline-none uppercase font-bold placeholder:opacity-20' 
                                        }),
                                        React.createElement('button', { 
                                            onClick: handleEnhance, 
                                            disabled: loading,
                                            className: 'text-[10px] font-black uppercase text-white hover:opacity-100 opacity-60 transition-opacity' 
                                        }, loading ? 'SYNCING...' : 'AI ADAPT')
                                    )
                                ),
                                errorMsg && React.createElement('p', { className: 'text-[10px] text-red-500 font-bold mt-2 uppercase max-w-md' }, errorMsg)
                            ),

                            React.createElement('div', { className: 'flex items-center gap-10' },
                                React.createElement('button', { onClick: togglePlay, className: 'w-24 h-24 rounded-full bg-white text-black flex items-center justify-center hover:scale-110 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.2)] btn-glow' },
                                    React.createElement('i', { className: `fa-solid ${isPlaying ? 'fa-pause' : 'fa-play'} text-4xl` })
                                ),
                                React.createElement('div', { className: 'flex gap-10 border-l border-white/10 pl-10' },
                                    React.createElement('div', { className: 'flex flex-col gap-3 min-w-[140px]' },
                                        React.createElement('div', { className: 'flex justify-between text-[10px] font-black opacity-30 uppercase' }, 
                                            React.createElement('span', null, 'Bass Gain'),
                                            React.createElement('span', { className: 'text-white opacity-100' }, `x${config.bassSensitivity.toFixed(1)}`)
                                        ),
                                        React.createElement('input', { 
                                            type: 'range', min: '0.8', max: '2.5', step: '0.1', 
                                            value: config.bassSensitivity, onChange: (e) => setConfig(c => ({...c, bassSensitivity: parseFloat(e.target.value)}))
                                        })
                                    ),
                                    React.createElement('button', { 
                                        onClick: () => setConfig(c => ({...c, shakeEnabled: !c.shakeEnabled})),
                                        title: 'Toggle Screen Shake',
                                        className: `w-14 h-14 rounded-2xl flex items-center justify-center border transition-all active:scale-90 ${config.shakeEnabled ? 'border-white bg-white/10' : 'border-white/5 opacity-20'}`
                                    }, React.createElement('i', { className: 'fa-solid fa-burst text-xl' }))
                                )
                            )
                        ),

                        React.createElement('div', { className: 'relative h-4 flex items-center group cursor-pointer' },
                            React.createElement('input', { 
                                type: 'range', min: '0', max: duration || 1, step: '0.01', value: currentTime, 
                                onChange: (e) => { audioRef.current.currentTime = e.target.value; setCurrentTime(e.target.value); },
                                className: 'absolute inset-0 w-full opacity-0 z-30 cursor-pointer' 
                            }),
                            React.createElement('div', { className: 'w-full h-1 bg-white/10 rounded-full relative z-10 overflow-hidden' },
                                React.createElement('div', { 
                                    className: 'h-full transition-all duration-75', 
                                    style: { 
                                        width: `${(currentTime/(duration||1))*100}%`, 
                                        backgroundColor: config.primaryColor, 
                                        boxShadow: `0 0 20px ${config.primaryColor}` 
                                    } 
                                })
                            ),
                            React.createElement('div', { 
                                className: 'absolute h-3 w-1 bg-white z-20 transition-all pointer-events-none rounded-full',
                                style: { left: `${(currentTime/(duration||1))*100}%`, transform: 'translateX(-50%)' }
                            })
                        )
                    ),

                    React.createElement('div', { className: 'flex justify-between items-center' },
                        React.createElement('div', { className: 'flex gap-8' },
                            ['DRIVE', 'SYNC', 'PULSE', 'VOID'].map(tag => React.createElement('span', { key: tag, className: 'text-[9px] font-black tracking-widest opacity-20' }, tag))
                        ),
                        React.createElement('span', { className: 'text-[9px] font-black opacity-40' }, 'PRESS [W] TO TOGGLE UI')
                    )
                )
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
