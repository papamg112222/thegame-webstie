<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gas Laws Main Menu</title>
  <style>
    /* ... [NO CHANGE: existing styles remain unchanged unless mentioned] ... */

    /* Return button now hidden by default and only shown in modes */
    .return-button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: white;
      color: black;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 20px auto 0 auto;
      display: none; /* Hidden by default */
      width: fit-content;
      animation: rainbowGlow 4s linear infinite;
      box-shadow: 0 0 10px 2px #fff;
      transition: box-shadow 0.3s ease;
    }

    /* ... [all your previous styles are unchanged] ... */
  </style>
</head>
<body>

  <!-- MAIN MENU -->
  <div class="menu-container" id="mainMenu">
    <div class="menu-title">
      <span>Chem</span><span>istry</span>
    </div>
    <button class="menu-button" onclick="showMode('Boyle\'s Law Mode')">Boyle's Law Mode</button>
    <button class="menu-button" onclick="showMode('Charles\'s Law Mode')">Charles's Law Mode</button>
    <button class="menu-button" onclick="showMode('Gay-Lussac\'s Law Mode')">Gay-Lussac's Law Mode</button>
    <button class="menu-button" onclick="showMode('Avogadro\'s Law Mode')">Avogadro's Law Mode</button>
  </div>

  <!-- MODE SCREEN -->
  <div class="mode-screen" id="modeScreen">
    <h1 id="modeTitle">Mode</h1>

    <!-- Boyle's Law -->
    <div id="boyleContainer" style="display:none;">
      <div class="slider-container">
        <label for="massSlider">Mass</label>
        <input type="range" id="massSlider" min="1" max="100" value="30" />
      </div>
      <div class="slider-container">
        <label for="tempSlider">Temperature</label>
        <input type="range" id="tempSlider" min="1" max="100" value="30" />
      </div>
      <div class="simulation-container" id="simBox"></div>
    </div>

    <!-- Charles's Law -->
    <div id="charlesContainer">
      <div id="charlesBackground"></div>
      <div id="charlesMoleculeCounter" style="
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 0;
        color: white;
        font-size: 20px;
        font-weight: bold;
        opacity: 0.6;
      ">Molecules: 100</div>
      <div id="balloon"></div>
      <div id="charlesSliderContainer">
        <label for="charlesSlider">Temperature</label>
        <input type="range" id="charlesSlider" min="1" max="100" value="50" />
      </div>
    </div>

    <!-- Avogadro's Law -->
    <div id="avogadroContainer">
      <h2>Avogadro's Law Mode</h2>
      <div id="avogadroMoleculeCounter" style="
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 0;
        color: white;
        font-size: 20px;
        font-weight: bold;
        opacity: 0.6;
      ">Molecules: 10</div>
      <div id="avogadroBalloon"></div>
      <div id="avogadroControls">
        <label>Number of Moles</label>
        <button id="avogadroButton">Increase Moles by 2</button>
        <button id="popButton">Get a New Balloon</button>
      </div>
    </div>

    <!-- Return Button -->
    <button class="return-button" id="returnButton" onclick="returnToMenu()">Return</button>
  </div>

<script>
  // Common
  const mainMenu = document.getElementById('mainMenu');
  const modeScreen = document.getElementById('modeScreen');
  const modeTitle = document.getElementById('modeTitle');
  const returnButton = document.getElementById('returnButton');

  // Boyle's Law
  const boyleContainer = document.getElementById('boyleContainer');
  const simBox = document.getElementById('simBox');
  const massSlider = document.getElementById('massSlider');
  const tempSlider = document.getElementById('tempSlider');
  let dots = [];
  let velocities = [];
  let boyleActive = false;

  // Charles's Law
  const charlesContainer = document.getElementById('charlesContainer');
  const charlesBackground = document.getElementById('charlesBackground');
  const balloon = document.getElementById('balloon');
  const charlesSlider = document.getElementById('charlesSlider');
  const charlesCounter = document.getElementById('charlesMoleculeCounter');

  // Avogadro's Law
  const avogadroContainer = document.getElementById('avogadroContainer');
  const avogadroBalloon = document.getElementById('avogadroBalloon');
  const avogadroButton = document.getElementById('avogadroButton');
  const popButton = document.getElementById('popButton');
  const avogadroCounter = document.getElementById('avogadroMoleculeCounter');
  let moles = 10;

  let ledHue = 0;
  let ledInterval;

  function startLedEffect() {
    ledInterval = setInterval(() => {
      ledHue = (ledHue + 1) % 360;
      charlesBackground.style.backgroundColor = `hsl(${ledHue}, 100%, 50%)`;
    }, 30);
  }

  function stopLedEffect() {
    clearInterval(ledInterval);
    charlesBackground.style.backgroundColor = 'transparent';
  }

  // Boyle's Law
  function createDots(count) {
    clearDots();
    for (let i = 0; i < count; i++) {
      const dot = document.createElement('div');
      dot.className = 'dot';
      dot.style.left = Math.random() * (simBox.clientWidth - 10) + 'px';
      dot.style.top = Math.random() * (simBox.clientHeight - 10) + 'px';
      simBox.appendChild(dot);
      dots.push(dot);
      velocities.push({
        x: (Math.random() - 0.5) * 3,
        y: (Math.random() - 0.5) * 3
      });
    }
  }

  function clearDots() {
    dots.forEach(dot => simBox.removeChild(dot));
    dots = [];
    velocities = [];
  }

  function updateDots() {
    const tempFactor = parseInt(tempSlider.value) / 50;
    for (let i = 0; i < dots.length; i++) {
      let dot = dots[i];
      let v = velocities[i];
      let left = parseFloat(dot.style.left);
      let top = parseFloat(dot.style.top);

      left += v.x * tempFactor;
      top += v.y * tempFactor;

      if (left < 0 || left > simBox.clientWidth - 10) v.x = -v.x;
      if (top < 0 || top > simBox.clientHeight - 10) v.y = -v.y;

      dot.style.left = Math.min(Math.max(left, 0), simBox.clientWidth - 10) + 'px';
      dot.style.top = Math.min(Math.max(top, 0), simBox.clientHeight - 10) + 'px';
    }
  }

  function animateBoyle() {
    if (!boyleActive) return;
    updateDots();
    requestAnimationFrame(animateBoyle);
  }

  massSlider.addEventListener('input', () => {
    createDots(parseInt(massSlider.value));
  });

  // Charles's slider
  charlesSlider.addEventListener('input', () => {
    let temp = parseInt(charlesSlider.value);
    let size = 80 + (temp - 50) * 1.5;
    size = Math.max(50, size);
    balloon.style.width = size + 'px';
    balloon.style.height = (size * 1.375) + 'px';
    charlesBackground.style.backgroundColor = `hsl(200, 100%, ${40 + temp}%)`;
    charlesCounter.textContent = `Molecules: ${temp * 2}`;
  });

  // Avogadro's
  avogadroButton.addEventListener('click', () => {
    moles += 2;
    if (moles >= 100) {
      moles = 100;
      avogadroButton.style.display = 'none';
      popButton.style.display = 'inline-block';
      popBalloonAnimation();
    }
    updateAvogadroBalloon();
  });

  popButton.addEventListener('click', () => {
    moles = 10;
    updateAvogadroBalloon();
    popButton.style.display = 'none';
    avogadroButton.style.display = 'inline-block';
    avogadroBalloon.style.width = '80px';
    avogadroBalloon.style.height = '110px';
  });

  function updateAvogadroBalloon() {
    let scale = 1 + moles / 100;
    avogadroBalloon.style.width = (80 * scale) + 'px';
    avogadroBalloon.style.height = (110 * scale) + 'px';
    avogadroCounter.textContent = `Molecules: ${moles * 5}`;
  }

  function popBalloonAnimation() {
    avogadroBalloon.style.transition = 'transform 0.5s ease, opacity 0.5s ease';
    avogadroBalloon.style.transform = 'scale(1.8)';
    avogadroBalloon.style.opacity = '0';
    playPopSound();
    setTimeout(() => {
      avogadroBalloon.style.transform = 'scale(1)';
      avogadroBalloon.style.opacity = '1';
      avogadroBalloon.style.transition = 'none';
    }, 600);
  }

  function playPopSound() {
    try {
      const ctx = new AudioContext();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = 'triangle';
      osc.frequency.setValueAtTime(1000, ctx.currentTime);
      gain.gain.setValueAtTime(0.2, ctx.currentTime);
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.start();
      osc.frequency.exponentialRampToValueAtTime(50, ctx.currentTime + 0.15);
      gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
      osc.stop(ctx.currentTime + 0.2);
    } catch (e) {
      console.warn('Pop sound not played:', e);
    }
  }

  function showMode(modeName) {
    mainMenu.style.display = 'none';
    modeScreen.style.display = 'flex';
    returnButton.style.display = 'block';
    modeTitle.textContent = modeName;
    boyleContainer.style.display = 'none';
    charlesContainer.style.display = 'none';
    avogadroContainer.style.display = 'none';
    boyleActive = false;

    switch (modeName) {
      case "Boyle's Law Mode":
        boyleContainer.style.display = 'block';
        createDots(parseInt(massSlider.value));
        boyleActive = true;
        animateBoyle();
        break;
      case "Charles's Law Mode":
        charlesContainer.style.display = 'block';
        startLedEffect();
        charlesSlider.dispatchEvent(new Event('input'));
        break;
      case "Avogadro's Law Mode":
        avogadroContainer.style.display = 'block';
        moles = 10;
        updateAvogadroBalloon();
        avogadroButton.style.display = 'inline-block';
        popButton.style.display = 'none';
        break;
      case "Gay-Lussac's Law Mode":
        alert("Gay-Lussac's Law Mode is not implemented yet.");
        returnToMenu();
        break;
    }
  }

  function returnToMenu() {
    modeScreen.style.display = 'none';
    mainMenu.style.display = 'flex';
    returnButton.style.display = 'none';
    stopLedEffect();
    boyleActive = false;
    clearDots();
  }
</script>

</body>
</html>
