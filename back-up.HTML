<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gas Laws Game</title>
  <style>
    body, html { margin:0; padding:0; height:100%; font-family:Arial,sans-serif;
      background: linear-gradient(to bottom right, rgba(74,101,114,0.9), rgba(144,164,174,0.9));
      display:flex; justify-content:center; align-items:center; overflow:hidden;
    }
    .menu-container, .mode-screen {
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      height:100vh; width:100vw; box-sizing:border-box;
    }
    .menu-container {
      background:rgba(255,255,255,0.85); border-radius:12px; padding:40px;
      box-shadow:0 8px 20px rgba(0,0,0,0.3); gap:1cm; text-align:center;
    }
    .menu-title { font-size:48px; font-weight:bold; margin-bottom:30px; }
    .menu-title span:first-child { color:#0097a7; }
    .menu-title span:last-child { color:#fdd835; }
    .menu-button {
      padding:15px 30px; font-size:18px; background-color:#0097a7; color:white;
      border:none; border-radius:8px; cursor:pointer;
      transition:background-color 0.3s, transform 0.2s ease;
    }
    .menu-button:hover { background-color:#006064; transform:scale(1.1); }
    .mode-screen { display:none; background:rgba(50,50,50,0.9); color:white;
      text-align:center; padding:20px; position:relative;
    }
    .return-button {
      padding:10px 20px; font-size:16px; background:white; color:black;
      border:none; border-radius:5px; cursor:pointer;
      margin:20px auto 0 auto; display:none; width:fit-content;
      animation:rainbowGlow 4s linear infinite;
      box-shadow:0 0 10px 2px #fff; transition:box-shadow 0.3s ease;
    }
    .return-button:hover { box-shadow:0 0 20px 6px #fff; }
    @keyframes rainbowGlow {
      0%{box-shadow:0 0 10px 2px red;color:red;}14%{...}28%{...}84%{...}100%{...}
    }
    .simulation-container { position:relative; width:600px; max-width:90vw;
      height:400px; max-height:60vh; background:#222; border:3px solid #fff;
      border-radius:10px; overflow:hidden; margin:20px auto;
    }
    .dot { position:absolute; width:10px; height:10px; border-radius:50%;
      background-color:#00b0ff;
    }
    .slider-container { color:white; margin:20px auto; text-align:left;
      max-width:320px; width:90vw;
    }
    #charlesContainer, #avogadroContainer {
      display:none; width:90vw; max-width:600px; height:60vh; max-height:500px;
      position:relative; border-radius:15px; overflow:hidden;
      box-shadow:0 0 40px 10px rgba(0,0,0,0.6);
    }
    #charlesBackground { position:absolute; top:0; left:0; right:0; bottom:0;
      transition:background-color 1s linear; z-index:1;
    }
    #balloon, #avogadroBalloon {
      position:absolute; top:50%; left:50%; width:80px; height:110px;
      background:radial-gradient(circle at center, #ff4d4d 0%, #cc0000 80%);
      border-radius:50%/60%; transform:translate(-50%,-50%);
      box-shadow:0 5px 15px rgba(0,0,0,0.3); z-index:2;
      transition:width 0.3s ease, height 0.3s ease, transform 0.5s ease, opacity 0.5s ease;
    }
    #avogadroControls, #charlesSliderContainer {
      position:relative; z-index:3; margin:20px auto; max-width:320px;
      color:white; text-align:center;
    }
  </style>
</head>
<body>

  <div class="menu-container" id="mainMenu">
    <div class="menu-title"><span>Chem</span><span>istry</span></div>
    <button class="menu-button" onclick="showMode('Boyle')">Boyle's Law Mode</button>
    <button class="menu-button" onclick="showMode('Charles')">Charles's Law Mode</button>
    <button class="menu-button" onclick="showMode('Gay')">Gay-Lussac's Law Mode</button>
    <button class="menu-button" onclick="showMode('Avogadro')">Avogadro's Law Mode</button>
  </div>

  <div class="mode-screen" id="modeScreen">
    <h1 id="modeTitle">Mode</h1>

    <div id="boyleContainer">
      <div class="slider-container"><label for="massSlider">Mass</label><input type="range" id="massSlider" min="1" max="100" value="30" /></div>
      <div class="slider-container"><label for="tempSlider">Temperature</label><input type="range" id="tempSlider" min="1" max="100" value="30" /></div>
      <div class="simulation-container" id="simBox"></div>
    </div>

    <div id="charlesContainer">
      <div id="charlesBackground"></div>
      <div id="charlesMoleculeCounter" style="position:absolute;top:10px;left:10px;color:white;opacity:0.6;">Molecules: 100</div>
      <div id="balloon"></div>
      <div id="charlesSliderContainer"><label for="charlesSlider">Temperature</label><input type="range" id="charlesSlider" min="1" max="100" value="50"/></div>
    </div>

    <div id="avogadroContainer">
      <h2>Avogadro's Law Mode</h2>
      <div id="avogadroMoleculeCounter" style="position:absolute;top:10px;left:10px;color:white;opacity:0.6;">Molecules: 10</div>
      <div id="avogadroBalloon"></div>
      <div id="avogadroControls">
        <label>Number of Moles</label>
        <button id="avogadroButton">Increase Moles by 2</button>
        <button id="popButton">Get a New Balloon</button>
      </div>
    </div>

    <button class="return-button" id="returnButton" onclick="returnToMenu()">Return</button>
  </div>

  <script>
    const mainMenu = document.getElementById('mainMenu'),
          modeScreen = document.getElementById('modeScreen'),
          modeTitle = document.getElementById('modeTitle'),
          returnButton = document.getElementById('returnButton'),
          simBox = document.getElementById('simBox'),
          massSlider = document.getElementById('massSlider'),
          tempSlider = document.getElementById('tempSlider'),
          charlesSlider = document.getElementById('charlesSlider'),
          charlesCounter = document.getElementById('charlesMoleculeCounter'),
          avogadroBalloon = document.getElementById('avogadroBalloon'),
          avogadroCounter = document.getElementById('avogadroMoleculeCounter'),
          avogadroButton = document.getElementById('avogadroButton'),
          popButton = document.getElementById('popButton'),
          charlesContainer = document.getElementById('charlesContainer'),
          boyleContainer = document.getElementById('boyleContainer'),
          avogadroContainer = document.getElementById('avogadroContainer'),
          charlesBackground = document.getElementById('charlesBackground');
    let dots = [], velocities = [], boyleActive = false;
    let moles = 10, ledHue = 0, ledInterval;

    returnButton.style.display = 'none';

    function createDots(count) {
      dots.forEach(d=>simBox.removeChild(d));
      dots = []; velocities = [];
      for(let i=0;i<count;i++){
        let dot=document.createElement('div');
        dot.className='dot';
        dot.style.left= Math.random()*(simBox.clientWidth-10)+'px';
        dot.style.top= Math.random()*(simBox.clientHeight-10)+'px';
        simBox.appendChild(dot);
        dots.push(dot);
        velocities.push({x:(Math.random()-0.5)*3,y:(Math.random()-0.5)*3});
      }
    }

    function updateDots(){
      const tf = parseInt(tempSlider.value)/50;
      dots.forEach((dot,i)=>{
        let v=velocities[i],
            l=parseFloat(dot.style.left)+v.x*tf,
            t=parseFloat(dot.style.top)+v.y*tf;
        if(l<0||l>simBox.clientWidth-10) v.x=-v.x;
        if(t<0||t>simBox.clientHeight-10) v.y=-v.y;
        dot.style.left = Math.min(Math.max(l,0),simBox.clientWidth-10)+'px';
        dot.style.top = Math.min(Math.max(t,0),simBox.clientHeight-10)+'px';
      });
    }

    function animateBoyle(){
      if(!boyleActive) return;
      updateDots();
      requestAnimationFrame(animateBoyle);
    }

    massSlider.addEventListener('input', ()=>createDots(parseInt(massSlider.value)));

    function startLedEffect(){ ledInterval=setInterval(()=>{
      ledHue=(ledHue+1)%360;
      charlesBackground.style.backgroundColor=`hsl(${ledHue},100%,50%)`;
    },30); }

    function stopLedEffect(){ clearInterval(ledInterval); charlesBackground.style.backgroundColor='transparent'; }

    charlesSlider.addEventListener('input', ()=> {
      let t = parseInt(charlesSlider.value);
      let sz = Math.max(50,80+(t-50)*1.5);
      document.getElementById('balloon').style.width = sz+'px';
      document.getElementById('balloon').style.height = (sz*1.375)+'px';
      charlesBackground.style.backgroundColor = `hsl(200,100%,${40+t}%)`;
      charlesCounter.textContent = `Molecules: ${t*2}`;
    });

    avogadroButton.addEventListener('click', ()=> {
      moles+=2;
      if(moles>=100){ moles=100; avogadroButton.style.display='none'; popButton.style.display='inline-block'; playPopSound(); }
      updateAvogadroBalloon();
    });

    popButton.addEventListener('click', ()=> {
      moles=10;
      updateAvogadroBalloon();
      popButton.style.display='none'; avogadroButton.style.display='inline-block';
    });

    function updateAvogadroBalloon(){
      let sc=1+moles/100;
      avogadroBalloon.style.width=80*sc+'px';
      avogadroBalloon.style.height=110*sc+'px';
      avogadroCounter.textContent=`Molecules: ${moles}`;
    }

    function playPopSound(){
      try{
        const ctx=new AudioContext(), osc=ctx.createOscillator(), gain=ctx.createGain();
        osc.type='triangle'; osc.frequency.setValueAtTime(1000,ctx.currentTime);
        gain.gain.setValueAtTime(0.2,ctx.currentTime);
        osc.connect(gain); gain.connect(ctx.destination);
        osc.start();
        osc.frequency.exponentialRampToValueAtTime(50,ctx.currentTime+0.15);
        gain.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.15);
        osc.stop(ctx.currentTime+0.2);
      }catch(e){ console.warn('Pop audio blocked',e); }
    }

    function showMode(mode){
      mainMenu.style.display='none'; modeScreen.style.display='flex';
      returnButton.style.display='block'; modeTitle.textContent=mode+"'s Law Mode";
      boyleContainer.style.display='none'; charlesContainer.style.display='none';
      avogadroContainer.style.display='none'; boyleActive=false; stopLedEffect();

      if(mode==='Boyle'){
        boyleContainer.style.display='block'; createDots(parseInt(massSlider.value));
        boyleActive=true; animateBoyle();
      }
      else if(mode==='Charles'){
        charlesContainer.style.display='block'; startLedEffect();
        charlesSlider.dispatchEvent(new Event('input'));
      }
      else if(mode==='Avogadro'){
        avogadroContainer.style.display='block'; moles=10;
        avogadroButton.style.display='inline-block'; popButton.style.display='none';
        updateAvogadroBalloon();
      }
      else if(mode==='Gay'){
        alert("Gay-Lussac's Law Mode is not implemented yet.");
        returnToMenu();
      }
    }

    function returnToMenu(){
      modeScreen.style.display='none'; mainMenu.style.display='flex';
      returnButton.style.display='none'; boyleActive=false; clearInterval(ledInterval);
      dots.forEach(d=>simBox.removeChild(d)); dots=[];
    }

  </script>
</body>
</html>
