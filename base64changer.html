<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image to Base64 Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Custom range slider styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
        }
        input[type=range]:focus {
            outline: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-6">

    <!-- Main Container -->
    <div class="bg-white p-8 rounded-2xl shadow-xl max-w-2xl w-full text-center space-y-6">
        
        <h1 class="text-3xl font-extrabold text-gray-800">Smart Screenshot Converter</h1>
        <p class="text-gray-500">Upload an image and adjust settings to get the shortest possible Base64 code.</p>

        <!-- Step 1: Upload Input -->
        <div class="border-2 border-dashed border-blue-300 rounded-lg p-6 hover:bg-blue-50 transition bg-gray-50">
            <input type="file" id="fileInput" accept="image/*" class="block w-full text-sm text-gray-500
              file:mr-4 file:py-2 file:px-4
              file:rounded-full file:border-0
              file:text-sm file:font-semibold
              file:bg-blue-600 file:text-white
              file:cursor-pointer hover:file:bg-blue-700
            " />
        </div>

        <!-- Hidden until file upload -->
        <div id="controlsContainer" class="hidden flex-col space-y-6 animate-fade-in text-left bg-gray-50 p-4 rounded-lg border border-gray-200">
            <h3 class="font-bold text-gray-700 border-b pb-2">Optimize & Shorten</h3>
            
            <!-- Controls Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                
                <!-- Max Width Control -->
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">Max Width (px)</label>
                    <input type="number" id="maxWidthInput" value="800" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g. 800">
                    <p class="text-xs text-gray-400 mt-1">Smaller width = Much shorter code.</p>
                </div>

                <!-- Quality Control -->
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
                        Quality: <span id="qualityVal">80</span>%
                    </label>
                    <input type="range" id="qualityInput" min="1" max="100" value="80" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    <p class="text-xs text-gray-400 mt-1">Lower quality = Shorter code.</p>
                </div>
            </div>
            
            <button onclick="processImage()" class="w-full py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition shadow-sm">
                Apply Compression
            </button>
        </div>

        <!-- Step 2: The Centered Image Display -->
        <div id="imageContainer" class="hidden flex-col items-center space-y-4 animate-fade-in">
            <div class="flex justify-between w-full items-end">
                <h2 class="text-xl font-semibold text-gray-700">Preview</h2>
                <span id="sizeLabel" class="text-xs font-mono bg-yellow-100 text-yellow-800 px-2 py-1 rounded">0 chars</span>
            </div>
            <div class="p-2 bg-white border border-gray-200 shadow-lg rounded-xl">
                <img id="previewImg" class="max-h-64 rounded-lg" src="" alt="Preview">
            </div>
        </div>

        <!-- Step 3: The Base64 Code Output -->
        <div id="codeContainer" class="hidden text-left space-y-2">
            <label class="text-sm font-bold text-gray-700 ml-1">Optimized Base64 Code:</label>
            <textarea id="base64Output" readonly 
                class="w-full h-32 p-3 text-xs font-mono text-gray-600 bg-gray-100 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none"
                placeholder="The code will appear here..."></textarea>
            
            <button onclick="copyCode()" class="w-full py-2 bg-gray-800 text-white rounded-lg font-medium hover:bg-gray-900 transition flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                </svg>
                Copy Code to Clipboard
            </button>
        </div>

    </div>

    <!-- JavaScript to handle the magic -->
    <script>
        const fileInput = document.getElementById('fileInput');
        const previewImg = document.getElementById('previewImg');
        const base64Output = document.getElementById('base64Output');
        const imageContainer = document.getElementById('imageContainer');
        const codeContainer = document.getElementById('codeContainer');
        const controlsContainer = document.getElementById('controlsContainer');
        const maxWidthInput = document.getElementById('maxWidthInput');
        const qualityInput = document.getElementById('qualityInput');
        const qualityVal = document.getElementById('qualityVal');
        const sizeLabel = document.getElementById('sizeLabel');

        let originalFile = null;

        // Update slider label
        qualityInput.addEventListener('input', (e) => {
            qualityVal.innerText = e.target.value;
        });

        // When a user selects a file
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                originalFile = file;
                controlsContainer.classList.remove('hidden');
                controlsContainer.classList.add('flex');
                // Auto process on first load
                processImage();
            }
        });

        function processImage() {
            if (!originalFile) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    // Create canvas for resizing/compressing
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;

                    // Calculate new dimensions based on Max Width
                    const maxWidth = parseInt(maxWidthInput.value) || 800;
                    if (width > maxWidth) {
                        height = Math.round((height * maxWidth) / width);
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;

                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);

                    // Export as WebP (efficient) or JPEG
                    // Quality is 0.0 to 1.0
                    const quality = parseInt(qualityInput.value) / 100;
                    const dataUrl = canvas.toDataURL('image/webp', quality);

                    // Update UI
                    previewImg.src = dataUrl;
                    base64Output.value = dataUrl;
                    
                    // Show size
                    const chars = dataUrl.length;
                    const kb = (chars / 1024).toFixed(1);
                    sizeLabel.innerText = `${chars.toLocaleString()} chars (~${kb} KB)`;

                    // Show containers
                    imageContainer.classList.remove('hidden');
                    imageContainer.classList.add('flex');
                    codeContainer.classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(originalFile);
        }

        function copyCode() {
            base64Output.select();
            document.execCommand('copy');
            // Check if alert is allowed (might be blocked in some iframe contexts, so we fallback to console or subtle UI if needed, but alert is standard)
            // Using a temporary text change on button for feedback is nicer
            const btn = document.querySelector('button[onclick="copyCode()"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = `<span class="text-green-400 font-bold">Copied!</span>`;
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }
    </script>

</body>
</html>
