<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Imposter, Who?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* English Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        /* Thai Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&display=swap');

        :root {
            --font-main: 'Fredoka', 'Kanit', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: #050505;
            color: white;
            overflow: hidden;
            touch-action: none; 
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- Animated Background --- */
        .bg-gradient-anim {
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #0f0c29);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            position: absolute;
            inset: 0;
            z-index: -20;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Animations --- */
        .title-anim {
            animation: zoomOutEffect 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }
        .btn-anim {
            opacity: 0; 
            animation: zoomOutEffect 1s cubic-bezier(0.22, 1, 0.36, 1) 0.5s forwards;
        }

        @keyframes zoomOutEffect {
            0% { opacity: 0; transform: scale(3); filter: blur(10px); }
            100% { opacity: 1; transform: scale(1); filter: blur(0); }
        }

        /* Pop Effect for Selection */
        .pop-effect {
            animation: popCircle 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popCircle {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Tick Animation */
        .tick-enter {
            animation: fadeInTick 0.3s ease-out forwards;
        }
        @keyframes fadeInTick {
            from { opacity: 0; transform: scale(0.5) rotate(-45deg); }
            to { opacity: 1; transform: scale(1) rotate(0deg); }
        }

        .typewriter-cursor::after {
            content: '|';
            animation: blink 1s step-start infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Utility classes */
        .hidden-screen { display: none !important; }
        .flex-screen { display: flex !important; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glass-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Scrollbar hiding */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Input styling */
        .name-input {
            background: transparent;
            border: none;
            border-bottom: 3px solid rgba(255,255,255,0.3);
            color: white;
            text-align: center;
            font-size: 2.5rem;
            width: 100%;
            outline: none;
            padding-bottom: 0.5rem;
            font-weight: 700;
            transition: all 0.3s ease;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .name-input:focus { 
            border-bottom-color: #f472b6; 
            box-shadow: 0 4px 20px -5px rgba(244, 114, 182, 0.5);
        }

        /* --- Curtain Layer Styling --- */
        #curtain-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
            display: flex;
            flex-col: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 50px rgba(0,0,0,0.8);
            will-change: transform; 
            background: linear-gradient(180deg, #1e1b4b 0%, #0f172a 100%);
        }

        .scroll-hint-anim {
            animation: bounceUp 1.5s infinite;
        }
        @keyframes bounceUp {
            0%, 100% { transform: translateY(0); opacity: 0.5; }
            50% { transform: translateY(-15px); opacity: 1; }
        }

        /* Language Toggle Styles */
        .lang-toggle-container {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 60;
            animation: fadeInDown 1s ease-out 0.5s forwards;
            opacity: 0;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .lang-toggle {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 9999px;
            padding: 4px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .lang-btn {
            padding: 6px 16px;
            border-radius: 9999px;
            font-weight: 700;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.5);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .lang-btn.active {
            background: white;
            color: #4f46e5;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="w-full h-screen relative">

    <!-- Background Animation -->
    <div class="bg-gradient-anim"></div>
    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20 pointer-events-none z-0"></div>

    <!-- LANGUAGE TOGGLE -->
    <div id="lang-toggle" class="lang-toggle-container">
        <div class="lang-toggle">
            <div id="lang-en" class="lang-btn active" onclick="setLanguage('en')">Eng</div>
            <div id="lang-th" class="lang-btn" onclick="setLanguage('th')">ไทย</div>
        </div>
    </div>

    <!-- 1. MAIN MENU -->
    <div id="screen-main" class="flex-screen w-full h-full flex-col items-center justify-center p-6 relative z-10">
        <div class="relative">
            <h1 id="txt-title" class="text-6xl md:text-8xl font-black tracking-wide title-anim text-center leading-tight mb-2 text-transparent bg-clip-text bg-gradient-to-r from-rose-400 via-fuchsia-500 to-indigo-500 drop-shadow-2xl filter" style="filter: drop-shadow(0 0 15px rgba(236, 72, 153, 0.5));">
                IMPOSTER<br>WHO?
            </h1>
        </div>
        <p id="txt-subtitle" class="text-indigo-200/60 mt-4 mb-12 text-lg tracking-widest uppercase font-semibold btn-anim" style="animation-delay: 0.3s;">The Party Game</p>
        <button id="main-start-btn" onclick="goToSelection()" class="btn-anim group relative px-16 py-6 rounded-full font-bold text-2xl shadow-[0_0_30px_rgba(79,70,229,0.4)] transition-all transform hover:scale-105 active:scale-95 bg-white overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-indigo-600 to-purple-600 transition-all duration-300 group-hover:opacity-90"></div>
            <span class="relative z-10 text-white tracking-wider flex items-center gap-2">
                <span id="txt-start">START</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
            </span>
        </button>
    </div>

    <!-- 2. NUMBER SELECTION -->
    <div id="screen-selection" class="hidden-screen w-full h-full flex-col items-center px-4 py-8 z-10 relative">
        <h2 id="txt-select-players" class="text-3xl mb-6 text-indigo-200 font-bold tracking-wide mt-4 drop-shadow-lg">Select Players</h2>
        
        <!-- Grid Container for up to 20 players -->
        <div class="w-full flex-1 overflow-y-auto no-scrollbar max-w-2xl pb-4 px-2">
            <div id="button-grid" class="grid grid-cols-3 sm:grid-cols-4 gap-3 w-full">
                <!-- JS generates 20 buttons here -->
            </div>
        </div>
        
        <div class="w-full max-w-md mt-2 pt-4 flex justify-center pb-8">
            <button id="selection-start-btn" onclick="goToNameInput()" class="w-full py-5 rounded-2xl text-xl font-bold shadow-xl transition-all active:scale-95 cursor-not-allowed bg-white/5 text-white/30 border border-white/10 backdrop-blur-sm" disabled>
                <span id="txt-continue">CONTINUE</span>
            </button>
        </div>
    </div>

    <!-- 3. NAME INPUT -->
    <div id="screen-name" class="hidden-screen w-full h-full flex-col items-center justify-between px-6 py-8 max-w-md mx-auto z-10 relative">
        <div class="w-full flex flex-col items-center mt-12 glass-panel p-8 rounded-3xl shadow-2xl">
            <h3 id="player-label" class="text-indigo-300 text-sm font-bold uppercase tracking-[0.2em] mb-4 bg-indigo-900/50 px-4 py-1 rounded-full border border-indigo-500/30">Player 1</h3>
            <h2 id="txt-enter-name" class="text-2xl font-bold mb-10 text-white/80">What is your name?</h2>
            <input type="text" id="name-input-field" class="name-input" placeholder="Name" autocomplete="off" maxlength="12">
        </div>
        <div class="w-full flex justify-between items-end mb-4 gap-4">
            <button onclick="prevName()" class="px-6 py-4 rounded-xl font-bold text-white/60 hover:text-white hover:bg-white/10 transition-colors flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                <span id="txt-back">BACK</span>
            </button>
            <button onclick="nextName()" class="flex-1 px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white rounded-xl font-bold shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2">
                <span id="txt-next">NEXT</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
        </div>
    </div>

    <!-- 4. CINEMATIC INTRO -->
    <div id="screen-cinematic" class="hidden-screen w-full h-full bg-black flex flex-col items-center justify-center p-8 text-center z-[100] absolute inset-0">
        <h1 id="cinematic-text" class="text-5xl md:text-6xl font-mono text-emerald-400 typewriter-cursor font-bold tracking-tight drop-shadow-[0_0_15px_rgba(52,211,153,0.8)]"></h1>
    </div>

    <!-- 5. CURTAIN REVEAL MECHANIC -->
    <div id="screen-curtain" class="hidden-screen w-full h-full relative overflow-hidden bg-black z-20">
        
        <!-- LAYER 1: THE SECRET -->
        <div id="secret-layer" class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900 z-10 pointer-events-none p-4 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-gray-800 to-black">
            <div id="txt-secret-role" class="absolute top-1/4 opacity-50 text-white/20 uppercase tracking-[0.5em] text-xs font-bold">Secret Role</div>
            
            <div id="role-display" class="text-5xl md:text-7xl font-black text-center break-words max-w-full scale-100 drop-shadow-2xl leading-tight">
                <!-- CONTENT -->
            </div>
            
            <div class="absolute bottom-12 flex items-center gap-2 text-white/30 text-xs font-mono uppercase tracking-widest border border-white/10 px-4 py-2 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                <span id="txt-release-hide">Release to Hide</span>
            </div>
        </div>

        <!-- LAYER 2: THE CURTAIN -->
        <div id="curtain-layer" class="border-b-8 border-indigo-500/50 shadow-[0_10px_60px_-15px_rgba(0,0,0,1)]">
            <div id="curtain-content" class="flex flex-col items-center justify-center w-full h-full transition-opacity duration-300 relative">
                
                <div class="glass-panel px-10 py-12 rounded-3xl flex flex-col items-center shadow-2xl transform transition-transform">
                    <div id="txt-current-turn" class="mb-4 text-indigo-300 text-xs font-bold uppercase tracking-[0.3em] bg-white/5 px-3 py-1 rounded-full">Current Turn</div>
                    <h1 id="curtain-player-name" class="text-5xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-br from-white to-indigo-200 mb-2 text-center drop-shadow-lg leading-tight p-2">Name</h1>
                </div>
                
                <div id="curtain-instruction" class="absolute bottom-16 flex flex-col items-center gap-3 text-indigo-300 animate-pulse">
                    <div class="w-16 h-16 rounded-full bg-white/5 border border-white/10 flex items-center justify-center scroll-hint-anim shadow-[0_0_30px_rgba(79,70,229,0.3)]">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-100" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 15l7-7 7 7" />
                        </svg>
                    </div>
                    <p id="txt-swipe-hint" class="uppercase tracking-[0.2em] text-xs font-bold text-indigo-200/70">Swipe Up & Hold</p>
                </div>

                <button id="curtain-next-btn" onclick="finishTurn()" class="hidden absolute bottom-16 px-12 py-5 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-400 hover:to-teal-500 text-white rounded-2xl text-xl font-bold shadow-[0_0_30px_rgba(16,185,129,0.4)] transition-all transform hover:scale-105 active:scale-95 animate-[fadeIn_0.5s_ease-out] flex items-center gap-3">
                    <span id="txt-pass">PASS DEVICE</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- 6. DISCUSSION -->
    <div id="screen-discuss" class="hidden-screen w-full h-full flex-col items-center justify-center p-6 text-center z-10 relative">
        <div class="glass-panel p-10 rounded-3xl w-full max-w-md shadow-2xl border-t border-white/20">
            <h1 id="txt-discuss-title" class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-orange-500 mb-6 title-anim drop-shadow-sm filter" style="filter: drop-shadow(0 0 10px rgba(239, 68, 68, 0.5));">
                DISCUSS!
            </h1>
            <p class="text-xl text-indigo-100/80 mb-12 font-medium leading-relaxed">
                <span id="txt-game-begun">The game has begun.</span><br>
                <span id="txt-find-imposter" class="text-sm uppercase tracking-widest text-indigo-300/50 font-bold mt-2 block">Find the imposter</span>
            </p>
            <button onclick="resetGame()" class="w-full px-8 py-4 border border-white/20 bg-white/5 rounded-xl text-white/70 hover:text-white hover:bg-white/10 hover:border-white/40 transition-all font-bold tracking-wide">
                <span id="txt-play-again">PLAY AGAIN</span>
            </button>
        </div>
    </div>

    <script>
        // --- Localization Data ---
        const TRANSLATIONS = {
            en: {
                title: "IMPOSTER<br>WHO?",
                subtitle: "The Party Game",
                start: "START",
                selectPlayers: "Select Players",
                playerCount: "Players", // used in context "4 Players"
                continue: "CONTINUE",
                playerLabel: "Player",
                enterName: "What is your name?",
                placeholder: "Name",
                back: "BACK",
                next: "NEXT",
                cinematicWho: "Who is the...",
                cinematicImposter: "IMPOSTER?",
                secretRole: "Secret Role",
                roleImposter: "IMPOSTER",
                releaseHide: "Release to Hide",
                currentTurn: "Current Turn",
                swipeHint: "Swipe Up & Hold",
                pass: "PASS DEVICE",
                discussTitle: "DISCUSS!",
                gameBegun: "The game has begun.",
                findImposter: "Find the imposter",
                playAgain: "PLAY AGAIN"
            },
            th: {
                title: "IMPOSTER<br>WHO?",
                subtitle: "ปาร์ตี้เกมจับโกหก",
                start: "เริ่มเกม",
                selectPlayers: "เลือกจำนวนผู้เล่น",
                playerCount: "คน", // used as "4 คน"
                continue: "ไปต่อ",
                playerLabel: "ผู้เล่นคนที่",
                enterName: "คุณชื่ออะไร?",
                placeholder: "ชื่อของคุณ",
                back: "ย้อนกลับ",
                next: "ถัดไป",
                cinematicWho: "ใครกันที่เป็น...",
                cinematicImposter: "สปาย?",
                secretRole: "บทบาทลับ",
                roleImposter: "สปาย",
                releaseHide: "ปล่อยเพื่อซ่อน",
                currentTurn: "ตาของ",
                swipeHint: "เลื่อนขึ้นค้างไว้",
                pass: "ส่งมือถือต่อ",
                discussTitle: "จับตัวคนร้าย!",
                gameBegun: "เกมเริ่มแล้ว",
                findImposter: "หาตัวสปายให้เจอ!",
                playAgain: "เล่นอีกครั้ง"
            }
        };

        /* --- MASSIVE DICTIONARY GENERATION ---
           To simulate 10,000+ words without 20MB of text, we use category arrays 
           and concatenated strings.
        */

        // ENGLISH DATA
        const EN_ANIMALS = "Dog|Cat|Elephant|Tiger|Lion|Giraffe|Monkey|Penguin|Panda|Koala|Kangaroo|Zebra|Bunny|Hamster|Dinosaur|T-Rex|Dragon|Unicorn|Mermaid|Shark|Whale|Dolphin|Octopus|Starfish|Frog|Turtle|Snake|Spider|Butterfly|Bee|Ant|Mosquito|Fly|Bird|Chicken|Duck|Pig|Cow|Horse|Sheep|Goat|Wolf|Bear|Fox|Deer|Camel|Rhino|Hippo|Crocodile|Alligator|Bat|Owl|Eagle|Parrot|Peacock|Swan|Flamingo|Seal|Walrus|Otter|Beaver|Racoon|Skunk|Squirrel|Rat|Mouse|Lizard|Chameleon|Iguana|Gecko|Snail|Slug|Worm|Crab|Lobster|Shrimp|Jellyfish|Seahorse|Eel|Ray|Squid|Clam|Oyster|Coral|Sponge|Bacteria|Virus|Amoeba|Plankton|Krill|Mammoth|Saber-tooth|Dodo|Phoenix|Griffin|Hydra|Sphinx|Centaur|Minotaur|Werewolf|Vampire|Zombie|Ghost|Alien|Robot|Cyborg|Android|Drone|Clone|Mutant";
        
        const EN_FOOD = "Pizza|Burger|Hot Dog|Fries|Sandwich|Taco|Sushi|Noodles|Rice|Spaghetti|Bread|Cheese|Egg|Milk|Ice Cream|Cake|Cookie|Donut|Chocolate|Candy|Lollipop|Popcorn|Chips|Apple|Banana|Orange|Grape|Strawberry|Watermelon|Pineapple|Coconut|Tomato|Potato|Carrot|Broccoli|Corn|Onion|Garlic|Pepper|Salt|Sugar|Water|Juice|Soda|Coffee|Tea|Beer|Wine|Whiskey|Vodka|Rum|Gin|Tequila|Cocktail|Smoothie|Milkshake|Yogurt|Butter|Cream|Honey|Jam|Peanut Butter|Salad|Soup|Steak|Chicken|Fish|Pork|Beef|Lamb|Bacon|Ham|Sausage|Meatball|Dumpling|Spring Roll|Curry|Stew|Roast|BBQ|Kebab|Burrito|Nachos|Quesadilla|Enchilada|Paella|Risotto|Lasagna|Ravioli|Mac & Cheese|Pancake|Waffle|Crepe|Toast|Bagel|Croissant|Muffin|Brownie|Pie|Tart|Pudding|Custard|Jello|Mousse|Sorbet|Gelato";

        const EN_PLACES = "School|Classroom|Playground|Library|Gym|Park|Zoo|Museum|Cinema|Mall|Shop|Hospital|Police Station|Fire Station|Airport|Train Station|Bus Stop|House|Room|Kitchen|Bathroom|Toilet|Bedroom|Living Room|Garden|Beach|Sea|Ocean|River|Mountain|Forest|Jungle|Desert|City|Village|Farm|Space|Moon|Sun|Star|Planet|Earth|Mars|Bank|Post Office|Hotel|Restaurant|Cafe|Bar|Club|Stadium|Arena|Theater|Concert Hall|Church|Temple|Mosque|Synagogue|Castle|Palace|Fort|Tower|Bridge|Tunnel|Road|Street|Highway|Factory|Office|Warehouse|Lab|Studio|Workshop|Garage|Basement|Attic|Roof|Balcony|Patio|Pool|Spa|Sauna|Casino|Arcade|Theme Park|Circus|Fair|Market|Supermarket|Bakery|Butcher|Pharmacy|Clinic|Dentist|Vet|Barber|Salon|Spa|Gym|Dorm|Hostel|Motel|Camp|Tent|Cave|Island|Volcano|Canyon|Waterfall|Glacier|Iceberg|Swamp|Bog|Marsh|Field|Meadow|Hill|Valley|Cliff";

        const EN_OBJECTS = "Rocket|UFO|Computer|Phone|iPad|TV|Camera|Watch|Clock|Lamp|Fan|Table|Chair|Bed|Sofa|Door|Window|Car|Bus|Truck|Train|Plane|Boat|Ship|Submarine|Bike|Scooter|Skateboard|Ball|Doll|Teddy Bear|Lego|Puzzle|Game|Book|Pencil|Pen|Eraser|Ruler|Bag|Shoes|Socks|Shirt|Pants|Dress|Hat|Glasses|Umbrella|Key|Money|Wallet|Ring|Necklace|Earring|Bracelet|Lipstick|Perfume|Soap|Shampoo|Towel|Toothbrush|Toothpaste|Comb|Brush|Mirror|Scissors|Knife|Fork|Spoon|Plate|Bowl|Cup|Mug|Glass|Bottle|Can|Box|Basket|Bucket|Broom|Mop|Vacuum|Iron|Washing Machine|Dryer|Fridge|Oven|Stove|Microwave|Toaster|Blender|Mixer|Kettle|Pot|Pan|Laptop|Keyboard|Mouse|Screen|Printer|Speaker|Headphones|Microphone|Guitar|Piano|Violin|Drum|Flute|Trumpet|Saxophone|Battery|Charger|Cable|Wire|Switch|Button|Remote|Controller|Console|Cartridge|Disc|USB|Card|Paper|Notebook|Envelope|Stamp|Ticket|Passport|Map|Compass|Flashlight|Candle|Match|Lighter|Firework|Balloon|Kite";

        const EN_JOBS = "Doctor|Nurse|Teacher|Student|Police|Firefighter|Soldier|Pilot|Chef|Farmer|Artist|Singer|Dancer|Actor|King|Queen|Prince|Princess|Pirate|Ninja|Superhero|Wizard|Witch|Magician|Clown|Acrobat|Athlete|Coach|Referee|Judge|Lawyer|Politician|President|Spy|Detective|Thief|Criminal|Prisoner|Guard|Driver|Mechanic|Engineer|Architect|Builder|Plumber|Electrician|Carpenter|Painter|Cleaner|Maid|Butler|Waiter|Bartender|Barista|Baker|Butcher|Grocer|Florist|Jeweler|Tailor|Stylist|Model|Photographer|Journalist|Writer|Poet|Musician|Composer|Director|Producer|Editor|Designer|Programmer|Hacker|Scientist|Chemist|Biologist|Physicist|Astronomer|Astronaut|Explorer|Sailor|Fisherman|Hunter|Miner|Lumberjack|Cowboy|Shepherd|Priest|Monk|Nun|Pope|God|Goddess|Angel|Demon|Devil|Satan|Genie|Fairy|Elf|Dwarf|Giant|Troll|Ogre|Goblin|Orc";

        const EN_ABSTRACT = "Love|Hate|War|Peace|Life|Death|Dream|Nightmare|Heaven|Hell|Magic|Science|History|Math|Art|Music|Time|Space|Energy|Gravity|Speed|Light|Sound|Heat|Cold|Fire|Water|Air|Earth|Wind|Rain|Snow|Storm|Thunder|Lightning|Rainbow|Cloud|Sky|Sun|Moon|Star|Galaxy|Universe|Black Hole|Big Bang|Evolution|Revolution|Freedom|Justice|Truth|Lie|Secret|Mystery|Puzzle|Riddle|Joke|Story|Legend|Myth|Fairy Tale|Movie|Song|Poem|Book|Game|Sport|Team|Family|Friend|Enemy|Hero|Villain|Leader|Follower|Winner|Loser|Rich|Poor|Happy|Sad|Angry|Scared|Brave|Coward|Smart|Stupid|Funny|Serious|Beautiful|Ugly|Big|Small|Fast|Slow|Strong|Weak|Hot|Cold|New|Old|Good|Bad";
        
        // THAI DATA
        const TH_ANIMALS = "สุนัข|แมว|ช้าง|เสือ|สิงโต|ยีราฟ|ลิง|เพนกวิน|หมีแพนด้า|โคอาล่า|จิงโจ้|ม้าลาย|กระต่าย|แฮมสเตอร์|ไดโนเสาร์|ทีเร็กซ์|มังกร|ยูนิคอร์น|นางเงือก|ฉลาม|วาฬ|โลมา|หมึก|ปลาดาว|กบ|เต่า|งู|แมงมุม|ผีเสื้อ|ผึ้ง|มด|ยุง|แมลงวัน|นก|ไก่|เป็ด|หมู|วัว|ม้า|แกะ|แพะ|หมาป่า|หมี|จิ้งจอก|กวาง|อูฐ|แรด|ฮิปโป|จระเข้|ค้างคาว|นกฮูก|อินทรี|นกแก้ว|นกยูง|หงส์|ฟลามิงโก|แมวน้ำ|วอลรัส|นาก|บีเวอร์|แรคคูน|สกั๊งค์|กระรอก|หนู|จิ้งจก|กิ้งก่า|อีกัวน่า|ตุ๊กแก|หอยทาก|ทาก|หนอน|ปู|กุ้งมังกร|กุ้ง|แมงกะพรุน|ม้าน้ำ|ปลาไหล|กระเบน|ปลาหมึก|หอย|ปะการัง|ฟองน้ำ|แบคทีเรีย|ไวรัส|อะมีบา|แพลงก์ตอน|เคย|แมมมอธ|นกโดโด|ฟีนิกซ์|กริฟฟิน|ไฮดรา|สฟิงซ์|เซนทอร์|มิโนทอร์|มนุษย์หมาป่า|แวมไพร์|ซอมบี้|ผี|เอเลี่ยน|หุ่นยนต์|ไซบอร์ก|แอนดรอยด์|โดรน|โคลน|กลายพันธุ์";

        const TH_FOOD = "พิซซ่า|เบอร์เกอร์|ฮอทดอก|เฟรนช์ฟรายส์|แซนด์วิช|ทาโก้|ซูชิ|ก๋วยเตี๋ยว|ข้าว|สปาเก็ตตี้|ขนมปัง|ชีส|ไข่|นม|ไอศกรีม|เค้ก|คุกกี้|โดนัท|ช็อกโกแลต|ลูกอม|อมยิ้ม|ป๊อปคอร์น|มันฝรั่งทอด|แอปเปิ้ล|กล้วย|ส้ม|องุ่น|สตรอว์เบอร์รี|แตงโม|สับปะรด|มะพร้าว|มะเขือเทศ|มันฝรั่ง|แครอท|บรอกโคลี|ข้าวโพด|หอมหัวใหญ่|กระเทียม|พริก|เกลือ|น้ำตาล|น้ำเปล่า|น้ำผลไม้|น้ำอัดลม|กาแฟ|ชา|เบียร์|ไวน์|วิสกี้|วอดก้า|เหล้า|ค็อกเทล|สมูทตี้|นมปั่น|โยเกิร์ต|เนย|ครีม|น้ำผึ้ง|แยม|เนยถั่ว|สลัด|ซุป|สเต็ก|ไก่ย่าง|ปลาเผา|หมูย่าง|เนื้อย่าง|เบคอน|แฮม|ไส้กรอก|ลูกชิ้น|เกี๊ยว|ปอเปี๊ยะ|แกงกะหรี่|สตูว์|บาร์บีคิว|หมูกระทะ|ส้มตำ|ต้มยำกุ้ง|ผัดไทย|ข้าวมันไก่|ข้าวขาหมู|ข้าวผัด|กะเพรา|ราดหน้า|ผัดซีอิ๊ว|ขนมจีน|บะหมี่|แพนเค้ก|วาฟเฟิล|เครป|ขนมปังปิ้ง|ครัวซองต์|มัฟฟิน|บราวนี่|พาย|ทาร์ต|พุดดิ้ง|สังขยา|วุ้น|เฉาก๊วย|บัวลอย";

        const TH_PLACES = "โรงเรียน|ห้องเรียน|สนามเด็กเล่น|ห้องสมุด|โรงยิม|สวนสาธารณะ|สวนสัตว์|พิพิธภัณฑ์|โรงหนัง|ห้างสรรพสินค้า|ร้านค้า|โรงพยาบาล|สถานีตำรวจ|สถานีดับเพลิง|สนามบิน|สถานีรถไฟ|ป้ายรถเมล์|บ้าน|ห้อง|ห้องครัว|ห้องน้ำ|ส้วม|ห้องนอน|ห้องนั่งเล่น|สวน|ชายหาด|ทะเล|มหาสมุทร|แม่น้ำ|ภูเขา|ป่า|ป่าดงดิบ|ทะเลทราย|เมือง|หมู่บ้าน|ฟาร์ม|อวกาศ|ดวงจันทร์|ดวงอาทิตย์|ดาว|ดาวเคราะห์|โลก|ดาวอังคาร|ธนาคาร|ที่ทำการไปรษณีย์|โรงแรม|ร้านอาหาร|คาเฟ่|บาร์|ผับ|สนามกีฬ|โรงละคร|คอนเสิร์ต|วัด|โบสถ์|มัสยิด|ศาลเจ้า|ปราสาท|พระราชวัง|ป้อม|หอคอย|สะพาน|อุโมงค์|ถนน|ทางด่วน|โรงงาน|ออฟฟิศ|โกดัง|ห้องแล็บ|สตูดิโอ|อู่ซ่อมรถ|ห้องใต้ดิน|ห้องใต้หลังคา|ดาดฟ้า|ระเบียง|สระว่ายน้ำ|สปา|ซาวน่า|คาสิโน|ร้านเกม|สวนสนุก|คณะละครสัตว์|ตลาด|ซูเปอร์มาร์เก็ต|ร้านเบเกอรี่|ร้านขายยา|คลินิก|ร้านตัดผม|หอพัก|โมเต็ล|แคมป์|เต็นท์|ถ้ำ|เกาะ|ภูเขาไฟ|หุบเขา|น้ำตก|ธารน้ำแข็ง|หนองน้ำ|ทุ่งนา|ทุ่งหญ้า|หน้าผา";

        const TH_OBJECTS = "จรวด|UFO|คอมพิวเตอร์|โทรศัพท์|ไอแพด|ทีวี|กล้องถ่ายรูป|นาฬิกาข้อมือ|นาฬิกา|โคมไฟ|พัดลม|โต๊ะ|เก้าอี้|เตียง|โซฟา|ประตู|หน้าต่าง|รถยนต์|รถเมล์|รถบรรทุก|รถไฟ|เครื่องบิน|เรือ|เรือสำราญ|เรือดำน้ำ|จักรยาน|สกู๊ตเตอร์|สเก็ตบอร์ด|ลูกบอล|ตุ๊กตา|ตุ๊กตาหมี|เลโก้|จิ๊กซอว์|เกม|หนังสือ|ดินสอ|ปากกา|ยางลบ|ไม้บรรทัด|กระเป๋า|รองเท้า|ถุงเท้า|เสื้อ|กางเกง|ชุดเดรส|หมวก|แว่นตา|ร่ม|กุญแจ|เงิน|กระเป๋าสตางค์|แหวน|สร้อยคอ|ต่างหู|กำไล|ลิปสติก|น้ำหอม|สบู่|แชมพู|ผ้าเช็ดตัว|แปรงสีฟัน|ยาสีฟัน|หวี|กระจก|กรรไกร|มีด|ส้อม|ช้อน|จาน|ชาม|ถ้วย|แก้ว|ขวด|กระป๋อง|กล่อง|ตะกร้า|ถังน้ำ|ไม้กวาด|ไม้ถูพื้น|เครื่องดูดฝุ่น|เตารีด|เครื่องซักผ้า|ตู้เย็น|เตาอบ|เตาแก๊ส|ไมโครเวฟ|เครื่องปิ้งขนมปัง|เครื่องปั่น|กาต้มน้ำ|หม้อ|กระทะ|แล็ปท็อป|คีย์บอร์ด|เมาส์|หน้าจอ|เครื่องปริ้น|ลำโพง|หูฟัง|ไมโครโฟน|กีตาร์|เปียโน|ไวโอลิน|กลอง|ขลุ่ย|แตร|แซกโซโฟน|แบตเตอรี่|สายชาร์จ|สายไฟ|สวิตช์|ปุ่มกด|รีโมท|จอยเกม|เครื่องเกม|แผ่นเกม|แผ่นเสียง|USB|การ์ด|กระดาษ|สมุด|ซองจดหมาย|แสตมป์|ตั๋ว|พาสปอร์ต|แผนที่|เข็มทิศ|ไฟฉาย|เทียน|ไม้ขีด|ไฟแช็ก|พลุ|ลูกโป่ง|ว่าว";

        const TH_JOBS = "หมอ|พยาบาล|ครู|นักเรียน|ตำรวจ|นักดับเพลิง|ทหาร|นักบิน|เชฟ|ชาวนา|ศิลปิน|นักร้อง|นักเต้น|นักแสดง|พระราชา|ราชินี|เจ้าชาย|เจ้าหญิง|โจรสลัด|นินจา|ซูเปอร์ฮีโร่|พ่อมด|แม่มด|นักมายากล|ตัวตลก|นักกายกรรม|นักกีฬา|โค้ช|กรรมการ|ผู้พิพากษา|ทนายความ|นักการเมือง|นายก|สปาย|นักสืบ|โจร|อาชญากร|นักโทษ|ยาม|คนขับรถ|ช่างยนต์|วิศวกร|สถาปนิก|ช่างก่อสร้าง|ช่างประปา|ช่างไฟ|ช่างไม้|ช่างทาสี|คนทำความสะอาด|แม่บ้าน|พ่อบ้าน|พนักงานเสิร์ฟ|บาร์เทนเดอร์|บาริสต้า|คนขายเนื้อ|คนขายดอกไม้|ช่างทำผม|นางแบบ|ช่างภาพ|นักข่าว|นักเขียน|กวี|นักดนตรี|นักแต่งเพลง|ผู้กำกับ|โปรดิวเซอร์|บรรณาธิการ|ดีไซเนอร์|โปรแกรมเมอร์|แฮกเกอร์|นักวิทยาศาสตร์|นักเคมี|นักชีววิทยา|นักฟิสิกส์|นักดาราศาสตร์|นักบินอวกาศ|นักสำรวจ|กะลาสี|ชาวประมง|นายพราน|คนงานเหมือง|คาวบอย|คนเลี้ยงแกะ|พระ|แม่ชี|นักบวช|เทพเจ้า|นางฟ้า|เทวดา|ปีศาจ|ซาตาน|ยักษ์จินนี่|เอลฟ์|คนแคระ|ยักษ์|โทรล|ออร์ค";

        const TH_ABSTRACT = "ความรัก|ความเกลียด|สงคราม|สันติภาพ|ชีวิต|ความตาย|ความฝัน|ฝันร้าย|สวรรค์|นรก|เวทมนตร์|วิทยาศาสตร์|ประวัติศาสตร์|คณิตศาสตร์|ศิลปะ|ดนตรี|เวลา|อวกาศ|พลังงาน|แรงโน้มถ่วง|ความเร็ว|แสง|เสียง|ความร้อน|ความเย็น|ไฟ|น้ำ|ลม|ดิน|ฝน|หิมะ|พายุ|ฟ้าผ่า|รุ้ง|เมฆ|ท้องฟ้า|ดวงอาทิตย์|ดวงจันทร์|ดาว|กาแล็กซี|จักรวาล|หลุมดำ|บิกแบง|วิวัฒนาการ|การปฏิวัติ|อิสรภาพ|ความยุติธรรม|ความจริง|คำโกหก|ความลับ|ปริศนา|เรื่องตลก|นิทาน|ตำนาน|หนัง|เพลง|กลอน|หนังสือ|เกม|กีฬา|ทีม|ครอบครัว|เพื่อน|ศัตรู|ฮีโร่|ตัวร้าย|ผู้นำ|ผู้ตาม|ผู้ชนะ|ผู้แพ้|รวย|จน|มีความสุข|เศร้า|โกรธ|กลัว|กล้าหาญ|ขี้ขลาด|ฉลาด|โง่|ตลก|จริงจัง|สวย|น่าเกลียด|ใหญ่|เล็ก|เร็ว|ช้า|แข็งแรง|อ่อนแอ|ร้อน|หนาว|ใหม่|เก่า|ดี|เลว";

        // Construct massive lists
        function buildDictionary(sources) {
            let combined = "";
            sources.forEach(s => combined += "|" + s);
            // remove leading |
            if (combined.startsWith("|")) combined = combined.substring(1);
            const array = combined.split("|");
            // Shuffle
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        const NOUNS_EN = buildDictionary([EN_ANIMALS, EN_FOOD, EN_PLACES, EN_OBJECTS, EN_JOBS, EN_ABSTRACT]);
        const NOUNS_TH = buildDictionary([TH_ANIMALS, TH_FOOD, TH_PLACES, TH_OBJECTS, TH_JOBS, TH_ABSTRACT]);

        // --- Game State ---
        let currentLang = 'en';
        let playerNames = [];
        let selectedPlayerCount = 0;
        let currentPlayerIndex = 0;
        let imposterIndex = -1;
        let currentWord = "";
        let turnIndex = 0;

        // --- Screen Management ---
        const screens = {
            main: document.getElementById('screen-main'),
            selection: document.getElementById('screen-selection'),
            name: document.getElementById('screen-name'),
            cinematic: document.getElementById('screen-cinematic'),
            curtain: document.getElementById('screen-curtain'),
            discuss: document.getElementById('screen-discuss')
        };
        const langToggle = document.getElementById('lang-toggle');

        function setLanguage(lang) {
            currentLang = lang;
            const t = TRANSLATIONS[lang];

            document.getElementById('lang-en').className = `lang-btn ${lang === 'en' ? 'active' : ''}`;
            document.getElementById('lang-th').className = `lang-btn ${lang === 'th' ? 'active' : ''}`;

            document.getElementById('txt-title').innerHTML = t.title;
            document.getElementById('txt-subtitle').innerText = t.subtitle;
            document.getElementById('txt-start').innerText = t.start;
            
            document.getElementById('txt-select-players').innerText = t.selectPlayers;
            document.getElementById('txt-continue').innerText = t.continue;
            
            // Re-render buttons to update text
            renderPlayerButtons();
            
            document.getElementById('txt-enter-name').innerText = t.enterName;
            document.getElementById('name-input-field').placeholder = t.placeholder;
            document.getElementById('txt-back').innerText = t.back;
            document.getElementById('txt-next').innerText = t.next;
            
            document.getElementById('txt-secret-role').innerText = t.secretRole;
            document.getElementById('txt-release-hide').innerText = t.releaseHide;
            document.getElementById('txt-current-turn').innerText = t.currentTurn;
            document.getElementById('txt-swipe-hint').innerText = t.swipeHint;
            document.getElementById('txt-pass').innerText = t.pass;
            
            document.getElementById('txt-discuss-title').innerText = t.discussTitle;
            document.getElementById('txt-game-begun').innerText = t.gameBegun;
            document.getElementById('txt-find-imposter').innerText = t.findImposter;
            document.getElementById('txt-play-again').innerText = t.playAgain;
        }

        // --- Init: Number Selection (Grid of 20) ---
        const buttonGrid = document.getElementById('button-grid');
        
        function renderPlayerButtons() {
            buttonGrid.innerHTML = '';
            const t = TRANSLATIONS[currentLang];
            // Loop from 3 to 20
            for (let i = 3; i <= 20; i++) {
                const btn = document.createElement('div');
                
                let isSelected = (selectedPlayerCount === i);
                let activeClass = isSelected ? "bg-indigo-600 border-indigo-400 text-white transform scale-105 shadow-lg shadow-indigo-500/50" : "bg-white/5 border-white/10 text-white/50 hover:bg-white/10";
                
                btn.className = `cursor-pointer rounded-xl border p-4 flex flex-col items-center justify-center transition-all duration-200 ${activeClass}`;
                
                // Content
                btn.innerHTML = `
                    <span class="text-3xl font-bold mb-1">${i}</span>
                    <span class="text-[0.6rem] uppercase tracking-wider opacity-70">${t.playerCount}</span>
                `;
                
                btn.onclick = function() { selectPlayerCount(i); };
                buttonGrid.appendChild(btn);
            }
        }
        
        // Initial render
        renderPlayerButtons();

        // --- Navigation ---
        function showScreen(screenId) {
            Object.values(screens).forEach(s => {
                s.classList.add('hidden-screen');
                s.classList.remove('flex-screen');
            });
            const s = screens[screenId];
            s.classList.add('flex-screen');
        }

        function goToSelection() { 
            langToggle.classList.add('hidden-screen');
            showScreen('selection'); 
        }

        function selectPlayerCount(count) {
            selectedPlayerCount = count;
            renderPlayerButtons(); // Re-render to highlight selection
            
            const nextBtn = document.getElementById('selection-start-btn');
            nextBtn.disabled = false;
            nextBtn.classList.remove('bg-white/5', 'text-white/30', 'cursor-not-allowed');
            nextBtn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-indigo-600', 'text-white', 'hover:from-blue-500', 'hover:to-indigo-500', 'shadow-lg', 'shadow-indigo-900/50');
        }

        function goToNameInput() {
            if (selectedPlayerCount === 0) return;
            playerNames = new Array(selectedPlayerCount).fill("");
            currentPlayerIndex = 0;
            updateNameInputUI();
            showScreen('name');
            setTimeout(() => document.getElementById('name-input-field').focus(), 100);
        }

        // --- Name Input ---
        const nameInput = document.getElementById('name-input-field');
        const playerLabel = document.getElementById('player-label');

        function updateNameInputUI() {
            const t = TRANSLATIONS[currentLang];
            let labelText = `${t.playerLabel} ${currentPlayerIndex + 1}`;
            playerLabel.innerText = labelText;
            nameInput.value = playerNames[currentPlayerIndex] || "";
            nameInput.focus();
        }

        function nextName() {
            const val = nameInput.value.trim();
            if (!val) {
                // Shake effect
                nameInput.classList.add('border-red-500');
                nameInput.style.transform = "translateX(10px)";
                setTimeout(()=> nameInput.style.transform = "translateX(-10px)", 50);
                setTimeout(()=> nameInput.style.transform = "translateX(0)", 100);
                setTimeout(() => nameInput.classList.remove('border-red-500'), 500);
                return;
            }
            playerNames[currentPlayerIndex] = val;
            if (currentPlayerIndex < selectedPlayerCount - 1) {
                currentPlayerIndex++;
                updateNameInputUI();
            } else {
                startCinematic();
            }
        }
        function prevName() {
            if (currentPlayerIndex > 0) {
                playerNames[currentPlayerIndex] = nameInput.value.trim();
                currentPlayerIndex--;
                updateNameInputUI();
            } else {
                showScreen('selection');
            }
        }
        nameInput.addEventListener("keypress", (e) => { if(e.key==="Enter") nextName(); });

        // --- Cinematic ---
        async function startCinematic() {
            imposterIndex = Math.floor(Math.random() * selectedPlayerCount);
            
            const dict = currentLang === 'th' ? NOUNS_TH : NOUNS_EN;
            // Pick a random word from the massive list
            currentWord = dict[Math.floor(Math.random() * dict.length)];
            
            turnIndex = 0;
            const t = TRANSLATIONS[currentLang];

            showScreen('cinematic');
            const txt = document.getElementById('cinematic-text');
            
            await typeWriter(txt, t.cinematicWho, 80);
            await new Promise(r => setTimeout(r, 1000));
            
            txt.innerText = "";
            txt.className = "text-5xl md:text-7xl font-mono text-rose-500 typewriter-cursor font-black tracking-tight drop-shadow-[0_0_20px_rgba(244,63,94,0.8)]";
            await typeWriter(txt, t.cinematicImposter, 150);
            await new Promise(r => setTimeout(r, 2000));
            
            txt.className = "text-5xl md:text-6xl font-mono text-emerald-400 typewriter-cursor font-bold tracking-tight drop-shadow-[0_0_15px_rgba(52,211,153,0.8)]";
            prepareCurtainTurn();
        }

        function typeWriter(element, text, speed) {
            return new Promise(resolve => {
                let i = 0; element.innerText = "";
                function type() {
                    if (i < text.length) { element.innerText += text.charAt(i); i++; setTimeout(type, speed); }
                    else resolve();
                }
                type();
            });
        }

        // --- Curtain Mechanics ---
        const curtainLayer = document.getElementById('curtain-layer');
        const curtainContent = document.getElementById('curtain-content');
        const nextBtn = document.getElementById('curtain-next-btn');
        const instruction = document.getElementById('curtain-instruction');
        
        let startY = 0; let currentY = 0; let isDragging = false; let hasSeen = false;

        function prepareCurtainTurn() {
            document.getElementById('curtain-player-name').innerText = playerNames[turnIndex];
            const isImposter = (turnIndex === imposterIndex);
            const roleDisplay = document.getElementById('role-display');
            const t = TRANSLATIONS[currentLang];

            if (isImposter) {
                roleDisplay.innerText = t.roleImposter;
                roleDisplay.className = "text-6xl md:text-8xl font-black text-center text-transparent bg-clip-text bg-gradient-to-b from-red-500 to-rose-700 drop-shadow-[0_10px_20px_rgba(225,29,72,0.5)] animate-pulse";
            } else {
                roleDisplay.innerText = currentWord;
                roleDisplay.className = "text-5xl md:text-7xl font-black text-center text-transparent bg-clip-text bg-gradient-to-b from-emerald-300 to-teal-500 drop-shadow-[0_10px_20px_rgba(16,185,129,0.3)]";
            }

            nextBtn.classList.add('hidden');
            instruction.classList.remove('hidden');
            hasSeen = false;
            curtainLayer.style.transform = 'translateY(0)';
            curtainLayer.style.transition = 'none';
            showScreen('curtain');
        }

        curtainLayer.addEventListener('touchstart', dragStart);
        curtainLayer.addEventListener('touchmove', dragMove);
        curtainLayer.addEventListener('touchend', dragEnd);
        curtainLayer.addEventListener('mousedown', dragStart);
        window.addEventListener('mousemove', dragMove);
        window.addEventListener('mouseup', dragEnd);

        function dragStart(e) {
            isDragging = true;
            startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            curtainLayer.style.transition = 'none'; 
        }
        function dragMove(e) {
            if (!isDragging) return;
            const y = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
            const delta = y - startY;
            if (delta < 0) {
                currentY = delta;
                curtainLayer.style.transform = `translateY(${currentY}px)`;
                curtainContent.style.opacity = Math.max(0, 1 + (currentY / 300));
                if (Math.abs(currentY) > window.innerHeight * 0.4) hasSeen = true;
            }
        }
        function dragEnd() {
            if (!isDragging) return;
            isDragging = false;
            curtainLayer.style.transition = 'transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            curtainLayer.style.transform = 'translateY(0)';
            setTimeout(() => { curtainContent.style.opacity = 1; }, 100);
            if (hasSeen) { setTimeout(() => { instruction.classList.add('hidden'); nextBtn.classList.remove('hidden'); }, 300); }
        }

        function finishTurn() {
            turnIndex++;
            if (turnIndex < selectedPlayerCount) prepareCurtainTurn();
            else showScreen('discuss');
        }

        function resetGame() {
            playerNames = []; selectedPlayerCount = 0; currentPlayerIndex = 0; imposterIndex = -1; turnIndex = 0; hasSeen = false;
            renderPlayerButtons();
            
            const selNextBtn = document.getElementById('selection-start-btn');
            selNextBtn.disabled = true;
            selNextBtn.classList.add('bg-white/5', 'text-white/30', 'cursor-not-allowed');
            selNextBtn.classList.remove('bg-gradient-to-r');

            document.getElementById('name-input-field').value = "";
            nextBtn.classList.add('hidden');
            instruction.classList.remove('hidden');
            curtainContent.style.opacity = 1;
            
            showScreen('main');
            langToggle.classList.remove('hidden-screen');

            const startBtn = document.getElementById('main-start-btn');
            startBtn.classList.remove('btn-anim');
            void startBtn.offsetWidth; 
            startBtn.classList.add('btn-anim');
        }
    </script>
</body>
</html>

