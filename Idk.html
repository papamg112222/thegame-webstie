<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tee Noi Hotpot Runner 3D</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin:0; overflow:hidden; background:#000; font-family:sans-serif; }
  #score { position:absolute; top:20px; left:20px; color:#FF4500; font-size:30px; z-index:100; text-shadow:0 0 10px #000; display:none; }
  #gameover { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#fff; font-size:50px; background:rgba(0,0,0,0.8); padding:30px; border-radius:20px; display:none; text-align:center; z-index:200; }
  button { margin-top:20px; padding:15px 30px; font-size:20px; background:#FF4500; color:white; border:none; border-radius:10px; cursor:pointer; }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<div id="gameover">
  <h1>STUFFED!</h1>
  <p id="final">Score: 0</p>
  <button onclick="location.reload()">Play Again</button>
</div>

<!-- FIXED VERSION – uses working Three.js r128 (last version with old controls path) -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.js"></script>

<script>
// === TEE NOI HOTPOT RUNNER 3D === (now 100% working)
let camera, scene, renderer, controls;
let move = { forward:false, backward:false, left:false, right:false };
let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();
let score = 0;
let ingredients = [];
let taxis = [];
let gameOver = false;

init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x000022);
  scene.fog = new THREE.FogExp2(0x000022, 0.0015);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.y = 2;

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const light = new THREE.HemisphereLight(0xffffff, 0x4444ff, 1);
  scene.add(light);

  // Floor
  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(200, 200),
    new THREE.MeshBasicMaterial({color:0x111133})
  );
  floor.rotation.x = -Math.PI/2;
  floor.position.y = -0.5;
  scene.add(floor);

  // Neon signs
  for(let i=0; i<30; i++){
    const sign = new THREE.Mesh(
      new THREE.BoxGeometry(4,2,0.2),
      new THREE.MeshBasicMaterial({color: Math.random()>0.5?0xFF4500:0x00FFFF})
    );
    sign.position.set(Math.random()*180-90, 5, Math.random()*180-90);
    scene.add(sign);
  }

  // Pointer lock controls (now actually loads!)
  controls = new THREE.PointerLockControls(camera, document.body);
  
  document.body.addEventListener('click', () => controls.lock());
  controls.addEventListener('lock', () => document.getElementById('score').style.display = 'block');
  controls.addEventListener('unlock', () => { if(!gameOver) document.getElementById('score').style.display = 'none'; });

  // Keyboard
  document.addEventListener('keydown', e => {
    switch(e.code){
      case 'KeyW': move.forward = true; break;
      case 'KeyS': move.backward = true; break;
      case 'KeyA': move.left = true; break;
      case 'KeyD': move.right = true; break;
      case 'Space': if(velocity.y===0) velocity.y = 8; break;
    }
  });
  document.addEventListener('keyup', e => {
    switch(e.code){
      case 'KeyW': move.forward = false; break;
      case 'KeyS': move.backward = false; break;
      case 'KeyA': move.left = false; break;
      case 'KeyD': move.right = false; break;
    }
  });

  // Spawn ingredients
  setInterval(() => {
    if(gameOver) return;
    const type = ['pork','squid','egg','cheese','veggie'][Math.floor(Math.random()*5)];
    const ing = new THREE.Mesh(
      new THREE.SphereGeometry(1,16,16),
      new THREE.MeshBasicMaterial({color:0xffff00})
    );
    ing.position.set(Math.random()*160-80, 2, Math.random()*160-80);
    ing.userData = {type, points:type==='cheese'?50:20};
    scene.add(ing);
    ingredients.push(ing);
  }, 1200);

  // Spawn taxis
  setInterval(() => {
    if(gameOver) return;
    const taxi = new THREE.Mesh(
      new THREE.BoxGeometry(4,2,8),
      new THREE.MeshBasicMaterial({color:0xffff00})
    );
    taxi.position.set(Math.random()*160-80, 1, -100);
    scene.add(taxi);
    taxis.push(taxi);
  }, 3000);

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
}

function animate() {
  requestAnimationFrame(animate);
  if(!controls.isLocked || gameOver) { renderer.render(scene, camera); return; }

  // Movement
  velocity.x *= 0.9;
  velocity.z *= 0.9;
  direction.z = Number(move.forward) - Number(move.backward);
  direction.x = Number(move.right) - Number(move.left);
  direction.normalize();
  if(move.forward || move.backward) velocity.z -= direction.z * 0.8;
  if(move.left || move.right) velocity.x -= direction.x * 0.8;
  controls.moveRight(-velocity.x);
  controls.moveForward(-velocity.z);

  // Gravity & jump
  velocity.y -= 0.25;
  camera.position.y += velocity.y * 0.05;
  if(camera.position.y < 2){ camera.position.y = 2; velocity.y = 0; }

  // Collect ingredients
  for(let i=ingredients.length-1; i>=0; i--){
    const ing = ingredients[i];
    ing.rotation.y += 0.02;
    if(camera.position.distanceTo(ing.position) < 2){
      score += ing.userData.points;
      document.getElementById('score').innerText = `Score: ${score}`;
      scene.remove(ing);
      ingredients.splice(i,1);
      if(score >= 999){
        alert('CHEESE VOLCANO UNLOCKED!!! YOU WIN BKK TONIGHT!');
        gameOver = true;
      }
    }
  }

  // Taxis
  taxis.forEach((taxi, i) => {
    taxi.position.z += 1.5;
    taxi.rotation.y = Math.PI;
    if(camera.position.distanceTo(taxi.position) < 3){
      gameOver = true;
      document.getElementById('gameover').style.display = 'block';
      document.getElementById('final').innerText = `Final Score: ${score}`;
      controls.unlock();
    }
    if(taxi.position.z > 100){ scene.remove(taxi); taxis.splice(i,1); }
  });

  renderer.render(scene, camera);
}
</script>

<h2 style="position:absolute; bottom:20px; left:20px; color:#FF4500; z-index:99;">
  Click screen → WASD + Mouse → Collect food, dodge taxis!<br>
  999 points = CHEESE VOLCANO
</h2>
</body>
</html>
