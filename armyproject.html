<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Army Website</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc, getDoc, collection, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        window.Firebase = {
            initializeApp,
            getAuth,
            signInAnonymously,
            signInWithCustomToken,
            onAuthStateChanged,
            getFirestore,
            doc,
            onSnapshot,
            setDoc,
            updateDoc,
            getDoc,
            collection,
            increment
        };
    </script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
      body { font-family: 'Inter', sans-serif; }
      
      /* Base Animations */
      .animate-blob { animation: blob 7s infinite; }
      .animation-delay-2000 { animation-delay: 2s; }
      .animation-delay-4000 { animation-delay: 4s; }
      
      @keyframes blob {
        0% { transform: translate(0px, 0px) scale(1); }
        33% { transform: translate(30px, -50px) scale(1.1); }
        66% { transform: translate(-20px, 20px) scale(0.9); }
        100% { transform: translate(0px, 0px) scale(1); }
      }

      @keyframes slideUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }

      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
      }
      .animate-shake { animation: shake 0.4s ease-in-out; }

      @keyframes slideRightInfinite {
        0% { transform: translateX(-50%); }
        100% { transform: translateX(0%); }
      }
      .animate-slide-right-infinite {
        animation: slideRightInfinite 60s linear infinite;
        width: 200%;
        display: flex;
        will-change: transform;
      }

      /* Counter Animations - Pure Falling Effect */
      @keyframes slideDownEnter {
          from { transform: translateY(-100%); }
          to { transform: translateY(0); }
      }
      @keyframes slideDownExit {
          from { transform: translateY(0); }
          to { transform: translateY(100%); }
      }

      /* The duration is now dynamic via inline styles */
      .counter-enter { animation-name: slideDownEnter; animation-fill-mode: forwards; animation-timing-function: linear; }
      .counter-exit { animation-name: slideDownExit; animation-fill-mode: forwards; animation-timing-function: linear; }

      /* --- FUN HOVER ANIMATIONS --- */
      
      /* 1. Bear Bounce */
      @keyframes popBounce {
        0% { transform: translateY(100%) scale(0.5); opacity: 0; }
        50% { transform: translateY(-20px) scale(1.1); opacity: 1; }
        70% { transform: translateY(0px) scale(0.9); opacity: 1; }
        100% { transform: translateY(-10px) scale(1); opacity: 1; }
      }
      .group:hover .anim-bear { animation: popBounce 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }

      /* 2. Fox Wiggle */
      @keyframes popWiggle {
        0% { transform: translateY(100%) rotate(0deg); opacity: 0; }
        40% { transform: translateY(-15px) rotate(-10deg); opacity: 1; }
        60% { transform: translateY(-15px) rotate(10deg); }
        80% { transform: translateY(-15px) rotate(-5deg); }
        100% { transform: translateY(-15px) rotate(0deg); opacity: 1; }
      }
      .group:hover .anim-fox { animation: popWiggle 0.7s ease-out forwards; }

      /* 3. Bunny Hop */
      @keyframes popHop {
        0% { transform: translateY(100%); opacity: 0; }
        30% { transform: translateY(-30px) scaleX(0.8) scaleY(1.1); opacity: 1; }
        60% { transform: translateY(0) scaleX(1.1) scaleY(0.9); }
        80% { transform: translateY(-10px) scaleX(0.95) scaleY(1.05); }
        100% { transform: translateY(0) scale(1); opacity: 1; }
      }
      .group:hover .anim-bunny { animation: popHop 0.6s ease-in-out forwards; }

      /* 4. Panda Peek */
      @keyframes popPeek {
        0% { transform: translateY(100%) translateX(-20px) rotate(-20deg); opacity: 0; }
        100% { transform: translateY(-10px) translateX(0) rotate(10deg); opacity: 1; }
      }
      .group:hover .anim-panda { animation: popPeek 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards; }

      /* Hide scrollbar for clean look */
      .no-scrollbar::-webkit-scrollbar {
          display: none;
      }
      .no-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Initialize Firebase services from window object (loaded in module script)
        const initFirebase = () => {
            if (!window.Firebase) return null;
            
            let firebaseConfig;
            
            // Check if config exists in environment (Canvas mode)
            if (typeof __firebase_config !== 'undefined') {
                try {
                    firebaseConfig = JSON.parse(__firebase_config);
                } catch (e) {
                    console.error("Error parsing automatic config", e);
                }
            } 
            
            // --- PASTE YOUR FIREBASE CONFIG BELOW FOR GITHUB PAGES ---
            // 1. Go to console.firebase.google.com
            // 2. Create a project -> Add Web App -> Copy the config object
            // 3. Paste it here to replace the null:
            
            if (!firebaseConfig) {
                 // UNCOMMENT THIS AND PASTE YOUR KEYS INSIDE:
                 /*
                 firebaseConfig = {
                    apiKey: "AIzaSy...",
                    authDomain: "your-project.firebaseapp.com",
                    projectId: "your-project-id",
                    storageBucket: "your-project.appspot.com",
                    messagingSenderId: "123456...",
                    appId: "1:12345:web:..."
                 };
                 */
                
                // If still no config, return null (App runs in offline/demo mode)
                if (!firebaseConfig) {
                    console.warn("Firebase configuration missing. Running in Offline Mode.");
                    // We return null here, but we'll handle the UI update in the App component
                }
            }

            try {
                // If we have a config, initialize it
                if (firebaseConfig) {
                    const app = window.Firebase.initializeApp(firebaseConfig);
                    const auth = window.Firebase.getAuth(app);
                    const db = window.Firebase.getFirestore(app);
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                    return { auth, db, appId, ...window.Firebase, isOnline: true };
                }
            } catch (e) {
                console.error("Firebase initialization failed:", e);
            }
            return { isOnline: false }; // Offline mode
        };

        const fb = initFirebase();

        // --- ICONS ---
        const HomeIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        );
        const UserIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        );
        const MailIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
        );
        const SparklesIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>
        );
        const QrCodeIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="5" height="5" x="3" y="3" rx="1"/><rect width="5" height="5" x="16" y="3" rx="1"/><rect width="5" height="5" x="3" y="16" rx="1"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21v.01"/><path d="M12 7v3a2 2 0 0 1-2 2H7"/><path d="M3 12h.01"/><path d="M12 3h.01"/><path d="M12 16v.01"/><path d="M16 12h1"/><path d="M21 12v.01"/><path d="M12 21v-1"/></svg>
        );
        const ExternalLinkIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>
        );
        const LockIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        );
        const SettingsIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        );
        const TestIcon = ({ size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 3v12"/><path d="M18 3v12"/><path d="M6 15h12"/><path d="M6 15l6 6 6-6"/></svg>
        );
        const ScissorsIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" x2="8.12" y1="4" y2="15.88"/><line x1="14.47" x2="20" y1="14.48" y2="20"/><line x1="8.12" x2="12" y1="8.12" y2="12"/></svg>
        );
        const EditIcon = ({ size = 24, className = "" }) => (
             <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
        );
        const BackpackIcon = ({ size = 32, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M4 10a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z"/><path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/><path d="M8 21v-5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v5"/><path d="M8 10h8"/><path d="M8 18h8"/></svg>
        );
        const InstagramIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg>
        );
        const LineIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" className={className}>
                 <path d="M22.2 11.8c0-5-4.7-9.1-10.4-9.1C6.1 2.7 1.4 6.8 1.4 11.8c0 4.6 3.7 8.5 8.7 9 .4 0 1 .1 1.2.4l-.5 2c-.1.5 0 .9.4 1 .2 0 .4-.1.6-.2l5.8-5.3c3.4-1.6 4.6-3.8 4.6-6.9z"/>
            </svg>
        );
        const FacebookIcon = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
        );

        // --- UTILS ---
        const removeBackgroundSmart = async (base64Image) => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = "Anonymous";
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    if (!ctx) {
                        resolve(base64Image);
                        return;
                    }
                    ctx.drawImage(img, 0, 0);
                    try {
                        const frame = ctx.getImageData(0, 0, img.width, img.height);
                        const data = frame.data;
                        const r0 = data[0], g0 = data[1], b0 = data[2];
                        const tolerance = 40; 
                        for(let i = 0; i < data.length; i += 4) {
                            const r = data[i];
                            const g = data[i+1];
                            const b = data[i+2];
                            if (Math.abs(r - r0) < tolerance && Math.abs(g - g0) < tolerance && Math.abs(b - b0) < tolerance) {
                                data[i+3] = 0;
                            }
                        }
                        ctx.putImageData(frame, 0, 0);
                        resolve(canvas.toDataURL());
                    } catch (err) {
                        console.error("Canvas manipulation error:", err);
                        resolve(base64Image); 
                    }
                };
                img.onerror = () => reject(new Error("Failed to load image"));
                img.src = base64Image;
            });
        };

        // NEW: Compress Image Utility for Firestore 1MB Limit
        const compressImage = (base64Str, maxWidth = 1024, quality = 0.6) => {
            return new Promise((resolve) => {
                // If it's already a short string (e.g. empty or tiny), just return it
                if (!base64Str || base64Str.length < 1000) return resolve(base64Str);

                const img = new Image();
                img.src = base64Str;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    resolve(canvas.toDataURL('image/jpeg', quality));
                };
                img.onerror = () => resolve(base64Str); 
            });
        };

        // --- COMPONENTS ---

        // A single digit that slides down. Speed is dynamic.
        const SlidingDigit = ({ digit, speed = 500 }) => {
            const [display, setDisplay] = useState({ current: digit, prev: null });
            
            useEffect(() => {
                if (digit !== display.current) {
                    setDisplay({ current: digit, prev: display.current });
                    const timer = setTimeout(() => {
                        setDisplay({ current: digit, prev: null });
                    }, speed); 
                    return () => clearTimeout(timer);
                }
            }, [digit, speed]);

            return (
                <div className="relative h-6 w-3 overflow-hidden inline-block align-middle mx-[1px]">
                    {/* Previous Number (Slides down out of view) */}
                    {display.prev !== null && (
                        <div 
                            className="absolute inset-0 flex items-center justify-center font-mono font-bold text-zinc-600 counter-exit"
                            style={{ animationDuration: `${speed}ms` }}
                        >
                            {display.prev}
                        </div>
                    )}
                    {/* Current Number (Slides down into view) */}
                    <div 
                        className={`absolute inset-0 flex items-center justify-center font-mono font-bold text-zinc-600 ${display.prev !== null ? 'counter-enter' : ''}`}
                        style={{ animationDuration: `${speed}ms` }}
                    >
                        {display.current}
                    </div>
                </div>
            );
        };

        // Counter that orchestrates the "Falling" effect (Slow -> Fast -> Slow)
        const SlidingCounter = ({ count, isTestMode }) => {
            const [displayValue, setDisplayValue] = useState(0);
            const [speed, setSpeed] = useState(500);
            
            const timerRef = useRef(null);
            const currentValRef = useRef(0);

            useEffect(() => {
                // In Test Mode, we bypass the fancy easing logic and just update fast
                if (isTestMode) {
                    setDisplayValue(count);
                    setSpeed(50); // Very fast for infinite fall
                    return;
                }

                const target = count;
                
                // If we are already there, stop
                if (currentValRef.current === target) return;

                const startValue = currentValRef.current;
                const diff = target - startValue;

                // Stop any previous loop
                if (timerRef.current) clearTimeout(timerRef.current);

                const loop = () => {
                    const current = currentValRef.current;
                    const remaining = target - current;

                    if (remaining <= 0) {
                        // Done
                        setDisplayValue(target);
                        currentValRef.current = target;
                        setSpeed(500);
                        return;
                    }

                    let nextSpeed = 100;
                    let nextStep = 1;

                    const distanceTraveled = current - startValue;
                    
                    // START PHASE (First 10 counts)
                    if (distanceTraveled < 10) {
                        nextSpeed = 100; 
                        nextStep = 1;
                    } 
                    // END PHASE (Last 50 counts)
                    else if (remaining < 50) {
                        // Decelerate
                        const progress = (50 - remaining) / 50; 
                        nextSpeed = 20 + (progress * 300); 
                        
                        if (remaining < 10) nextStep = 1;
                        else nextStep = Math.ceil(remaining / 10); 
                    } 
                    // MIDDLE PHASE (Fast Falling)
                    else {
                        nextSpeed = 20; 
                        nextStep = Math.max(1, Math.ceil(remaining / 50)); 
                    }

                    setSpeed(nextSpeed);
                    
                    const nextVal = current + nextStep;
                    // Don't overshoot
                    const finalVal = nextVal > target ? target : nextVal;
                    
                    setDisplayValue(finalVal);
                    currentValRef.current = finalVal;

                    timerRef.current = setTimeout(loop, nextSpeed);
                };

                loop();

                return () => clearTimeout(timerRef.current);
            }, [count, isTestMode]);

            const digits = displayValue.toString().split('');

            return (
                <div className="flex items-center">
                    {digits.map((d, i) => (
                        <SlidingDigit key={i} digit={d} speed={speed} />
                    ))}
                </div>
            );
        };

        const Navigation = ({ activeTab, onTabChange, isVisible }) => {
            const navItems = [
                { id: 'HOME', label: 'Home', icon: HomeIcon },
                { id: 'ABOUT', label: 'About', icon: UserIcon },
                { id: 'CONTACT', label: 'Contact', icon: MailIcon },
            ];

            return (
                <div className={`transition-all duration-1000 ease-out transform ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10'} flex justify-center w-full mt-6`}>
                    <div className="flex space-x-2 bg-white/70 backdrop-blur-xl border border-zinc-200 p-2 rounded-full shadow-xl shadow-indigo-100/50">
                        {navItems.map((item) => {
                        const Icon = item.icon;
                        const isActive = activeTab === item.id;
                        return (
                            <button key={item.id} onClick={() => onTabChange(item.id)} className={`relative px-6 py-2 rounded-full text-sm font-medium transition-all duration-300 flex items-center gap-2 ${isActive ? 'bg-zinc-900 text-white shadow-lg scale-105' : 'text-zinc-500 hover:text-zinc-900 hover:bg-white'}`}>
                                <Icon size={16} /><span>{item.label}</span>
                            </button>
                        );
                        })}
                    </div>
                </div>
            );
        };

        const ContactCard = () => {
            return (
                <div className="w-full max-w-md mx-auto animate-slide-up mt-12 pb-12">
                    <div className="bg-white/80 border border-zinc-200 rounded-2xl p-8 backdrop-blur-lg shadow-2xl shadow-zinc-200/50">
                        <h2 className="text-2xl font-bold text-zinc-900 mb-6 flex items-center gap-2">
                        <span className="bg-zinc-100 p-2 rounded-lg text-zinc-900"><UserIcon size={20} /></span>
                        Contact Information
                        </h2>
                        <div className="space-y-6">
                            <div className="group">
                                <label className="text-xs font-bold text-zinc-400 uppercase tracking-wider mb-1 block">Name</label>
                                <div className="text-lg text-zinc-800 font-semibold group-hover:text-zinc-950 transition-colors">T.Aphilak Kapangnoy</div>
                            </div>
                            <div className="group">
                                <label className="text-xs font-bold text-zinc-400 uppercase tracking-wider mb-1 block">Email</label>
                                <a href="mailto:arm.rst2542@gmail.com" className="flex items-center gap-2 text-lg text-zinc-700 font-medium hover:text-blue-600 transition-colors">
                                <MailIcon size={18} />arm.rst2542@gmail.com
                                </a>
                            </div>
                            <div className="h-px bg-zinc-100 my-6"></div>
                            <div className="space-y-3">
                                <label className="text-xs font-bold text-zinc-400 uppercase tracking-wider block">Instant Messaging</label>
                                <div className="bg-slate-50 rounded-xl p-4 border border-zinc-100 flex flex-col items-center text-center space-y-4">
                                    <div className="bg-white p-2 rounded-lg border border-zinc-100 shadow-sm"><QrCodeIcon size={64} className="text-zinc-900" /></div>
                                    <div className="space-y-1">
                                        <p className="text-zinc-600 text-sm">Line ID: <span className="text-zinc-900 font-mono font-bold">arm42.rst</span></p>
                                        <p className="text-xs text-zinc-400">Scan QR or click below to chat</p>
                                    </div>
                                    <button onClick={() => window.open('https://line.me/ti/p/~arm42.rst', '_blank')} className="w-full bg-[#06C755] hover:bg-[#05b34c] text-white font-bold py-3 px-4 rounded-xl transition-all duration-300 shadow-lg shadow-green-500/20 flex items-center justify-center gap-2 group">
                                        <LineIcon size={20} /><span>Chat on Line</span>
                                    </button>
                                    <button onClick={() => window.open('https://www.instagram.com/_armmeee/', '_blank')} className="w-full bg-gradient-to-r from-[#833AB4] via-[#FD1D1D] to-[#F77737] hover:opacity-90 text-white font-bold py-3 px-4 rounded-xl transition-all duration-300 shadow-lg shadow-pink-500/20 flex items-center justify-center gap-2 group">
                                        <InstagramIcon size={20} /><span>Instagram</span>
                                    </button>
                                    <button onClick={() => window.open('https://www.facebook.com', '_blank')} className="w-full bg-[#1877F2] hover:bg-[#166fe5] text-white font-bold py-3 px-4 rounded-xl transition-all duration-300 shadow-lg shadow-blue-500/20 flex items-center justify-center gap-2 group">
                                        <FacebookIcon size={20} /><span>Facebook</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const HeaderSection = ({ introPhase, activeTab, onTabChange, headerImages, onRequestEdit, onRequestTest, onTestDown, onTestUp, isTestModeUnlocked }) => {
            const isStarted = introPhase !== 'start';
            const validHeaderImages = headerImages.filter(img => img && img.trim().length > 0);
            
            return (
                <div className={`relative w-full overflow-hidden transition-all duration-[2000ms] cubic-bezier(0.16, 1, 0.3, 1) rounded-b-[40px] shadow-sm ${isStarted ? 'h-auto py-12 bg-indigo-50/80 border-b border-indigo-100/50' : 'h-screen flex flex-col justify-center items-center bg-transparent'}`}>
                    {isStarted && validHeaderImages.length > 0 && (
                          <div className="absolute inset-0 flex items-center h-full pointer-events-none z-0">
                            <div className="animate-slide-right-infinite h-full">
                                {validHeaderImages.map((src, i) => (
                                    <div key={'a'+i} className="flex-shrink-0 w-1/4 h-full p-8"><img src={src.startsWith('data:') ? src : `data:image/png;base64,${src}`} className="w-full h-full object-contain drop-shadow-md" /></div>
                                ))}
                                {validHeaderImages.map((src, i) => (
                                    <div key={'b'+i} className="flex-shrink-0 w-1/4 h-full p-8"><img src={src.startsWith('data:') ? src : `data:image/png;base64,${src}`} className="w-full h-full object-contain drop-shadow-md" /></div>
                                ))}
                                {validHeaderImages.length < 4 && validHeaderImages.map((src, i) => (
                                     <div key={'c'+i} className="flex-shrink-0 w-1/4 h-full p-8"><img src={src.startsWith('data:') ? src : `data:image/png;base64,${src}`} className="w-full h-full object-contain drop-shadow-md" /></div>
                                ))}
                            </div>
                            {/* --- THIS LINE IS EDITED FOR BLUR --- */}
                             <div className="absolute inset-0 bg-white/20 backdrop-blur"></div>
                          </div>
                    )}
                    <div className="absolute inset-0 overflow-hidden pointer-events-none z-0">
                        <div className={`absolute top-0 left-1/4 w-64 h-64 bg-yellow-200/40 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob ${!isStarted ? 'scale-150' : ''}`} />
                        <div className={`absolute top-0 right-1/4 w-64 h-64 bg-pink-200/40 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000 ${!isStarted ? 'scale-150' : ''}`} />
                        <div className={`absolute -bottom-8 left-1/2 -translate-x-1/2 w-64 h-64 bg-purple-200/40 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000 ${!isStarted ? 'scale-150' : ''}`} />
                    </div>
                    <div className={`relative z-10 w-full flex flex-col items-center justify-center transition-all duration-[2000ms] ${isStarted ? 'translate-y-0' : 'translate-y-[10vh]'}`}>
                        <div className="flex items-center gap-3">
                            <h1 className={`font-bold text-zinc-900 text-center transition-all duration-[2000ms] cubic-bezier(0.16, 1, 0.3, 1) ${isStarted ? 'text-4xl md:text-5xl tracking-tight' : 'text-5xl md:text-8xl tracking-tighter'}`}>Welcome, to Army Website</h1>
                            {isStarted && (
                                <button onClick={onRequestEdit} className="text-zinc-300 hover:text-zinc-600 transition-colors" title="Edit Background"><SettingsIcon size={20} /></button>
                            )}
                        </div>
                        <Navigation activeTab={activeTab} onTabChange={onTabChange} isVisible={isStarted} />
                    </div>
                </div>
            );
        };

        const App = () => {
            const [introPhase, setIntroPhase] = useState('start');
            const [activeTab, setActiveTab] = useState('HOME');
            const [user, setUser] = useState(null);
            const [isOnline, setIsOnline] = useState(fb?.isOnline || false); // Track connection status
            
            // Visitor States
            const [realVisitorCount, setRealVisitorCount] = useState(0); // From DB
            const [displayVisitorCount, setDisplayVisitorCount] = useState(0); // Shown in UI
            const [isTestModeUnlocked, setIsTestModeUnlocked] = useState(false);
            const testIntervalRef = useRef(null);
            
            // REQ CHANGE: Save on every visit, reset capabilities
            const hasIncrementedRef = useRef(false);

            // Data States
            const [base64Input, setBase64Input] = useState('');
            const [renderedImage, setRenderedImage] = useState(null);
            const [bioText, setBioText] = useState("Welcome to my profile.");
            const [headerImages, setHeaderImages] = useState(Array(4).fill(''));
            const [isEditingHeader, setIsEditingHeader] = useState(false);
            
            // Home Slider
            const [homeImages, setHomeImages] = useState(Array(5).fill(''));
            const [virtualIndex, setVirtualIndex] = useState(0);

            // Home Cards State (m1, m2, m3, m4)
            const DEFAULT_HOME_CARDS = [
                { id: 'm1', title: 'Students', subtitle: 'Explore learning', color: 'bg-[#14919B]', icon: '', toy: 'ðŸ»' },
                { id: 'm2', title: 'Educators', subtitle: 'Teach with us', color: 'bg-[#804FB3]', icon: '', toy: 'ðŸ¦Š' },
                { id: 'm3', title: 'Parents', subtitle: 'Get started at home', color: 'bg-[#F5565B]', icon: '', toy: 'ðŸ°' },
                { id: 'm4', title: 'Districts', subtitle: 'Equip your schools', color: 'bg-[#F2AC29]', icon: '', toy: 'ðŸ¼' }
            ];
            const [homeCards, setHomeCards] = useState(DEFAULT_HOME_CARDS);
            const [isEditingHome, setIsEditingHome] = useState(false);

            // UI States
            const [showReset, setShowReset] = useState(false);
            const [showStyleSelector, setShowStyleSelector] = useState(false);
            const [pendingImage, setPendingImage] = useState(null);
            const [isProcessing, setIsProcessing] = useState(false);
            const [isEditingBio, setIsEditingBio] = useState(false);
            const [showPasswordModal, setShowPasswordModal] = useState(false);
            const [passwordInput, setPasswordInput] = useState('');
            const [passwordError, setPasswordError] = useState(false);
            const [pendingAction, setPendingAction] = useState(null);

            // --- FIREBASE INIT ---
            useEffect(() => {
                if (!fb || !fb.isOnline) return;
                const { auth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } = fb;
                
                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        try { await signInWithCustomToken(auth, __initial_auth_token); } catch(e) { console.error("Token Auth Failed", e); await signInAnonymously(auth); }
                    } else {
                        try { await signInAnonymously(auth); } catch(e) { console.error("Anon Auth Failed", e); }
                    }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, setUser);
                return () => unsubscribe();
            }, []);

            // Helper to save shared data
            const saveSharedData = async (dataToUpdate) => {
                if (fb && fb.isOnline && user) {
                    const { db, appId, doc, setDoc } = fb;
                    const contentRef = doc(db, 'artifacts', appId, 'public', 'data', 'site_content', 'main');
                    try {
                        await setDoc(contentRef, dataToUpdate, { merge: true });
                    } catch (e) {
                        console.error("Error saving to shared storage", e);
                        alert("Failed to save changes globally. The image might be too large (limit 1MB) or there was a network error.");
                    }
                } else {
                    // FALLBACK: Save to local storage if offline so user doesn't lose work immediately
                    if (dataToUpdate.profilePic !== undefined) localStorage.setItem('army_profile_pic', dataToUpdate.profilePic);
                    if (dataToUpdate.bioText !== undefined) localStorage.setItem('army_bio_text', dataToUpdate.bioText);
                    if (dataToUpdate.headerImages !== undefined) localStorage.setItem('army_header_bg', JSON.stringify(dataToUpdate.headerImages));
                    if (dataToUpdate.homeCards !== undefined) localStorage.setItem('army_home_cards', JSON.stringify(dataToUpdate.homeCards));
                    if (dataToUpdate.homeImages !== undefined) localStorage.setItem('army_home_images', JSON.stringify(dataToUpdate.homeImages));
                }
            }

            // --- SHARED DATA LISTENER (Real-time Sync) ---
            useEffect(() => {
                if (fb && fb.isOnline && user) {
                    const { db, appId, doc, onSnapshot } = fb;
                    const contentRef = doc(db, 'artifacts', appId, 'public', 'data', 'site_content', 'main');

                    // THIS IS WHERE THE MAGIC HAPPENS
                    // When Firestore updates, this code runs automatically on every connected device.
                    const unsubscribe = onSnapshot(contentRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            // Immediately update state if profilePic changed in DB
                            if (data.profilePic !== undefined) setRenderedImage(data.profilePic);
                            if (data.bioText !== undefined) setBioText(data.bioText);
                            if (data.homeCards !== undefined) setHomeCards(data.homeCards);
                            if (data.homeImages !== undefined) setHomeImages(data.homeImages);
                            if (data.headerImages !== undefined) setHeaderImages(data.headerImages);
                        } else {
                            // BOOTSTRAP: Cloud document doesn't exist yet, but we have local data?
                            // Let's try to upload initial data from local storage if we have it
                            const savedBio = localStorage.getItem('army_bio_text');
                            const savedImage = localStorage.getItem('army_profile_pic');
                            const savedHeader = localStorage.getItem('army_header_bg');
                            
                            if (savedBio || savedImage || savedHeader) {
                                console.log("Bootstrapping cloud data from local storage...");
                                const initialData = {};
                                if (savedBio) initialData.bioText = savedBio;
                                if (savedImage) initialData.profilePic = savedImage;
                                if (savedHeader) {
                                    try { initialData.headerImages = JSON.parse(savedHeader); } catch(e) {}
                                }
                                saveSharedData(initialData);
                            }
                        }
                    }, (err) => console.error("Sync error", err));
                    
                    return () => unsubscribe();
                } else {
                    // Fallback to local storage if offline
                    const savedImage = localStorage.getItem('army_profile_pic');
                    if (savedImage) setRenderedImage(savedImage);
                    const savedCards = localStorage.getItem('army_home_cards');
                    if (savedCards) setHomeCards(JSON.parse(savedCards));
                    const savedSlider = localStorage.getItem('army_home_images');
                    if (savedSlider) setHomeImages(JSON.parse(savedSlider));
                    const savedBio = localStorage.getItem('army_bio_text');
                    if (savedBio) setBioText(savedBio);
                    const savedHeader = localStorage.getItem('army_header_bg');
                    if (savedHeader) setHeaderImages(JSON.parse(savedHeader));
                }
            }, [user]);

            // --- VISITOR COUNT LOGIC ---
            useEffect(() => {
                if (fb && fb.isOnline && user) {
                    const { db, appId, doc, onSnapshot, updateDoc, setDoc, increment } = fb;
                    const statsRef = doc(db, 'artifacts', appId, 'public', 'data', 'site_stats', 'visitors');
                    
                    // 1. Listen for real-time updates from DB
                    const unsubscribe = onSnapshot(statsRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const val = docSnap.data().count || 0;
                            setRealVisitorCount(val);
                        }
                    }, (err) => console.error(err));
                    
                    // 2. Increment logic: "Save everytime someone come in"
                    if (!hasIncrementedRef.current) {
                         hasIncrementedRef.current = true;
                         updateDoc(statsRef, { count: increment(1) }).catch(async (e) => {
                             // If doc doesn't exist, start at 1
                             if (e.code === 'not-found') await setDoc(statsRef, { count: 1 });
                         });
                    }
                    return () => unsubscribe();
                } else {
                    // Offline fallback
                    try {
                        const saved = localStorage.getItem('site_visits_offline');
                        let count = 100; 
                        if (saved) {
                            const parsed = parseInt(saved, 10);
                            if (!isNaN(parsed)) count = parsed;
                        }
                        if (!hasIncrementedRef.current) {
                            hasIncrementedRef.current = true;
                            count++;
                            localStorage.setItem('site_visits_offline', count.toString());
                            setRealVisitorCount(count);
                        }
                    } catch (e) {
                        setRealVisitorCount(100);
                    }
                }
            }, [user]);

            // Sync Real Count to Display Count (when not testing)
            useEffect(() => {
                if (!testIntervalRef.current) {
                    setDisplayVisitorCount(realVisitorCount);
                }
            }, [realVisitorCount]);

            useEffect(() => {
                const timer1 = setTimeout(() => setIntroPhase('transition'), 100); 
                const timer2 = setTimeout(() => setIntroPhase('finished'), 2100);
                return () => { clearTimeout(timer1); clearTimeout(timer2); };
            }, []);

            // Slider Interval
            useEffect(() => {
                const validImages = homeImages.filter(img => img && img.trim().length > 0);
                if (activeTab === 'HOME' && !isEditingHome && validImages.length > 1) {
                    const timer = setInterval(() => { setVirtualIndex(prev => prev + 1); }, 3000);
                    return () => clearInterval(timer);
                }
            }, [activeTab, isEditingHome, homeImages]);

            // --- TEST BUTTON HANDLERS ---
            
            // 1. Click logic (Handle unlock vs start falling)
            const handleTestButtonPress = () => {
                // If not unlocked yet, ask for code
                if (!isTestModeUnlocked) {
                    requestAction('UNLOCK_TEST');
                    return;
                }
                
                // If unlocked, holding starts the fall (this is also triggered by mouse down)
                if (testIntervalRef.current) return;
                
                // Chaotic random numbers for "falling" effect
                testIntervalRef.current = setInterval(() => {
                    // Random number between 1000 and 9999 ensures all 4 digits move
                    // adjusting based on typical visitor count length might be better, but fixed large range ensures movement.
                    setDisplayVisitorCount(Math.floor(Math.random() * 10000)); 
                }, 50);
            };

            // 2. Release logic (Stop falling)
            const handleTestButtonRelease = () => {
                if (!isTestModeUnlocked) return; // Ignore if just clicking to unlock

                if (testIntervalRef.current) {
                    clearInterval(testIntervalRef.current);
                    testIntervalRef.current = null;
                }
                // Stop falling, reset to real count. 
                // DO NOT lock it again.
                setDisplayVisitorCount(realVisitorCount);
            };

            const handleImageInput = () => {
                if (!base64Input.trim()) return;
                let finalSrc = base64Input.trim();
                if (!finalSrc.startsWith('data:')) finalSrc = `data:image/png;base64,${finalSrc}`;
                setPendingImage(finalSrc);
                setShowStyleSelector(true);
            };

            const processImage = async (mode) => {
                if (!pendingImage) return;
                let finalImage = pendingImage;
                
                setIsProcessing(true);
                try {
                    // 1. If Cut mode, remove BG first
                    if (mode === 'CUT') {
                        const processed = await removeBackgroundSmart(pendingImage);
                        finalImage = processed;
                    }
                    
                    // 2. Compress the result before saving to DB
                    finalImage = await compressImage(finalImage);
                    
                } catch (e) {
                    alert("Error processing image");
                } finally {
                    setIsProcessing(false);
                }
                
                // 3. Update State & Database
                setRenderedImage(finalImage);
                saveSharedData({ profilePic: finalImage });
                
                finalizeImageProcess();
            };

            const finalizeImageProcess = () => {
                setShowStyleSelector(false);
                setPendingImage(null);
                setShowReset(false);
                setBase64Input(''); 
            };

            const requestAction = (action) => {
                setPendingAction(action);
                setShowPasswordModal(true);
            };

            const confirmPassword = (e) => {
                e.preventDefault();
                if (passwordInput === '1090') {
                    if (pendingAction === 'RESET_PROFILE') {
                        setRenderedImage(null);
                        saveSharedData({ profilePic: '' });
                        setShowReset(false);
                    } else if (pendingAction === 'EDIT_HOME') {
                        setIsEditingHome(true);
                    } else if (pendingAction === 'EDIT_BIO') {
                        setIsEditingBio(true);
                    } else if (pendingAction === 'EDIT_HEADER') {
                        setIsEditingHeader(true);
                    } else if (pendingAction === 'UNLOCK_TEST') {
                        setIsTestModeUnlocked(true);
                    } else if (pendingAction === 'RESET_VISITORS') {
                        // NEW LOGIC: Reset visitor count to 0 in Firebase
                        if (fb && fb.isOnline) {
                            const { db, appId, doc, setDoc } = fb;
                            const statsRef = doc(db, 'artifacts', appId, 'public', 'data', 'site_stats', 'visitors');
                            setDoc(statsRef, { count: 0 }).catch(err => console.error("Reset failed", err));
                            setRealVisitorCount(0); // Update local state immediately
                        } else {
                            localStorage.setItem('site_visits_offline', '0');
                            setRealVisitorCount(0);
                        }
                    }
                    setShowPasswordModal(false);
                    setPasswordInput('');
                    setPasswordError(false);
                    setPendingAction(null);
                } else {
                    setPasswordError(true);
                    setTimeout(() => setPasswordError(false), 500); 
                }
            };

            const saveBio = () => {
                saveSharedData({ bioText });
                setIsEditingBio(false);
            };
            
            const saveHomeContent = () => {
                saveSharedData({ homeCards, homeImages });
                setIsEditingHome(false);
                setVirtualIndex(0);
            };

            const saveHeaderImages = async () => {
                setIsProcessing(true);
                try {
                    const processedImages = await Promise.all(headerImages.map(async (img) => {
                        if (!img || img.trim().length === 0) return '';
                        let src = img.trim();
                        if (!src.startsWith('data:')) src = `data:image/png;base64,${src}`;
                        
                        // Remove BG first
                        let processed = await removeBackgroundSmart(src);
                        // Then compress to ensure it fits in DB
                        return await compressImage(processed);
                    }));
                    
                    setHeaderImages(processedImages);
                    saveSharedData({ headerImages: processedImages });
                    
                    setIsEditingHeader(false);
                } catch (err) {
                    console.error("Error processing header images", err);
                    alert("There was an error processing the backgrounds. Saving originals.");
                    
                    saveSharedData({ headerImages });
                    
                    setIsEditingHeader(false);
                } finally {
                    setIsProcessing(false);
                }
            };

            const renderContent = () => {
                if (isEditingHeader) {
                    return (
                        <div className="animate-slide-up max-w-4xl mx-auto space-y-6 mt-8 pb-12">
                            <div className="text-center mb-8">
                                <h3 className="text-xl font-bold text-zinc-900">Header Background</h3>
                                <p className="text-zinc-500 text-sm">Paste 4 Base64 strings. <span className="text-indigo-600 font-bold">White backgrounds will be auto-removed on save.</span></p>
                            </div>
                            {isProcessing ? (
                                <div className="flex flex-col items-center justify-center py-12">
                                    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-zinc-900 mb-4"></div>
                                    <p className="text-sm text-zinc-500">Processing images...</p>
                                </div>
                            ) : (
                                <>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {headerImages.map((img, index) => (
                                        <div key={index} className="space-y-2">
                                            <label className="text-xs font-bold text-zinc-400">BG Image {index + 1}</label>
                                            <textarea value={img} onChange={(e) => {
                                                const newImages = [...headerImages];
                                                newImages[index] = e.target.value;
                                                setHeaderImages(newImages);
                                            }} className="w-full h-20 p-2 text-[10px] font-mono border rounded-lg bg-white resize-none outline-none focus:ring-2 focus:ring-zinc-200" placeholder="Base64 string..." />
                                        </div>
                                        ))}
                                    </div>
                                    <div className="flex justify-center pt-4 gap-2">
                                        <button onClick={() => setIsEditingHeader(false)} className="px-8 py-3 bg-zinc-100 text-zinc-600 rounded-full font-bold">Cancel</button>
                                        <button onClick={saveHeaderImages} className="px-8 py-3 bg-zinc-900 text-white rounded-full font-bold shadow-lg hover:scale-105 transition-transform">Save & Auto-Process</button>
                                    </div>
                                </>
                            )}
                        </div>
                    );
                }

                if (activeTab === 'HOME') {
                    if (isEditingHome) {
                        return (
                            <div className="animate-slide-up max-w-6xl mx-auto space-y-8 mt-8 pb-12">
                                <div className="text-center">
                                    <h3 className="text-xl font-bold text-zinc-900">Edit Home Content</h3>
                                    <p className="text-zinc-500 text-sm">Configure both the 3D Slider and the Cards below.</p>
                                </div>

                                {/* Slider Editor */}
                                <div className="bg-white p-6 rounded-2xl border border-zinc-200 shadow-sm">
                                    <h4 className="font-bold text-zinc-700 mb-4">3D Slider Images (5)</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                                        {homeImages.map((img, index) => (
                                            <div key={index} className="space-y-1">
                                                <label className="text-[10px] font-bold text-zinc-400">Slide {index+1}</label>
                                                <textarea 
                                                    value={img} 
                                                    onChange={(e) => {
                                                        const newImages = [...homeImages];
                                                        newImages[index] = e.target.value;
                                                        setHomeImages(newImages);
                                                    }}
                                                    className="w-full h-16 p-2 text-[10px] font-mono border rounded bg-zinc-50 resize-none focus:ring-1 focus:ring-zinc-400 outline-none"
                                                    placeholder="Base64..."
                                                />
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Cards Editor */}
                                <div className="bg-white p-6 rounded-2xl border border-zinc-200 shadow-sm">
                                    <h4 className="font-bold text-zinc-700 mb-4">Bottom Cards (m1 - m4)</h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        {homeCards.map((card, index) => (
                                            <div key={card.id} className="p-3 rounded-xl border border-zinc-100 bg-zinc-50 space-y-2">
                                                <div className="font-bold text-zinc-400 text-xs uppercase">Card {index+1} ({card.toy})</div>
                                                <input type="text" placeholder="Title" value={card.title} onChange={(e) => {
                                                    const newCards = [...homeCards]; newCards[index].title = e.target.value; setHomeCards(newCards);
                                                }} className="w-full p-2 text-xs border rounded" />
                                                <input type="text" placeholder="Subtitle" value={card.subtitle} onChange={(e) => {
                                                    const newCards = [...homeCards]; newCards[index].subtitle = e.target.value; setHomeCards(newCards);
                                                }} className="w-full p-2 text-xs border rounded" />
                                                <input type="text" placeholder="Hex Color" value={card.color} onChange={(e) => {
                                                    const newCards = [...homeCards]; newCards[index].color = e.target.value; setHomeCards(newCards);
                                                }} className="w-full p-2 text-xs border rounded font-mono" />
                                                <textarea placeholder="Icon Base64" value={card.icon} onChange={(e) => {
                                                    const newCards = [...homeCards]; newCards[index].icon = e.target.value; setHomeCards(newCards);
                                                }} className="w-full h-12 p-2 text-[10px] border rounded resize-none" />
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="flex justify-center pt-4 gap-2">
                                     <button onClick={() => setIsEditingHome(false)} className="px-8 py-3 bg-zinc-100 text-zinc-600 rounded-full font-bold">Cancel</button>
                                     <button onClick={saveHomeContent} className="px-8 py-3 bg-zinc-900 text-white rounded-full font-bold shadow-lg">Save All Content</button>
                                </div>

                                {/* NEW: Reset Visitor Count Button */}
                                <div className="mt-8 pt-8 border-t border-zinc-100 flex flex-col items-center">
                                     <h4 className="font-bold text-zinc-900 mb-2">Danger Zone</h4>
                                     <button onClick={() => requestAction('RESET_VISITORS')} className="px-6 py-2 bg-red-100 text-red-600 rounded-full font-bold text-xs hover:bg-red-200 transition-colors">
                                          Reset Visitor Count to 0
                                     </button>
                                </div>
                            </div>
                        );
                    }

                    const validImages = homeImages.filter(src => src && src.trim() !== '');
                    const hasImages = validImages.length > 0;

                    return (
                        <div className="animate-slide-up w-full mt-8 px-4 pb-20 overflow-visible">
                            {/* 3D SLIDER SECTION */}
                            <div className="w-full mb-16">
                                <div className="max-w-2xl mx-auto text-center space-y-4 mb-8">
                                    <div className="inline-flex items-center gap-3">
                                        <div className="inline-flex items-center justify-center p-3 bg-white rounded-full shadow-sm ring-1 ring-zinc-200 gap-2">
                                            <SparklesIcon className="text-amber-500" size={20} />
                                            <span className="text-zinc-600 text-sm font-medium">Visitors:</span>
                                            <SlidingCounter count={displayVisitorCount} isTestMode={!!testIntervalRef.current} />
                                        </div>
                                        
                                        {/* TEST BUTTON (MOVED HERE) */}
                                        <button 
                                            onMouseDown={handleTestButtonPress} 
                                            onMouseUp={handleTestButtonRelease} 
                                            onMouseLeave={handleTestButtonRelease}
                                            onTouchStart={handleTestButtonPress}
                                            onTouchEnd={handleTestButtonRelease}
                                            onClick={!isTestModeUnlocked ? handleTestButtonPress : undefined}
                                            className={`transition-colors duration-300 ${isTestModeUnlocked ? 'text-red-400 hover:text-red-600' : 'text-zinc-200 hover:text-zinc-400'}`}
                                            title="Test Falling Numbers"
                                        >
                                            <TestIcon size={18} />
                                        </button>
                                    </div>
                                </div>
                                <div className="relative w-full max-w-[320px] md:max-w-[360px] mx-auto h-[500px] bg-zinc-900 rounded-3xl overflow-hidden shadow-2xl ring-8 ring-white border border-zinc-200 flex items-center justify-center">
                                    {hasImages ? (
                                        <div className="relative w-full h-full flex items-center justify-center">
                                        {[virtualIndex - 1, virtualIndex, virtualIndex + 1, virtualIndex + 2].map((idx) => {
                                            if (idx < 0) return null;
                                            const modIndex = idx % validImages.length;
                                            let src = validImages[modIndex].trim();
                                            if (!src.startsWith('data:')) src = `data:image/png;base64,${src}`;
                                            const distance = idx - virtualIndex;
                                            let cardStyle = '';
                                            let zIndex = 0;
                                            if (distance === 0) { cardStyle = 'scale-100 opacity-100 translate-x-0 rotate-0 shadow-2xl'; zIndex = 30; }
                                            else if (distance === 1) { cardStyle = 'scale-95 opacity-80 translate-x-6 rotate-2 bg-black/50 blur-[1px]'; zIndex = 20; }
                                            else if (distance === 2) { cardStyle = 'scale-90 opacity-60 translate-x-12 rotate-4 bg-black/80 blur-[2px]'; zIndex = 10; }
                                            else if (distance === -1) { cardStyle = '-translate-x-[120%] rotate-[-10deg] opacity-0 scale-90'; zIndex = 40; }
                                            else return null;
                                            return (
                                                <div key={idx} className={`absolute top-0 left-0 w-full h-full flex items-center justify-center transition-all duration-700 ease-in-out ${cardStyle}`} style={{ zIndex }}>
                                                    <div className="relative w-full h-full rounded-2xl overflow-hidden bg-zinc-800 border-2 border-zinc-800">
                                                        <img src={src} alt="" className="w-full h-full object-cover" />
                                                        <div className="absolute inset-0 bg-black transition-opacity duration-700 pointer-events-none" style={{ opacity: distance > 0 ? 0.2 * distance : 0 }}></div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                        </div>
                                    ) : (
                                        <div className="text-zinc-400 text-xs">No slider images configured</div>
                                    )}
                                    {hasImages && validImages.length > 1 && (
                                        <div className="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2 z-50">
                                            {validImages.map((_, i) => (
                                            <div key={i} className={`h-1.5 rounded-full transition-all duration-300 shadow-sm backdrop-blur-sm ${(virtualIndex % validImages.length) === i ? 'w-6 bg-white' : 'w-2 bg-white/30'}`}></div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* CARDS SECTION (m1 - m4) */}
                            <div className="w-full max-w-6xl mx-auto">
                                <h3 className="text-center text-zinc-400 text-sm font-bold uppercase tracking-widest mb-8">Explore More</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    {homeCards.map((card, index) => {
                                        // Assign animation based on index
                                        let animClass = "";
                                        if (index === 0) animClass = "anim-bear";
                                        else if (index === 1) animClass = "anim-fox";
                                        else if (index === 2) animClass = "anim-bunny";
                                        else animClass = "anim-panda";

                                        return (
                                            <div key={card.id} className="group relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-visible border border-zinc-100 flex flex-col h-56 cursor-pointer transform hover:-translate-y-2 z-10">
                                                
                                                {/* THE TOY ELEMENT (Hidden until hover) */}
                                                <div className={`absolute -top-12 left-1/2 -translate-x-1/2 text-5xl pointer-events-none opacity-0 z-0 ${animClass}`}>
                                                    {card.toy}
                                                </div>

                                                <div className="relative z-10 h-full flex flex-col rounded-2xl overflow-hidden">
                                                    {/* Top Color Section */}
                                                    <div className={`h-3/5 w-full flex items-center justify-center transition-colors duration-300 ${card.color.startsWith('#') || card.color.startsWith('rgb') ? '' : card.color}`} style={{ backgroundColor: (card.color.startsWith('#') || card.color.startsWith('rgb')) ? card.color : undefined }}>
                                                        {card.icon ? (
                                                            <img 
                                                                src={card.icon.startsWith('data:') ? card.icon : `data:image/png;base64,${card.icon}`} 
                                                                className="w-16 h-16 object-contain drop-shadow-md brightness-0 invert transform group-hover:scale-110 transition-transform duration-300" 
                                                                alt={card.title}
                                                            />
                                                        ) : (
                                                            <BackpackIcon className="text-white opacity-90 transform group-hover:rotate-12 transition-transform duration-300" size={48} />
                                                        )}
                                                    </div>
                                                    
                                                    {/* Bottom Text Section */}
                                                    <div className="h-2/5 w-full bg-white flex flex-col items-center justify-center p-4 text-center">
                                                        <h3 className="text-lg font-bold text-zinc-800">{card.title}</h3>
                                                        <p className="text-sm text-indigo-600 font-medium mt-1 opacity-80 group-hover:opacity-100 group-hover:underline transition-all">
                                                            {card.subtitle}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="flex justify-center mt-12 mb-8">
                                <button onClick={() => requestAction('EDIT_HOME')} className="flex items-center gap-2 text-zinc-400 hover:text-zinc-900 text-xs font-semibold uppercase tracking-wider transition-colors px-4 py-2 rounded-full hover:bg-white/50 border border-transparent hover:border-zinc-200">
                                    <SettingsIcon size={14} /> Manage Home Content
                                </button>
                            </div>
                        </div>
                    );
                }

                if (activeTab === 'ABOUT') {
                    // NEW ABOUT LAYOUT
                    return (
                        <div className="animate-slide-up flex flex-col md:flex-row gap-8 items-start justify-center mt-8 pb-12">
                            
                            {/* LEFT COLUMN: PICTURE */}
                            <div className="w-full md:w-5/12 flex flex-col items-center">
                                {renderedImage ? (
                                    <div className="relative group w-full">
                                        <img 
                                            src={renderedImage} 
                                            alt="Profile" 
                                            className="w-full h-auto rounded-3xl shadow-2xl ring-4 ring-white/50 object-cover cursor-pointer"
                                            onClick={() => requestAction('RESET_PROFILE')}
                                        />
                                        <div className="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/20 rounded-3xl pointer-events-none">
                                            <span className="bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg">Tap to Reset</span>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="w-full aspect-[3/4] border-2 border-dashed border-zinc-300 rounded-3xl bg-white/50 flex flex-col items-center justify-center p-6 text-center">
                                        <UserIcon size={48} className="text-zinc-300 mb-4"/>
                                        <p className="text-zinc-500 text-xs mb-4">No Profile Picture</p>
                                        <textarea 
                                            value={base64Input}
                                            onChange={(e) => setBase64Input(e.target.value)}
                                            placeholder="Paste Base64..."
                                            className="w-full h-24 p-2 text-[10px] rounded border mb-2 resize-none"
                                        />
                                        <button onClick={handleImageInput} disabled={!base64Input} className="bg-zinc-900 text-white text-xs px-4 py-2 rounded-full">Set Image</button>
                                    </div>
                                )}
                            </div>

                            {/* RIGHT COLUMN: NAME & BIO */}
                            <div className="w-full md:w-7/12 bg-white/60 backdrop-blur-xl p-8 rounded-3xl border border-white/50 shadow-xl flex flex-col h-full">
                                <div className="mb-6">
                                    <h2 className="text-3xl md:text-4xl font-bold text-zinc-900 tracking-tight">Aphilak Kapangnoy</h2>
                                    <div className="h-1 w-20 bg-indigo-500 rounded-full mt-2"></div>
                                </div>
                                
                                <div className="flex-1 relative">
                                    {isEditingBio ? (
                                        <div className="animate-fade-in">
                                            <textarea 
                                                value={bioText}
                                                onChange={(e) => setBioText(e.target.value)}
                                                className="w-full h-64 p-4 rounded-xl border border-indigo-200 focus:ring-2 focus:ring-indigo-500 outline-none text-zinc-700 leading-relaxed resize-none bg-white/80"
                                                placeholder="Enter your bio..."
                                            />
                                            <div className="flex gap-2 mt-4 justify-end">
                                                <button onClick={() => setIsEditingBio(false)} className="text-zinc-500 text-sm px-4 py-2 hover:bg-zinc-100 rounded-full">Cancel</button>
                                                <button onClick={saveBio} className="bg-indigo-600 text-white text-sm px-6 py-2 rounded-full shadow-lg hover:bg-indigo-700">Save Bio</button>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="group relative">
                                            <div className="prose prose-zinc text-zinc-600 whitespace-pre-wrap leading-relaxed min-h-[10rem]">
                                                {bioText}
                                            </div>
                                            <button 
                                                onClick={() => requestAction('EDIT_BIO')}
                                                className="absolute top-0 right-0 opacity-0 group-hover:opacity-100 transition-opacity p-2 text-zinc-400 hover:text-indigo-600 bg-white/80 rounded-full shadow-sm"
                                                title="Edit Bio"
                                            >
                                                <EditIcon size={18} />
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>

                        </div>
                    );
                }

                if (activeTab === 'CONTACT') return <ContactCard />;
                return null;
            };

            return (
                <div className="min-h-screen w-full bg-slate-50 text-zinc-900 selection:bg-black selection:text-white overflow-hidden relative">
                    {/* Style Modal */}
                    {showStyleSelector && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in">
                            <div className="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md relative">
                                <h3 className="text-2xl font-bold text-center mb-6">Choose Style</h3>
                                {isProcessing ? (
                                    <div className="text-center">Processing...</div>
                                ) : (
                                    <div className="grid grid-cols-2 gap-4">
                                        <button onClick={() => processImage('NORMAL')} className="p-4 border rounded-xl hover:bg-zinc-50 font-bold">Normal</button>
                                        <button onClick={() => processImage('CUT')} className="p-4 border border-indigo-200 rounded-xl hover:bg-indigo-50 font-bold text-indigo-700">Auto Cut</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Password Modal */}
                    {showPasswordModal && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in">
                            <div className={`bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm ${passwordError ? 'animate-shake' : ''}`}>
                                <h3 className="text-lg font-bold mb-4 flex items-center gap-2"><LockIcon size={20} className="text-red-500"/> Security</h3>
                                <p className="text-sm text-zinc-500 mb-4">Enter password (1090) to continue.</p>
                                <form onSubmit={confirmPassword}>
                                    <input type="password" autoFocus value={passwordInput} onChange={(e) => setPasswordInput(e.target.value)} className="w-full p-3 rounded-lg border bg-zinc-50 mb-4 text-center tracking-widest" />
                                    <div className="flex gap-2">
                                        <button type="button" onClick={() => setShowPasswordModal(false)} className="flex-1 py-2 text-zinc-600">Cancel</button>
                                        <button type="submit" className="flex-1 py-2 bg-red-500 text-white rounded-lg">Confirm</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    <div className="fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
                        <div className="absolute top-[20%] right-[-10%] w-[500px] h-[500px] bg-slate-200/50 rounded-full mix-blend-multiply filter blur-3xl opacity-50" />
                        <div className="absolute bottom-[-10%] left-[-10%] w-[600px] h-[600px] bg-zinc-200/50 rounded-full mix-blend-multiply filter blur-3xl opacity-50" />
                    </div>

                    <div className="relative z-10 flex flex-col items-center w-full min-h-screen pb-12 overflow-y-auto no-scrollbar">
                        <HeaderSection 
                            introPhase={introPhase} 
                            activeTab={activeTab} 
                            onTabChange={setActiveTab} 
                            headerImages={headerImages}
                            onRequestEdit={() => requestAction('EDIT_HEADER')}
                            onRequestTest={() => requestAction('UNLOCK_TEST')}
                            onTestDown={handleTestButtonPress}
                            onTestUp={handleTestButtonRelease}
                            isTestModeUnlocked={isTestModeUnlocked}
                        />
                        <main className={`w-full max-w-6xl transition-opacity duration-1000 delay-200 px-4 ${introPhase !== 'start' ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>
                            {renderContent()}
                        </main>
                        <footer className={`relative mt-auto py-8 text-center w-full text-zinc-400 text-xs transition-opacity duration-1000 delay-500 flex flex-col items-center gap-2 ${introPhase === 'finished' ? 'opacity-100' : 'opacity-0'}`}>
                            <span>Â© {new Date().getFullYear()} Army Website. All rights reserved.</span>
                            
                            {/* Connection Status Indicator */}
                            <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-white/50 border border-zinc-100 backdrop-blur-sm shadow-sm">
                                <div className={`w-2 h-2 rounded-full ${isOnline ? 'bg-green-500 animate-pulse' : 'bg-red-500'}`}></div>
                                <span className={`text-[10px] font-bold ${isOnline ? 'text-green-600' : 'text-red-500'}`}>
                                    {isOnline ? 'ONLINE: Syncing Active' : 'OFFLINE: Local Changes Only'}
                                </span>
                            </div>
                        </footer>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
